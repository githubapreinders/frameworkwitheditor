!function(){"use strict";var e=angular.module("confab",["ui.select","ngSanitize","ngAnimate","ui.bootstrap","ui.tree","ui.router","ui.codemirror","ngCookies","angularLocalStorage"]);e.config(["$stateProvider","$urlRouterProvider","$httpProvider",function(e,t,n){console.log("Application config..."),e.state("app",{url:"/",views:{content:{templateUrl:"views/home.html",controller:"IndexController as vm"}}}).state("app.moderator",{url:"moderator",views:{"content@":{templateUrl:"views/moderator.html",controller:"ModeratorController as vm3"}}}).state("app.userpage",{url:"userpage",views:{"content@":{templateUrl:"views/userpage.html",controller:"MyUserController as vm6"}}}).state("app.landingpage",{url:"landingpage",views:{"content@":{templateUrl:"views/landingpage.html",controller:"LandingPageController as vm7"}}}),t.otherwise("/")}])}(),function(){"use strict";angular.module("confab").controller("IndexController",["$scope","$interval","$timeout","$uibModal","$uibTooltip","xmlTag","attributeObject","StaticDataFactory","StorageFactory","EditorFactory","ValidationFactory","IafFactory","ModeratorFactory","ZipService","UserFactory","AuthTokenFactory",function(e,t,n,o,r,i,s,l,a,c,u,g,d,f,m,p){function h(){$("#classArea").mCustomScrollbar({theme:"minimal"}),$("#descriptionArea").mCustomScrollbar({theme:"minimal"}),$("#propertyArea").mCustomScrollbar({theme:"minimal"})}function v(){H.user=null,l.setProjectName("Ibis4Teacher"),k(),h(),y()}function y(){var e=location.search.substring(1),t=e.split("&");if(console.log("checking: ",t,e),2===t.length){console.log("setting request params");var n=t[0].split("=")[1],o=t[1].split("=")[1];l.setReqParams(n,o)}console.log("results: ",n,o)}function b(e,t){m.login(e,t).then(function(e){200!==e.status?alert(e.data.loginDetails.result):(H.user=e.data.logindetails.user,m.setCurrentUser(H.user),l.setProjectName(H.user.instancename),P(),k(),h())},w)}function S(){console.log("logging out"),m.logout().then(function(e){H.user=null,m.setCurrentUser(null),H.useremail="",H.password="",t.cancel()},function(e){console.log("failure logging out...")})}function w(e){alert("error logging from service.")}function k(){l.getJson().then(function(e){function t(e,t){e.getCursor();return t&&!t()||setTimeout(function(){e.state.completionActive||e.showHint({completeSingle:!1})},100),CodeMirror.Pass}function n(e){return t(e,function(){var t=e.getCursor();return"<"==e.getRange(CodeMirror.Pos(t.line,t.ch-1),t)})}function o(e){return t(e,function(){var t=e.getTokenAt(e.getCursor());if("string"==t.type&&(!/['"]/.test(t.string.charAt(t.string.length-1))||1==t.string.length))return!1;var n=CodeMirror.innerMode(e.getMode(),t.state).state;return n.tagName})}H.navigatorModel=e.data,console.log("returning in controller...",H.navigatormodel),X.setOption("hintOptions",{schemaInfo:H.navigatorModel});var r={"'<'":t,"'/'":n,"' '":o,"'='":o,"Ctrl-Space":"autocomplete"};X.setOption("extraKeys",r),console.log("editor: ",X),K("pipes"),V(),P()},function(e){})}function I(){}function M(){e.$broadcast("LoadZipEvent")}function C(){e.$broadcast("SaveZipEvent")}function P(){0===Y&&(Y=t(function(){H.showSpinnerSmall=!0,n(function(){H.showSpinnerSmall=!1},1e3);var e=a.getGetter(a.getCurrentKey().title)();a.getSetter(e)(W.getValue())},5e3))}function O(){H.showSpinner=!H.showSpinner}function F(){O();var e=a.getGetter(a.getCurrentKey().title)();a.getSetter(e)(W.getValue()),f.sendZip().then(function(e){O();var t=document.getElementById("sendstatus");t.style.background="green",n(function(){t.style.background="none"},5e3)},function(e){var t=document.getElementById("sendstatus");t.style.background="red",O(),n(function(){t.style.background="none"},5e3)})}function T(){O(),u.validateXml(H.currentKey.title).then(function(e){H.validationMessage=e,O(),console.log("validating....",H.validationMessage)},function(e){O()})}function A(){var e=document.getElementsByClassName("CodeMirror")[0];e.style.fontSize=H.selectedFontSize.toString()+"px"}function E(e){X=c.editorLoaded(e),W=X.getDoc(),X.setOption("hintOptions",{schemaInfo:H.navigatorModel}),X.foldCode(CodeMirror.Pos(0,0)),X.foldCode(CodeMirror.Pos(W.lineCount(),0)),_(),R(),R()}function L(e){D(e.isLocked)}function D(e){X.setOption("readOnly",e)}function j(e){D(!1)}function N(){X.setOption("theme",H.selectedTheme)}function x(){H.showSpinnerSmall=!0,n(function(){H.showSpinnerSmall=!1},1e3);var t=a.switchKey();e.$broadcast("KeySwitch",t),V(t)}function U(){var e=a.getCurrentKey().title,t=W.getValue(),n=a.getGetter(e)();a.getSetter(n)(t)}function V(e){if(void 0===e&&(e=a.getCurrentKey()),void 0===a.getGetter(e.title)())n(function(){var t=a.getGetter(e.title)();W.setValue(a.getGetter(t)())},50);else{var t=a.getGetter(e.title)();W.setValue(a.getGetter(t)())}0===Y&&P()}function R(){var e=document.getElementById("configcontainer"),t=document.getElementById("mytaglibrary"),n=document.getElementById("mytaglibraryshadow"),o=document.getElementById("myfilebrowser"),r=document.getElementById("myfilebrowsershadow");H.showConfig?(o.classList.add("itemactive"),r.classList.add("itemshadowactive"),t.classList.add("itemnotactive"),n.classList.add("itemshadownotactive"),o.classList.remove("itemnotactive"),r.classList.remove("itemshadownotactive"),t.classList.remove("itemactive"),n.classList.remove("itemshadowactive"),e.style.left="0%"):(o.classList.add("itemnotactive"),r.classList.add("itemshadownotactive"),t.classList.add("itemactive"),n.classList.add("itemshadowactive"),o.classList.remove("itemactive"),r.classList.remove("itemshadowactive"),t.classList.remove("itemnotactive"),n.classList.remove("itemshadownotactive"),e.style.left="-25%"),H.showConfig=!H.showConfig}function _(){var e=document.getElementById("editorcontainer");H.showNavigator?(e.style.width="75%",e.style.left="25%"):(e.style.width="100%",e.style.left="0%"),H.showNavigator=!H.showNavigator}function z(e){H.selectedItem=e,l.setSelectedItem(e),H.selectedProperties={};for(var t=0;t<e.properties.length;t++)if("classname"==e.properties[t][0]||"className"==e.properties[t][0]){var n=document.getElementById("checkbox"+t);if(null===n)break;n.click();break}q()}function K(e){l.setDataSource(e),H.datasource=l.getDataSource(),H.showPropertyDescription=!1;var t=!1,n="zzz";Object.keys(H.navigatorModel).forEach(function(o){t||H.navigatorModel[o].type!==e||o<n&&(n=o)}),z(H.navigatorModel[n])}function B(){X.getOption("readOnly")!==!0&&(W.setValue("<?xml version='1.0' encoding='UTF-8'?>\n"),W.setCursor({line:W.lastLine(),ch:0}),X.focus())}function G(){function e(e,t,n){var o=Math.abs(n.line-t.line),r=Math.abs(n.line-e.line);if(o>r)return!1;if(r>o)return!0;var i=Math.abs(n.ch-t.ch),s=Math.abs(n.ch-e.ch);return!(i>s)}var t=W.getCursor(),n=W.getRange({line:t.line,ch:0},t),o=n.match(/<[\w\/\s=\'\"]+$|<[\w\/\s=\'\"]+>[\w\s]*$/);null!==o&&(n=o[0]);var r=W.getRange(t,{line:t.line,ch:null}),i=r.match(/^[\w\/\s=\'\"]+>|^<[\w\/\s=\'\"]+>/);null!==i&&(r=i[0]);for(var s=X.getSearchCursor(n),a=0,c={line:1e4,ch:1e4},u=-1;s.find()===!0;){var g=s.to();e(t,g,c)&&(c=g,u=a),a++}var d=l.getFormattingSettings();W.setValue(html_beautify(W.getValue(),d)),s=X.getSearchCursor(n);for(var f=0;f<u+1;f++)s.find();s.to()&&W.setCursor(s.to()),X.focus()}function Z(e){return("classname"===e[0]||"className"===e[0])&&(H.selectedProperties[e[0]]=new s("className",new Array(e[2])),q(),!0)}function J(){if(null!==H.selectedItem&&X.getOption("readOnly")!==!0)if("snippets"===H.selectedItem.type)W.replaceSelection(H.selectedItem.xml);else{var e=[];Object.keys(H.selectedProperties).length>0&&Object.keys(H.selectedProperties).forEach(function(t){e.push(H.selectedProperties[t])});var t=new i(H.selectedItem.classname,e);W.replaceSelection(t.toCompleteTag()),X.focus()}}function q(){if(null!==H.selectedItem&&X.getOption("readOnly")!==!0)if("snippets"===H.selectedItem.type)H.proposedtag=H.selectedItem.xml;else{var e=[];Object.keys(H.selectedProperties).length>0&&Object.keys(H.selectedProperties).forEach(function(t){e.push(H.selectedProperties[t])});var t=new i(H.selectedItem.classname,e);H.proposedtag=t.toCompleteTag()}}console.log("IndexController...");var H=this;H.submitForm=J,H.codemirrorLoaded=E,H.setSelectedClass=z,H.toggle_datasource=K,H.styleEditorContent=G,H.clearEditor=B,H.showNav=_,H.storeData=U,H.showConf=R,H.retrieveData=V,H.toggleSlot=x,H.checkDefaults=Z,H.changeTheme=N,H.changeFontSize=A,H.validateXml=T,H.triggerSaveZipEvent=C,H.triggerLoadZipEvent=M,H.sendZip=F,H.toggleSpinner=O,H.showTagInTooltip=q,H.toggleReadonly=L,H.unlock=j,H.login=b,H.logout=S,H.proposedtag=null,H.message="Angular Controller is working allright...",H.userInput="",H.datasource=l.getDataSource(),H.navigatorModel=null,H.selectedItem=null,H.showPropertyDescription=!1,H.selectedProperties={},H.showConfig=!1,H.showNavigator=!0,H.showFullEditor=!1;var X=null,W=null;H.showValidationMessage=!1,H.validationMessage=null,H.currentKey=a.getCurrentKey(),H.iaf_url=a.getGetter("IAF_URL")();a.initialise();H.user=null;var Y=0;H.themes=l.getThemes(),H.selectedTheme="twilight",H.selectedFontSize=14,H.fontSizes=l.getFontSizes(),H.availableLessons=[],v(),I(),e.$on("fileload",function(){t.cancel(Y),Y=0}),e.$on("$destroy",function(){t.cancel(Y)}),e.$on("Keychange",function(e,t){H.currentKey=a.getCurrentKey(),V(H.currentKey),L(H.currentKey)}),e.$on("saveOldValues",function(){if(H.showSpinnerSmall=!0,n(function(){H.showSpinnerSmall=!1},1e3),a.getCurrentKey()){var e=a.getGetter(a.getCurrentKey().title)();a.getSetter(e)(W.getValue())}})}]).controller("LoadCredentialsController",["$uibModalInstance","items",function(e,t){function n(){e.close({iaf_url:r.iaf_url,username:r.username,password:r.password})}function o(){e.dismiss()}console.log("loading credentials...");var r=this;r.iaf_url=null,r.username=null,r.password=null,r.submitCredentials=n,r.closeModal=o}]).filter("datasourceFilter",["StaticDataFactory",function(e){return function(t){var n=[];return angular.forEach(t,function(t){t.type===e.getDataSource()&&n.push(t)}),n.sort(function(e,t){var n=e.classname.toLowerCase(),o=t.classname.toLowerCase();return n<o?-1:n>o?1:0}),n}}]).filter("typeFilter",function(){return function(e){if(void 0!==e)switch(e){case"pipes":return"pipe";case"receivers":return"receiver";case"snippets":return"snippet";case"general":return"tag";default:return""}}}).filter("cleanupFilter",function(){return function(e){if(void 0!==e){var t=e.replace(/&lt;/g,"<"),n=t.replace(/&gt;/g,">");return n}}})}(),function(){"use strict";angular.module("confab").directive("nameGiver",["StorageFactory",function(e){return{restrict:"A",link:function(t,n,o){n.bind("blur",function(n){function o(n){for(var a=0;a<n.length;a++){if(console.log(n[a].title,n[a].id),n[a].id==i){for(var c=angular.element(s).scope(),u=c.$parentNodesScope.$modelValue,g=0;g<u.length;g++)if(u[g].title==l)return s.innerHTML=r(c.$modelValue.title),void alert("please no double names in this directory!");if(n[a].title=l,!n[a].isDirectory){var d=e.getGetter(t.vm2.mySlots[i].title)(),f=t.vm2.mySlots[i].title;e.changeKeys(f,l),e.getSetter(f)(),e.getSetter(l)(d),t.vm2.mySlots[i].title=l;var m=e.getGetter("myslots")();m[i].title=l,e.getSetter("myslots")(m)}s.setAttribute("contentEditable",!1),t.$apply(),e.getSetter("thejson")(t.vm2.list);break}n[a].nodes.length>0&&o(n[a].nodes)}}function r(e){if(void 0===e)return"";var t=e.substring(e.lastIndexOf("/")+1,e.length);return t.length>0?t:e}var i=n.target.id.match(/\d+/g)[0];console.log("digit",i,n.target.id);var s=document.getElementById("treeitem"+i),l=s.innerHTML,a=t.vm2.list;console.log("text",l,a,i),o(a)}),n.bind("keydown",function(e){var t=e.which||e.keyCode||eventt.charCode;if(13===t){e.preventDefault();var n=document.getElementById("treeitem"+e.target.id.match(/\d+/g));n.blur()}})}}}]).directive("propertyListener",["attributeObject",function(e){return{link:function(t,n,o){n.bind("click",function(n){var o=document.getElementById("propertyheader"),r=document.getElementById("propertytext");console.log("clicked property",n.target.id,o.innerHTML);var i=n.target.id.match(/\d+$/)[0],s=t.vm.selectedItem.properties[i];o.innerHTML=s[0],r.innerHTML=s[1];var l=document.getElementById("checkbox"+i),a=document.getElementById("propertyvalue"+i),c=t.vm.selectedItem;if(console.log("items:",l,a,c),"object"==typeof l)switch(l.checked){case!0:console.log("adding ..."),t.vm.selectedProperties[s[0]]=new e(s[0],new Array(a.value));break;case!1:console.log("deleting ..."),delete t.vm.selectedProperties[s[0]]}console.info("selected properties",t.vm.selectedProperties),t.vm.showTagInTooltip()})}}}]).directive("popupPlacement",["$timeout",function(e){return{restrict:"A",link:function(t,n,o){function r(){i=e(function(){var e=document.getElementsByClassName("descriptionArea")[0].getBoundingClientRect().bottom;console.log("starting function...");for(var t,n=!0,o=0;n;){var r="popover"+o;if(t=document.getElementById(r)){var i=t.getBoundingClientRect().top,s=i-e;console.log("difference",r," ",s),s>0&&s<300?(console.log("bottom"),t.setAttribute("popover-placement","bottom-left")):(console.log("top"),t.setAttribute("popover-placement","top-left")),o++}else console.log("no element..."),n=!1}},1e3)}var i,s=Date.now();n.bind("scroll",function(e){var t=Date.now();if(t-s>1e3)r(),s=t;else{try{i.cancel()}catch(n){console.log(n)}s=t}})}}}]).directive("contenteditable",function(){return{restrict:"A",require:"ngModel",link:function(e,t,n,o){function r(){o.$setViewValue(t.html())}o.$render=function(){t.html(o.$viewValue||"")},t.bind("keyup change",function(t){console.log("changing property......");var n=t.target.id;if("newproperty"!==n&&"newclassname"!==n&&"newdescription"!==n){var o=e.vm3.selectedItem.properties[e.vm3.selectedProperty][0];e.$apply(r);var i=e.vm3.selectedItem.properties[e.vm3.selectedProperty][0],s=e.vm3.selectedItem.attrs;i!==o&&(Object.defineProperty(s,i,Object.getOwnPropertyDescriptor(s,o)),delete s[o])}else"newclassname"!==n&&console.log("new  name for item: ",n)}),t.bind("blur",function(t){console.log("changing classname......");var n=t.target.id;if("newclassname"===n){var o=e.vm3.selectedItem.classname;e.$apply(r);var i=e.vm3.selectedItem.classname;delete e.vm3.dataModel[o],e.vm3.dataModel[i]=e.vm3.selectedItem}else e.$apply(r)})}}})}(),function(){"use strict";var e=angular.module("confab");e.controller("ModeratorController",["$scope","StaticDataFactory","$uibModal","$timeout","StorageFactory","ModeratorFactory","UserFactory",function(e,t,n,o,r,i,s){function l(){console.log("chosen  file :",y.file.selected.file,y.file);var e=r.getGetter(y.file.selected.file)(),t=a(y.file.selected.file);t=t.split(".")[0],null===t&&(t=e),y.thexml=r.getGetter(e)(),y.newProperty=null,y.addingProperty=!1,y.addingItem=!0,y.dataModel.push({classname:t,description:"enter your description here",type:"snippets",xml:y.thexml,attrs:{},properties:[]}),y.selectedItem=y.dataModel[y.dataModel.length-1],console.log("thename: ",y.dataModel)}function a(e){if(void 0===e)return"";var t=e.substring(e.lastIndexOf("/")+1,e.length);return t.length>0?t:e}function c(){i.postJsonBulk(y.selectedItem.description)}function u(){y.newProperty=null,y.addingProperty=!1,y.addingItem=!0,y.dataModel.push({classname:"NEWITEM",description:"enter your description here",type:"general",xml:"",attrs:{},properties:[]}),y.selectedItem=y.dataModel[y.dataModel.length-1]}function g(e){y.selectedItem.attrs[y.selectedItem.properties[e][0]]=new Array(y.selectedItem.properties[e][2])}function d(e){switch(e){case"add":y.newProperty={propname:"new_property",propdes:"replace with your description",propdef:""};break;case"cancel":y.newProperty=null;break;case"confirm":if(""===y.newProperty.propname||""===y.newProperty.propdes)return;y.selectedItem.attrs[y.newProperty.propname]=new Array(y.newProperty.propdef),y.selectedItem.properties.unshift(new Array(y.newProperty.propname,y.newProperty.propdes,y.newProperty.propdef)),y.newProperty=null}}function f(){y.showSpinner=!y.showSpinner}function m(e){console.log("deleting property",e,y.selectedItem.properties[e][0]),delete y.selectedItem.attrs[y.selectedItem.properties[e][0]],y.selectedItem.properties.splice(e,1)}function p(){n.open({templateUrl:"./views/itemcontents.html",controller:"ModalController as vm5",windowClass:"mymodal",resolve:{items:function(){return y.selectedItem}}})}function h(){f(),i.postDatamonster(y.dataModel,y.selectedItem).then(function(e){f();var t=document.getElementById("sendstatusmod");t.style.background="green",o(function(){t.style.background="none"},5e3),console.log("success",e)},function(e){f();var t=document.getElementById("sendstatusmod");t.style.background="red",f(),o(function(){t.style.background="none"},5e3),console.log("fail",e)})}function v(){n.open({templateUrl:"./views/modal_delete_item.html",animation:!0,controller:"Modal2Controller as vm6",size:"sm",backdrop:"static",resolve:{item:function(){return y.selectedItem}}}).result.then(function(e){console.log("result:",e),"delete"===e&&(f(),i.deleteItem(y.selectedItem.classname).then(function(e){f();var t=y.selectedItem.classname;console.log("response from service: ",e,t);for(var n=-1,o=0;o<y.dataModel.length;o++)if(console.log("iterating",y.dataModel[o].classname),y.dataModel[o].classname===t){n=o,console.log("deleted index...",n);break}n!==-1&&delete y.dataModel[n],y.selectedItem=y.dataModel[Object.keys(y.dataModel)[0]],h()},function(e){f(),console.log(e)}))})}var y=this;y.showModel=p,y.deleteProperty=m,y.changeAttr=g,y.addProperty=d,y.addNewClass=u,y.saveItem=h,y.postJsonBulk=c,y.confirmDelete=v,y.newSnippet=l,y.user=s.getCurrentUser(),y.thexml=null,console.log(y.dataModel),y.currentSlotNumber=null,y.showPropertyDescription=!1,y.selectedProperty=0,y.addingProperty=!1,y.newProperty=null,y.addingItem=!1,y.slotlist=[];var b=r.getListOfFiles();b.forEach(function(e){y.slotlist.push({file:e})}),y.file={},console.log("resolving data from iaf data:"),t.getJson().then(function(e){$("#theprops").mCustomScrollbar({theme:"minimal"}),$("#xmlwrapper1").mCustomScrollbar({theme:"minimal"}),$("#xmlwrapper2").mCustomScrollbar({theme:"minimal"}),console.log("response",e);var t=JSON.parse(e.data.JSONMONSTER.MYMONSTER);y.dataModel=[],Object.keys(t).forEach(function(e){y.dataModel.push(t[e])}),y.selectedItem=y.dataModel[0]},function(e){console.log("error")})}]).controller("ModalController",["$uibModalInstance","items",function(e,t){function n(){e.close()}var o=this;o.closeModal=n,o.items=JSON.stringify(t,null,4)}]).controller("Modal2Controller",["$uibModalInstance","item",function(e,t){function n(){e.close("cancel")}function o(){e.close("delete")}var r=this;r.closeModal=n,r.deleteItem=o,r.item=t}])}(),function(){"use strict";var e=angular.module("confab");e.factory("ModeratorFactory",["$http","StorageFactory","IAF_URL",function(e,t,n){function o(){return t.getListOfFiles()}function r(t){try{e.post(n+"/api/postJsonBulk",t).then(function(e){console.log("success",e)},function(e){console.log("failure",e)})}catch(o){alert("improper json\n",o)}}function i(){}function s(t,o){console.log("posting a monster with length ",Object.keys(t).length),console.log("TAG",o);var r={};return t.forEach(function(e){r[e.classname]=e}),console.log("object:",r),e({method:"POST",url:n+"/api/storejson",data:r,headers:{responseType:"Json"}}).then(function(e){console.log("saving result",e.status),l(o)},function(e){console.log("failed result posting datamonster",e.status)})}function l(t){var o={classname:t.classname,thetag:t,modificationdate:Date.now()};return console.log("tag: ",o),e.post(n+"/api/postiaftag",o).then(function(e){console.log("saving a tag",e.status)},function(e){console.log("failed result posting tag",e.status)})}function a(t){return e({method:"GET",url:n+"/api/deleteiaftag/"+t}).then(function(e){return e},function(e){return e})}return{postJsonBulk:r,postDatamonster:s,postSchema:i,deleteItem:a,getListOfFiles:o}}])}(),function(){"use strict";function e(){var e=window.location.hostname;switch(e){case"localhost":var n=window.location.href;t.constant("IAF_URL",n.split("/iaf/")[0]);break;case"ibis4education-env.bz46fawhzf.eu-central-1.elasticbeanstalk.com":t.constant("IAF_URL","http://ibis4education-env.bz46fawhzf.eu-central-1.elasticbeanstalk.com");break;case"ibis4edproduction-env.c4weisckkn.eu-central-1.elasticbeanstalk.com":t.constant("IAF_URL","http://ibis4edproduction-env.c4weisckkn.eu-central-1.elasticbeanstalk.com");break;default:t.constant("IAF_URL","http://localhost:8080/Ibis4Education")}}var t=angular.module("confab");t.constant("UPLOAD_URL","/iaf/api/configurations"),e(),t.factory("StaticDataFactory",["$q","xmlTag","$http","StorageFactory","$interval","IAF_URL",function(e,t,n,o,r,i){function s(e,t){C={instancename:e,version:t},console.log("iaf url: ",i,this.reqparams)}function l(){return C}function a(){return M}function c(e){M=e}function u(e){I=e}function g(){return I}function d(){return S}function f(){return w}function m(){return P}function p(e){b=e}function h(){return b}function v(){return n.get("https://ibissource.org/eddie/jsonmonster.json").then(function(e){return k=e.data,console.info("returning json from server with status ",e.data),e},function(e){console.log("server error :",e)})}function y(){return k}console.log("StaticDatafactory...");var b="pipes",S=["twilight","monokai","neat"],w=[12,13,14,15,16,17,18,19,20],k=null,I=null,M=null,C=null,P={indent_size:4,xml:{end_with_newline:!0,js:{indent_size:2},css:{indent_size:2}},css:{indent_size:1},js:{"preserve-newlines":!0}};return{getJson:v,getStaticJson:y,setDataSource:p,getDataSource:h,getFormattingSettings:m,getThemes:d,getFontSizes:f,setSelectedItem:u,getSelectedItem:g,getProjectName:a,setProjectName:c,setReqParams:s,getReqParams:l}}]),t.factory("StorageFactory",["storage","$log",function(e,t){function n(){if(e.getKeys().indexOf("ngIdle.expiry")>-1&&m("ngIdle.expiry")(),0===e.getKeys().length||1===e.getKeys().length&&null!==p("auth-token")()){m("slot1")(" start here..."),m("file1")("slot1");var t=[{id:1,title:"dir1",isDirectory:!0,nodes:[{id:2,title:"file1",isDirectory:!1,isLocked:!1,nodes:[]}]}];w=["file1"],k="slot1";var n={2:{title:"file1",isLocked:!1}};m("thejson")(t),m("myslots")(n),S=f(["file1"])}else{var o=e.getKeys();o.indexOf("thejson")>-1&&o.splice(o.indexOf("thejson"),1),o.indexOf("myslots")>-1&&o.splice(o.indexOf("myslots"),1),o.indexOf("auth-token")>-1&&o.splice(o.indexOf("auth-token"),1),S=f(o)}k=S[0]}function o(){for(var t=e.getKeys(),n=0;n<t.length;n++)if(2===localStorage.getItem(t[n]).length)return!0;return!1}function r(){for(var e=p("thejson")(),t=new RegExp('(?<="isDirectory":true,"title":").*?"',"g"),n=JSON.stringify(e).match(t),o=0;o<n.length;o++)n[o]=n[o].replace('"',"/");return n}function i(){var e=[];return void 0===S?e:(S.forEach(function(t){e.push(t.title)}),e)}function s(e,t){for(var n=-1,o="",r=0;r<S.length;r++)S[r].title===e&&(n=r,o=S[r].isLocked);n!==-1&&(k.title===e&&(k.title=t),S[n].title=t)}function l(){var t=e.getKeys();t.forEach(function(e){"auth-token"!==e&&m(e)()})}function a(){var e=S.shift();return S.push(e),k=S[0],S[0]}function c(e,t){var n="slot"+Math.ceil(1e3*Math.random()),o={title:e,isLocked:!1};S.push(o),m(n)('<?xml version="1.0" encoding="UTF-8"?>'),m(e)(n);var r=p("myslots")();return r[t]=o,m("myslots")(r),n}function u(){var e=[];return w.forEach(function(t){e.push(p(t)())}),e}function g(e){k=e}function d(){return k}function f(e){var t=[];return e.forEach(function(e){"slot"!==e.substring(0,4)&&t.push({title:e,isLocked:!1})}),t}function m(e){return h(e),I[e].setter}function p(e){return h(e),I[e].getter}function h(e){if(!e||angular.isUndefined(e))throw new Error("Key[ "+e+" ] is invalid");I.hasOwnProperty(e)||v(e)}function v(e){var t=y(e),n=b(e);I[e]={setter:t,getter:n}}function y(n){return function(o){if(angular.isDefined(o))try{e.set(n,o)}catch(r){t.info("[StorageFactory]"+r.message)}else e.remove(n)}}function b(t){return function(){var n=e.get(t);if(null===n){n=void 0;var o=I[t].setter;o(n)}return n}}console.log("StorageFactory...");var S,w,k,I={};return{getSetter:m,getGetter:p,verifyKey:h,createAPIForKey:v,createSetter:y,createGetter:b,getAliases:u,switchKey:a,setCurrentKey:g,getCurrentKey:d,getNewSlotname:c,initialise:n,deleteAll:l,changeKeys:s,getListOfDirectories:r,getListOfFiles:i,checkIfEmptyKey:o}}]),t.factory("EditorFactory",function(){function e(e){function t(e,t){e.getCursor();return t&&!t()||setTimeout(function(){e.state.completionActive||e.showHint({completeSingle:!1})},100),CodeMirror.Pass}function n(e){return t(e,function(){var t=e.getCursor();return"<"==e.getRange(CodeMirror.Pos(t.line,t.ch-1),t)})}function o(e){return t(e,function(){var t=e.getTokenAt(e.getCursor());if("string"==t.type&&(!/['"]/.test(t.string.charAt(t.string.length-1))||1==t.string.length))return!1;var n=CodeMirror.innerMode(e.getMode(),t.state).state;return n.tagName})}e.getDoc();e.focus(),e.setOption("lineNumbers",!0),e.setOption("lineWrapping",!0),e.setOption("mode","xml"),e.setOption("beautify","true"),e.setOption("theme","twilight"),e.setOption("foldGutter",!0),e.setOption("gutters",["CodeMirror-linenumbers","CodeMirror-foldgutter"]),e.setOption("matchTags",{bothTags:!0});var r={"'<'":t,"'/'":n,"' '":o,"'='":o,"Ctrl-Space":"autocomplete"};e.setOption("extraKeys",r);var i=window.innerHeight,s=document.getElementById("mynavbar").offsetHeight,l=document.querySelector(".CodeMirror");return l.style.height=i-s+"px",e}console.log("Editorfactory...");return{editorLoaded:e}}),t.factory("ValidationFactory",["StorageFactory","$http","IAF_URL",function(e,t,n){function o(){}return{validateXml:o}}])}(),function(){"use strict";angular.module("confab").controller("ApsTreeController",["$scope","$uibModal","ZipService","StorageFactory","StaticDataFactory","IafFactory","$timeout",function(e,t,n,o,r,i,s){function l(){var r=t.open({templateUrl:"./views/loadzipdialog.html",controller:"LoadZipController as vm3",size:"md",resolve:{items:function(){return"something"}}});r.rendered.then(function(t){var i=document.getElementById("zipfromfile"),l=document.getElementById("mergefromfile");console.log(i,l),i.addEventListener("change",function(t){console.log("file chosen !",t.target.files[0]),e.$emit("fileload"),r.close({returntype:"viafile"}),n.getZipFromFile(t.target.files[0]).then(function(e){s(function(){console.log("succes replacing with zip from disk..."),o.initialise(),y.list=e,console.log(y.list),y.mySlots=n.getMySlots();var t=Object.keys(y.mySlots);o.setCurrentKey(y.mySlots[t[0]]),d({id:t[0]})},100)},function(e){console.log("failure...",e)})}),l.addEventListener("change",function(t){console.log("file chosen to merge!",t.target.files[0]),e.$emit("fileload"),r.close({returntype:"mergefile"}),n.mergeZipFromFile(t.target.files[0]).then(function(e){s(function(){o.initialise(),y.list=e,console.log(y.list),y.mySlots=n.getMySlots(),console.log("succes merging files...",y.mySlots);var t=Object.keys(y.mySlots);o.setCurrentKey(y.mySlots[t[0]]),d({id:t[0]})},100),console.log("empty slot: ",o.checkIfEmptyKey())},function(e){console.log("failure mergin files...",e)})})},function(e){}),r.result.then(function(e){if(console.log("response: ",e.returntype),"viahttp"===e.returntype){y.list=e.data,y.mySlots=n.getMySlots();var t=Object.keys(y.mySlots);d({id:t[0]}),console.log(y.list)}},function(e){console.log("no result from modal...")})}function a(){n.sendZip(!0).then(function(e){alert("savedToFile!")},function(e){console.log("saving to file failed...")})}function c(e){var t="file"!==e,n={id:Math.floor(1e4*Math.random()),title:e+v(),isDirectory:t,isLocked:!1,nodes:[]};y.list.push(n),"file"===e&&(o.getNewSlotname(n.title,n.id),y.mySlots[n.id]={title:n.title,isLocked:!1},d(n))}function u(){if(null!==r.getReqParams())console.log("req params present downloading zip..."),g();else{y.list=o.getGetter("thejson")(),y.mySlots=o.getGetter("myslots")();var e=Object.keys(y.mySlots);d({id:e[0]})}}function g(){console.log("getzip..."),n.getZip().then(function(e){y.list=e,y.mySlots=n.getMySlots();var t=Object.keys(y.mySlots);d({id:t[0]}),console.log(y.list)},function(e){console.log("failure getting zip: ",e)})}function d(t,n){if(console.log("changing selected slot...",t,n),t.hasOwnProperty("id")){n&&e.$emit("saveOldValues"),y.selectedSlot=t.id,o.setCurrentKey(y.mySlots[y.selectedSlot]);var r=y.mySlots[y.selectedSlot];e.$emit("Keychange",r)}else{if(t.$modelValue.isDirectory)return;if(!t.isDirectory){n&&e.$emit("saveOldValues"),y.selectedSlot=t.$modelValue.id,o.setCurrentKey(y.mySlots[y.selectedSlot]);var r=y.mySlots[y.selectedSlot];e.$emit("Keychange",r)}}}function f(e){var t=document.getElementById("treeitem"+e.$modelValue.id);console.log("editing ",t.id),t.setAttribute("contentEditable",!0);var n=t.firstChild,o=n.length,r=document.createRange();r.setStart(n,0),r.setEnd(n,o);var i=window.getSelection();i.removeAllRanges(),i.addRange(r),t.focus()}function m(e){function t(e){var t=y.mySlots[e].title,n=o.getGetter(t)();console.log("removing slots:",n," alias ",t),o.getSetter(t)(),o.getSetter(n)();var r=o.getGetter("myslots")();delete r[e],o.getSetter("myslots")(r)}function n(e){function t(e){for(var o=0;o<e.length;o++)e[o].isDirectory?e[o].nodes.length>0&&t(e[o].nodes):n.push(e[o].id)}var n=[];console.log("children:",e.$childNodesScope.$modelValue);var o=e.$childNodesScope.$modelValue;t(o),console.log("id of selected slot :",y.selectedSlot);e:for(var r=0;r<n.length;r++)if(y.selectedSlot===n[r]){console.log("selected file inside directory",y.selectedSlot);for(var i=Object.keys(y.mySlots),s=!1,l=0;l<i.length;l++)if(!_.contains(n,i[l])){d({id:i[l]}),s=!0;break e}s||console.log("no files left to assign current file...")}return n}function r(e){for(var t=e;null!==t.$parentNodeScope;)t=t.$parentNodeScope;return console.log("root:",t.$parentNodesScope.$modelValue),t}function i(t,n){if(n)return n;for(var o=0;o<t.length;o++){if(console.log(t[o].title,t[o].id),!t[o].isDirectory&&t[o]!==e.$modelValue){console.log("match with",t[o].title),n=!0;break}t[o].nodes.length>0&&(n=i(t[o].nodes,n))}return n}var s=(e.$modelValue.id,r(e)),l=e.$modelValue.isDirectory;if(l){console.log("removable: ",e.$modelValue.title);var a=n(e);console.log("results: ",a),a.length<Object.keys(y.mySlots).length&&(a.forEach(function(e){t(e),delete y.mySlots[e]}),e.remove())}else i(s.$parentNodesScope.$modelValue,!1)&&(console.log("removable: ",e.$modelValue.title),t(e.$modelValue.id),delete y.mySlots[e.$modelValue.id],e.remove())}function p(e){e.toggle()}function h(e){var t=e.$modelValue;if(console.log(t),t.isDirectory)t.nodes.push({id:Math.floor(1e4*Math.random()),title:t.title,isDirectory:!0,nodes:[]});else{var n=Math.floor(1e4*Math.random()),r=t.title+"-"+v(),i={id:n,title:r,isDirectory:!1,isLocked:!1,nodes:[]};null!==e.$parentNodeScope?e.$parentNodeScope.$modelValue.nodes.push(i):y.list.push(i),o.getNewSlotname(r,n),y.mySlots[n]={title:r,isLocked:!1},d(i)}}function v(){for(var e="abcdefghijklmnopqrstuvwxyzABCDEFGHILJKLMNOPRSTUVWXYZ",t="",n=0;n<3;n++){var o=Math.floor(Math.random()*e.length),r=e.substring(o,o+1);t+=r}return t}console.log("TreeController...");var y=this;y.remove=m,y.toggle=p,y.setSelectedSlot=d,y.changeName=f,y.newSubitem=h,y.getZip=g,y.addFileOrFolder=c,y.saveToFile=a,y.showZipDialog=l,u(),e.$on("LoadZipEvent",function(e,t){l()}),e.$on("SaveZipEvent",function(e,t){a()}),e.$on("KeySwitch",function(e,t){for(var n=Object.keys(y.mySlots),o=0;o<n.length;o++)if(y.mySlots[n[o]].title==t.title){console.log("bingo",n[o]);var r={id:n[o],title:n[o].title,isLocked:n,nodes:[],isDirectory:!1};d(r)}}),e.$watch("vm2.list",function(){o.getSetter("thejson")(y.list)},!0)}]).controller("LoadZipController",["$uibModalInstance","$scope","ZipService","items",function(e,t,n,o){function r(){console.log("getzip over http..."),t.$emit("fileload"),n.getZip().then(function(t){console.log("data back",t),e.close({returntype:"viahttp",data:t})},function(e){console.log("failure getting zip via http: ",e)})}function i(){e.close("dialog cancelled.")}var s=this;s.closeModal=i,s.getZipOverHttp=r}]).filter("cropFilter",function(){return function(e){if(void 0===e||null===e)return"";var t=e.substring(e.lastIndexOf("/")+1,e.length);
return t.length>0?t:e}})}(),function(){angular.module("confab").factory("xmlTag",function(){function e(e,t){this.tagType="STARTTAG",this.elementName=e,tagProperties={},t.forEach(function(e){tagProperties[e.getAttributeName()]=e.getAttributeValues()}),this.tagProperties=tagProperties}var t=["FixedQuerySender","XmlWellFormedChecker","XmlValidator","XmlSwitch","XmlIf","WsdlXmlValidator","RemoveFromSession","PutSystemDateInSession","PutInSession","MailSender","LogSender","Json2XmlValidator","JmsCommunicator","PutParametersInSession","IsolatedServiceExecutor","IsolatedServiceCaller","IfMultipart","GetFromSession","FixedResultSender","FixedResult","FilenameSwitch","XmlParamSwitch","EchoSender"];return e.prototype={getTagType:function(){return this.tagType},setTagType:function(e){switch(e){case"STARTTAG":this.tagType="STARTTAG";break;case"COMBITAG":this.tagType="COMBITAG";break;case"ENDTAG":this.tagType="ENDTAG";break;default:console.log("tagType is set to default..",e," is unknown type."),this.tagType="STARTTAG"}},toCompleteTag:function(){var e="",t="";return this.convertToPipe(),angular.forEach(this.tagProperties,function(e,n){t+=""==e?" "+n+'=""  ':" "+n+'="'+e+'"'}),e="<"+this.elementName+t+"></"+this.elementName+">"},toObject:function(){var e={};return e[this.elementName]=this.tagProperties,console.log("myobj",e),e},setProperty:function(e,t){this.tagProperties[e]=t},getPropertyValue:function(e){return this.tagProperties[e]},convertToPipe:function(){this.elementName.search(/^.*Pipe$/)!==-1&&(this.elementName="pipe"),t.includes(this.elementName)&&(this.elementName="pipe")}},e}).factory("attributeObject",function(){function e(e,t,n){this.name=e,void 0!==t?this.values=t:this.values=[],void 0!==n?this.hasDefault=n:this.hasDefault=!1}return e.prototype={setAttributeValue:function(e){this.hasDefault?this.values.unShift(e):this.values.push(e)},insertValues:function(e){this.values=e},getAttributeName:function(){return this.name},getAttributeValues:function(){return this.values},setDefaultValue:function(e){this.hasDefault=e},toString:function(){return this.name+"Allowed values:"+this.values.join()}},e})}(),function(){"use strict";var e=angular.module("confab");e.factory("UserFactory",["$http","AuthTokenFactory","StorageFactory","$q","$window","IAF_URL",function(e,t,n,o,r,i){function s(){var t=i+"/api/subscribe",n={user:{firstname:"dummy",lastname:"dummy",role:"user",email:"dummymessage"}};return console.log("url: ",t,JSON.stringify(n)),e({method:"POST",url:t,data:JSON.stringify(n),headers:{"content-type":"application/json"}}).then(function(e){return e},function(e){return e})}function l(t){var n=i+"/api/subscribe",o={user:{firstname:t.firstname,lastname:t.lastname,role:"user",email:t.email}};return console.log("url: ",n,JSON.stringify(o)),e({method:"POST",url:n,data:JSON.stringify(o),headers:{"content-type":"application/json"}}).then(function(e){return console.log("response",e),e},function(e){return console.log("response"),e})}function a(t){var n=i+"/api/newcredentials/"+t;return console.log("sending to ",n),e.get(n).then(function(e){return e},function(e){return e})}function c(){return v}function u(e){v=e,console.log("current user:",v)}function g(t){if(console.log("instancename: ",t.instancename,typeof t.instancename),void 0!==t.instancename.length&&"x"==t.instancename.charAt(0)){console.log("deleting instance...");var n=i+"/api/removeinstance/"+t.email;return e.get(n).then(function(e){return e},function(e){return e})}var o=i+"/api/users",r={user:{firstname:t.firstname,lastname:t.lastname,role:t.role,email:t.email}};return console.log("url: ",o,JSON.stringify(r)),e({method:"POST",url:o,data:JSON.stringify(r),headers:{"content-type":"application/json"}}).then(function(e){return console.log("response",e),e},function(e){return console.log("response"),e})}function d(t){var n=i+"/api/deleteuser/"+t;return console.log("sending to ",n),e.get(n).then(function(e){return console.log("deleting user  ",e),e},function(e){return console.log("deleting user  ",e),e})}function f(){var t=i+"/api/getusers";return e.get(t).then(function(e){return console.log("getting all users  ",e),e.data.users.user},function(e){return console.log("failure getting users  ",e),e})}function m(){return t.getToken()?e.get(i+"/api/me"):o.reject({data:"client has no auth token"})}function p(n,o){var r=i+"/api/login";return console.log("url: ",r),t.getToken()&&(console.log("removing an existing token..."),t.setToken()),e.post(r,{logindetails:{email:n,password:o}}).then(function(e){return t.setToken(e.data.logindetails.accesstoken),e},function(e){return console.log("statuscode ",e.data.loginDetails.result),e})}function h(){return e.get(i+"/api/logout").then(function(e){return console.info("token removed from backend",e),t.setToken(),e},function(e){return console.info("returning error from backend",e),e})}var v=null;return{login:p,logout:h,getUser:m,getAllUsers:f,saveUser:g,deleteUser:d,setCurrentUser:u,getCurrentUser:c,sendMail:a,askSubscription:l,checkIfInstanceAvailable:s}}]),e.factory("AuthTokenFactory",["$window",function(e){function t(){return o.getItem(r)}function n(e){e?o.setItem(r,e):o.removeItem(r)}var o=e.localStorage,r="auth-token";return{getToken:t,setToken:n}}]),e.factory("AuthInterceptor",["AuthTokenFactory",function(e){function t(t){var n=e.getToken();return n&&(t.headers=t.headers||{},t.headers.Authorization=n),t}return{request:t}}])}(),function(){"use strict";var e=angular.module("confab");e.controller("MyUserController",["UserFactory","$timeout",function(e,t){function n(e){if(console.log("object: ",m.theusers[e].instancename.length),void 0===m.theusers[e].instancename.length)return void console.log("returning");if("x"===m.theusers[e].instancename.substring(0,1)){var t=m.theusers[e].instancename;m.theusers[e].instancename=t.substring(1,t.length),console.log("name1:",m.theusers[e].instancename)}else m.theusers[e].instancename="x"+m.theusers[e].instancename,console.log("name2:",m.theusers[e].instancename)}function o(t){e.sendMail(m.theusers[t].email).then(function(e){console.log("success giving new credentials, email is sent. ",e.status),i()},function(e){console.log("failure giving new credentials.",e.status)})}function r(t){m.buttonsenabled&&(m.buttonsenabled=!1,e.deleteUser(m.theusers[t].email).then(function(e){console.log("success deleting user ",e.status),i()},function(e){m.buttonsenabled=!0,console.log("fai lure deleting user ",e.status)}))}function i(){e.getAllUsers().then(function(e){m.theusers=e,m.theusers.unshift({email:"",role:"user",firstname:"",lastname:"",instancename:""}),m.buttonsenabled=!0,$("#contentContainer").mCustomScrollbar({theme:"minimal"}),console.log("returned users:",m.theusers)},function(e){m.buttonsenabled=!0;var n=document.getElementById("sendstatususers");n.style.background="red",t(function(){n.style.background="none"},5e3),console.log("no users returned ",e)})}function s(e,t){m.theusers[e].role=t}function l(){console.log("item: ",m.theusers)}function a(n){m.buttonsenabled&&(m.buttonsenabled=!1,e.saveUser(m.theusers[n]).then(function(e){if(500===e.status){var n=document.getElementById("sendstatususers");n.style.background="red",t(function(){n.style.background="none"},5e3)}else{console.log("saved successfully ",e.status);var n=document.getElementById("sendstatususers");n.style.background="green",t(function(){n.style.background="none"},5e3)}i()},function(e){console.log("no success saving ",e.status);var n=document.getElementById("sendstatususers");n.style.background="red",t(function(){n.style.background="none"},5e3)}))}function c(e){switch(console.log("comparator",typeof e),e){case"instance":m.theusers.sort(f);break;case"email":m.theusers.sort(u);break;case"firstname":m.theusers.sort(g);break;case"lastname":m.theusers.sort(d)}}function u(e,t){var n=e.email.toUpperCase(),o=t.email.toUpperCase();return n<o?-1:n>o?1:0}function g(e,t){var n=e.name.toUpperCase(),o=t.name.toUpperCase();return n<o?-1:n>o?1:0}function d(e,t){var n=e.lastname.toUpperCase(),o=t.lastname.toUpperCase();return n<o?-1:n>o?1:0}function f(e,t){return"Ibis4Teacher"===e.instancename?1:e.instancename>t.instancename?(console.log("returning 1"),1):e.instancename<t.instancename?(console.log("returning -1"),-1):0}console.log("my usercontroller...");var m=this;m.setRole=s,m.saveItem=a,m.deleteUser=r,m.sendMail=o,m.toggleInstance=n,m.sortOnHeaderName=c,m.logitem=l,m.user=e.getCurrentUser(),m.buttonsenabled=!0,i()}]).controller("LandingPageController",["UserFactory","$uibModal",function(e,t){function n(){e.checkIfInstanceAvailable().then(function(e){return console.log("thestatus :",e.status),501===e.status?void(i.trytomorrow=!0):(console.log("no instance available"),void r())},function(e){console.log("failure thestatus :",e.status)})}function o(t){i.showSpinner=!0,e.askSubscription(t).then(function(e){return console.log(e),i.showSpinner=!1,200!==e.status?(console.log("wrong input"),void(i.tryagain=!0)):(console.log("succesful subscription"),i.successfulsubscription=!0,i.tryagain=!1,void 0)},function(e){console.log(e),i.showSpinner=!1,i.tryagain=!0})}function r(){i.tryagain=!1;var e=t.open({templateUrl:"./views/modalsubscribe.html",controller:"SubscribeController as vm8",size:"md",resolve:{items:function(){return"something"}}});e.result.then(function(e){console.log("response: ",e),o(e)},function(e){console.log("no result from modal..."),i.tryagain=!0})}var i=this;i.askSubscription=o,i.showSubscriptionDialog=r,console.log("LandingPageController..."),i.tryagain=!1,i.successfulsubscription=!1,i.showSpinner=!1,i.trytomorrow=!1,n()}]).controller("SubscribeController",["$uibModalInstance","items",function(e,t){function n(){console.log("returning with details..."),e.close({firstname:r.firstname,lastname:r.lastname,email:r.email})}function o(){e.dismiss()}console.log("loading subscribe controller...");var r=this;r.firstname=null,r.lastname=null,r.email=null,r.submitSubscription=n,r.closeModal=o}]).filter("xFilter",function(){return function(e){return"object"==typeof e?"-":"x"===e.charAt(0)?e.substring(1,e.length):e}})}(),function(){"use strict";var e=angular.module("confab");e.factory("ZipService",["StorageFactory","StaticDataFactory","$http","UPLOAD_URL","IAF_URL","$window",function(e,t,n,o,r,i){function s(){return e.getGetter("thejson")()}function l(){return e.getGetter("myslots")()}function a(){return h}function c(n){return new Promise(function(o,r){function i(e){if(void 0===e)return"";var t=e.substring(e.lastIndexOf("/")+1,e.length);return t.length>0?t:e}p=t.getProjectName(),console.log("projectname....",p);var s=new JSZip,l=document.querySelectorAll("[ui-tree-node]");l.forEach(function(t){for(var n=angular.element(t).scope(),o=[];null!==n.$parentNodeScope;)o.push(n.$parentNodeScope.$modelValue.title),n=n.$parentNodeScope;for(var r="";o.length>0;)r+=i(o.pop())+"/";if("Configuration.xml"===i(angular.element(t).scope().$modelValue.title)?r=p+"/Configuration.xml":r+=i(angular.element(t).scope().$modelValue.title),angular.element(t).scope().$modelValue.isDirectory)s.folder(r);else{var l=e.getGetter(angular.element(t).scope().$modelValue.title)();s.file(r,e.getGetter(l)())}});var a=Date.now(),c="configuration.version="+a;s.file("BuildInfo_SC.properties",c),console.log("Zipfile ",s),n?(console.log("saving as a zip file..."),s.generateAsync({type:"blob"}).then(function(e){var t=new Blob([e],{type:"application/zip"});console.log("generated a zip...",t),saveAs(t,"configuration.zip"),o()})):u(s,a).then(function(e){console.log("returning from postconfig"),o(e)},function(e){console.log("returning error from postconfig"),r(e)})})}function u(e,i){return new Promise(function(s,l){p=t.getProjectName();var a=r+o;if(null!==t.getReqParams()){var c=t.getReqParams();p=c.instancename,i=c.version,console.log("modifying version and projectname: ",a,p,i)}e.generateAsync({type:"blob"}).then(function(e){var o="configuration.zip",r=new FormData;r.append("realm","jdbc"),r.append("name",p),r.append("version",i),r.append("encoding","utf-8"),r.append("multiple_configs",!1),r.append("activate_config",!0),r.append("automatic_reload",!0),r.append("file",e,o),console.log("posting to iaf",e),n({method:"POST",url:a,data:r,headers:{"Content-type":void 0}}).then(function(e){if(console.info("returning from backend",e),null!==t.getReqParams()){var n=window.location.href.split("editor")[0],o="gui/#/configurations/manage/",r=t.getReqParams().instancename,i=n+o+r;console.log("switching back to console view: ",i),window.location.assign(i)}s(e)},function(e){console.info("returning error from backend",e),l(e)})})})}function g(t){return JSZip.loadAsync(t).then(function(t){function n(t){t>r.length-1||(r[t].dir?(t++,n(t)):r[t].async("string").then(function(o){var i="slot"+Math.ceil(1e3*Math.random());console.log("data length",r[t].name,o.toString().length),e.getSetter(r[t].name)(i),e.getSetter(i)(o),t++,n(t++)}))}function o(e,t){if(e===t)return!1;var n=t.lastIndexOf("/");return t.substring(0,n)===e}console.log("loadasync from file...",t),e.deleteAll();var r=[];t.forEach(function(e,t){"__"!==t.name.substring(0,2)&&t.name!==p+"/"&&"BuildInfo_SC.properties"!==t.name&&r.push(t)});for(var i=0;i<r.length;i++)if(r[i].name.indexOf(p)>-1){console.log("slicing out",r[i].name);var s=r[i].name,l=s.substring(s.lastIndexOf("/")+1,s.length);r[i].name=l}n(0),console.log("loaded zipfiles",r);var a=[];for(h={},i=0;i<r.length;i++)if(r[i].dir)a.push({id:Math.ceil(1e4*Math.random()),isDirectory:r[i].dir,title:r[i].name.substring(0,r[i].name.length-1),nodes:[]});else{var c={id:Math.ceil(1e4*Math.random()),isDirectory:r[i].dir,title:r[i].name,nodes:[]};a.push(c),h[c.id]={title:c.title,isLocked:!1}}a.sort(function(e,t){return e.title.split("/").length>t.title.split("/").length?-1:e.title.split("/").length<t.title.split("/").length?1:0});for(var u=0,g=!0;g&&u<100;){g=!1;for(var d=a,f=0;f<a.length;f++){for(var m=0;m<d.length;m++)if(o(a[f].title,d[m].title)){a[f].nodes.push(d[m]),a.splice(m,1),g=!0;break}if(g)break}u++}return console.log("generated json out of zip:\n",a),e.getSetter("thejson")(a),e.getSetter("myslots")(h),a})}function d(n){return JSZip.loadAsync(n).then(function(n){function o(t){t>i.length-1||(i[t].dir?(t++,o(t)):i[t].async("string").then(function(n){var r="slot"+f();e.getSetter(i[t].name)(r),e.getSetter(r)(n),t++,o(t++)}))}function r(e,t){if(e===t)return!1;var n=t.lastIndexOf("/");return t.substring(0,n)===e}p=t.getProjectName(),console.log("loadasync from file...",n);var i=[];n.forEach(function(e,t){"__"!==t.name.substring(0,2)&&t.name!==p+"/"&&"BuildInfo_SC.properties"!==t.name&&i.push(t)});for(var s=0;s<i.length;s++)if(i[s].name.indexOf(p)>-1){console.log("slicing out",i[s].name);var l=i[s].name,a=l.substring(l.lastIndexOf("/")+1,l.length);i[s].name=a}var c=e.getListOfDirectories(),u=[];for(s=0;s<i.length;s++)c.includes(i[s].name)&&u.push(i[s].name);u.sort(function(e,t){return e.split("/").length>t.split("/").length?1:e.split("/").length===t.split("/").length?0:-1}),u.forEach(function(e){var t="(1)";i.forEach(function(n){n.name.includes(e)&&(n.name=n.name.replace(e,e.substring(0,e.length-1)+t+"/"))})});var g=e.getListOfFiles();g.forEach(function(e){var t="(1).";for(s=0;s<i.length;s++)i[s].name===e&&(console.log("bingo"),i[s].name.split(".").length>0?i[s].name=i[s].name.split(".")[0]+t+i[s].name.split(".")[1]:i[s].name=i[s].name+f())}),o(0),console.log("zipfiles",i),console.log("empty slot: ",e.checkIfEmptyKey());var d=e.getGetter("thejson")();for(h=e.getGetter("myslots")(),s=0;s<i.length;s++)if(i[s].dir)d.push({id:Math.ceil(1e4*Math.random()),isDirectory:i[s].dir,title:i[s].name.substring(0,i[s].name.length-1),nodes:[]});else{var m={id:Math.ceil(1e4*Math.random()),isDirectory:i[s].dir,title:i[s].name,nodes:[]};d.push(m),h[m.id]={title:m.title,isLocked:!1}}d.sort(function(e,t){return e.title.split("/").length>t.title.split("/").length?-1:e.title.split("/").length<t.title.split("/").length?1:0});for(var v=0,y=!0;y&&v<100;){y=!1;for(var b=d,S=0;S<d.length;S++){for(var w=0;w<b.length;w++)if(r(d[S].title,b[w].title)){d[S].nodes.push(b[w]),d.splice(w,1),y=!0;break}if(y)break}v++}return console.log("generated json out of zip:\n",d,h),e.getSetter("thejson")(d),e.getSetter("myslots")(h),d})}function f(){for(var e="abcdefghijklmnopqrstuvwxyzABCDEFGHILJKLMNOPRSTUVWXYZ",t="",n=0;n<3;n++){var o=Math.floor(Math.random()*e.length),r=e.substring(o,o+1);t+=r}return t}function m(){var o="/iaf/api/configurations/download/"+t.getProjectName(),i=r+o;if(p=t.getProjectName(),null!==t.getReqParams()){var s=t.getReqParams();p=s.instancename,o="/iaf/api/configurations/download/"+s.instancename+"?version="+s.version,i=r+o}return console.log("Download url :",i),n({method:"GET",url:i,responseType:"arraybuffer"}).then(function(t){return new Promise(function(n,o){JSZip.loadAsync(t.data).then(function(t){function o(t){t>i.length-1||(i[t].dir?(t++,o(t)):i[t].async("string").then(function(n){var r="slot"+Math.ceil(1e3*Math.random());e.getSetter(i[t].name)(r),e.getSetter(r)(n),t++,o(t++)}))}function r(e,t){if(e===t)return!1;var n=t.lastIndexOf("/");return t.substring(0,n)===e}console.log("loadasync...",t),e.deleteAll();var i=[];t.forEach(function(e,t){"__"!==t.name.substring(0,2)&&t.name!==p+"/"&&"BuildInfo_SC.properties"!==t.name&&i.push(t)});for(var s=0;s<i.length;s++)if(i[s].name.indexOf(p)>-1){console.log("slicing out",i[s].name);var l=i[s].name,a=l.substring(l.lastIndexOf("/")+1,l.length);i[s].name=a}o(0),console.log("zipfiles",i);var c=[];for(h={},s=0;s<i.length;s++)if(i[s].dir)c.push({id:Math.ceil(1e4*Math.random()),isDirectory:i[s].dir,title:i[s].name.substring(0,i[s].name.length-1),nodes:[]});else{var u={id:Math.ceil(1e4*Math.random()),isDirectory:i[s].dir,title:i[s].name,nodes:[]};c.push(u),h[u.id]={title:u.title,isLocked:!1}}c.sort(function(e,t){return e.title.split("/").length>t.title.split("/").length?-1:e.title.split("/").length<t.title.split("/").length?1:0});for(var g=0,d=!0;d&&g<100;){d=!1;for(var f=c,m=0;m<c.length;m++){for(var v=0;v<f.length;v++)if(r(c[m].title,f[v].title)){c[m].nodes.push(f[v]),c.splice(v,1),d=!0;break}if(d)break}g++}console.log("generated json out of zip:\n",c),e.setCurrentKey(h[0]),e.getSetter("thejson")(c),e.getSetter("myslots")(h),n(c)},function(e){console.log("error",e),o(e)})})},function(e){console.log("error in http call",e)},function(e){console.log("error in http call",e)})}console.log("ZipService.js...");var p,h;return{init:s,getSlots:l,getZip:m,getZipFromFile:g,sendZip:c,getMySlots:a,mergeZipFromFile:d}}]).factory("IafFactory",["$http","ZipService","UPLOAD_URL","$window","IAF_URL",function(e,t,n,o,r){function i(t){return new Promise(function(o,i){var s=r+n;PROJECTNAME=StaticDataFactory.getProjectName(),alert(s),t.generateAsync({type:"blob"}).then(function(t){var n="configuration.zip",o=new FormData;return o.append("realm","jdbc"),o.append("name",PROJECTNAME),o.append("version",1),o.append("encoding","utf-8"),o.append("multiple_configs",!1),o.append("activate_config",!0),o.append("automatic_reload",!0),o.append("file",t,n),new Promise(function(n,r){return console.log("posting to iaf",t),e({method:"POST",url:s,data:o,headers:{"Content-type":void 0}}).then(function(e){console.info("returning from backend",e),n(e)},function(e){console.info("returning error from backend",e),r(e)})})}),o()})}return{postConfig:i}}])}();
//# sourceMappingURL=scripts.min.js.map
