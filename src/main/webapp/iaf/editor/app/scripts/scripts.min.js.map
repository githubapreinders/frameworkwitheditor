{"version":3,"sources":["scripts.min.js"],"names":["app","angular","module","config","$stateProvider","$urlRouterProvider","$httpProvider","console","log","state","url","views","content","templateUrl","controller","content@","otherwise","$scope","$interval","$timeout","$uibModal","$uibTooltip","xmlTag","attributeObject","StaticDataFactory","StorageFactory","EditorFactory","ValidationFactory","IafFactory","ModeratorFactory","ZipService","UserFactory","AuthTokenFactory","initScrollbar","$","mCustomScrollbar","theme","init","vm","user","setProjectName","getJson","getRequestParams","urlstring","location","search","substring","pairs","split","length","instancename","version","setReqParams","login","useremail","password","then","response","status","alert","data","loginDetails","result","logindetails","setCurrentUser","saveInSlot","handleError","logout","cancel","completeAfter","cm","pred","getCursor","setTimeout","completionActive","showHint","completeSingle","CodeMirror","Pass","completeIfAfterLt","cur","getRange","Pos","line","ch","completeIfInTag","tok","getTokenAt","type","test","string","charAt","inner","innerMode","getMode","tagName","navigatorModel","navigatormodel","editor","setOption","schemaInfo","extraKeys","'<'","'/'","' '","'='","Ctrl-Space","toggle_datasource","retrieveData","setTooltipSettings","triggerLoadZipEvent","$broadcast","triggerSaveZipEvent","mytimer","showSpinnerSmall","thekey","getGetter","getCurrentKey","title","getSetter","thedocument","getValue","toggleSpinner","showSpinner","sendZip","res","el","document","getElementById","style","background","err","validateXml","currentKey","validationMessage","changeFontSize","ed","getElementsByClassName","fontSize","selectedFontSize","toString","getTheEditor","_editor","editorLoaded","getDoc","foldCode","lineCount","showNav","showConf","toggleReadonly","akey","setReadonly","isLocked","val","unlock","changeTheme","selectedTheme","toggleSlot","key","switchKey","storeData","myalias","myvalue","mykey","alias","undefined","setValue","navigat","fb","fbsh","tl","tlsh","showConfig","classList","add","remove","left","showNavigator","width","setSelectedClass","item","selectedItem","setSelectedItem","selectedProperties","i","properties","checkbox","click","showTagInTooltip","thetype","setDataSource","datasource","getDataSource","showPropertyDescription","done","parking","Object","keys","forEach","clearEditor","getOption","setCursor","lastLine","focus","styleEditorContent","isTheBetter","newpos","oldpos","standard","linedifference1","Math","abs","linedifference2","chardifference1","chardifference2","pos","before","beforesegment","match","after","aftersegment","cursor","getSearchCursor","counter","original","myindex","find","newval","to","settings","getFormattingSettings","html_beautify","checkDefaults","property","Array","submitForm","replaceSelection","xml","theproperties","push","newtag","classname","toCompleteTag","proposedtag","this","codemirrorLoaded","message","userInput","showFullEditor","showValidationMessage","iaf_url","initialise","themes","getThemes","fontSizes","getFontSizes","availableLessons","$on","event","value","$uibModalInstance","items","submitCredentials","close","vm4","username","closeModal","dismiss","filter","filtered","sort","a","b","x","toLowerCase","y","newstring","replace","newerstring","directive","restrict","link","scope","attrs","bind","traverseArray","sublist","id","digit","theobject","element","siblings","$parentNodesScope","$modelValue","s","text","innerHTML","cropFilter","theslot","vm2","mySlots","oldalias","changeKeys","myslots","setAttribute","$apply","list","nodes","helper","lastIndexOf","target","thelist","code","which","keyCode","eventt","charCode","preventDefault","blur","elem","heading","itemnumber","elemt","input","checked","info","startCalc","containerbottom","getBoundingClientRect","bottom","hasprop","index","propname","theelementtop","top","difference","oldtime","Date","now","starttime","e","require","ngModel","read","$setViewValue","html","$render","$viewValue","oldvalue","vm3","selectedProperty","newvalue","theattrs","defineProperty","getOwnPropertyDescriptor","dataModel","appl","newSnippet","file","selected","slot","thename","thexml","newProperty","addingProperty","addingItem","description","postJsonBulk","addNewClass","changeAttr","addProperty","propdes","propdef","unshift","deleteProperty","splice","showModel","open","windowClass","resolve","saveItem","postDatamonster","confirmDelete","animation","size","backdrop","deleteItem","getCurrentUser","currentSlotNumber","slotlist","getListOfFiles","JSON","parse","JSONMONSTER","MYMONSTER","vm5","stringify","vm6","applicc","factory","$http","IAF_URL","json","post","resp","postSchema","datamonster","thetag","obj","method","headers","responseType","postTag","object","tag","modificationdate","getIAFConstant","theurl","window","hostname","completeurl","href","constant","$q","instance","vers","reqparams","getReqParams","getProjectName","projectname","name","getSelectedItem","formattingSettings","get","thejson","getStaticJson","indent_size","end_with_newline","js","css","preserve-newlines","storage","$log","getKeys","indexOf","isDirectory","thealiases","2","thekeys","createKeys","checkIfEmptyKey","localStorage","getItem","getListOfDirectories","regex","RegExp","dirs","files","oldname","newname","islocked","deleteAll","shift","getNewSlotname","createdAlias","theid","newslotname","ceil","random","getAliases","output","setCurrentKey","verifyKey","api","setter","getter","isUndefined","Error","hasOwnProperty","createAPIForKey","createSetter","createGetter","isDefined","set","error","bothTags","windowheight","innerHeight","navbarheight","offsetHeight","querySelector","height","showZipDialog","modalInstance","rendered","zipfromfile","mergefromfile","addEventListener","$emit","returntype","getZipFromFile","getMySlots","setSelectedSlot","mergeZipFromFile","saveToFile","addFileOrFolder","newobject","floor","createRandomSuffix","getZip","fromclick","selectedSlot","myobj","changeName","textnode","firstChild","caret","range","createRange","setStart","setEnd","sel","getSelection","removeAllRanges","addRange","deleteFromLocalStorage","itsid","thealias","deleteContainingFiles","findResults","results","$childNodesScope","array","checkingloop","j","found","l","_","contains","getRoot","$parentNodeScope","ok","nodetype","toggle","newSubitem","theitem","thetitle","suffixes","randomdigit","letter","$watch","getZipOverHttp","elementname","proparray","tagType","elementName","tagProperties","prop","getAttributeName","getAttributeValues","staticPipenames","prototype","getTagType","setTagType","astring","returnstring","itsproperties","convertToPipe","toObject","setProperty","getPropertyValue","includes","attributename","values","hasDefault","setAttributeValue","unShift","insertValues","setDefaultValue","bool","join","appliccat","$window","checkIfInstanceAvailable","theuser","firstname","lastname","role","email","content-type","askSubscription","sendMail","currentUser","saveUser","theurl1","deleteUser","getAllUsers","users","getUser","getToken","reject","setToken","accesstoken","store","token","setItem","removeItem","addToken","Authorization","request","applic","toggleInstance","theusers","buttonsenabled","setRole","logitem","sortOnHeaderName","comparator","compareInstancename","sortByEmail","sortByFirstname","sortByLastname","nameA","toUpperCase","nameB","vm7","trytomorrow","showSubscriptionDialog","userobject","tryagain","successfulsubscription","submitSubscription","vm8","UPLOAD_URL","getSlots","saveas","Promise","PROJECTNAME","zip","JSZip","elements","querySelectorAll","parents","filename","pop","folder","timestamp","generateAsync","myzip","blob","Blob","saveAs","postConfig","finalurl","params","fileName","fd","FormData","append","Content-type","firstpart","secondpart","thirdpart","assign","loadAsync","storeZip","myzipfiles","async","isParent","possibleparent","candidate","relativePath","myjson","dir","val1","val2","helper5","parentsfound","copy","duplicates","dup1","dup2","duplicate","suffix","zipfile","helper1","DOWNLOAD_URL","finalUrl","helper3"],"mappings":"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","file":"scripts.min.js","sourcesContent":["(function()\r\n{\r\n    'use strict';\r\n    var app = angular.module('confab',['ui.select','ngSanitize','ngAnimate','ui.bootstrap','ui.tree', 'ui.router', 'ui.codemirror','ngCookies','angularLocalStorage']);\r\n   \r\n    app.config(function ($stateProvider, $urlRouterProvider, $httpProvider)\r\n    {\r\n        console.log('Application config...');\r\n        //$httpProvider.interceptors.push('AuthInterceptor');\r\n        $stateProvider\r\n\r\n            // route for the home page\r\n            .state('app', {\r\n                url: '/',\r\n                views: {\r\n                    'content': {\r\n                        templateUrl: 'views/home.html',\r\n                        controller: 'IndexController as vm'\r\n                    }\r\n                }\r\n            })\r\n            .state('app.moderator', {\r\n                url:'moderator',\r\n                views: {\r\n                    'content@': {\r\n                        templateUrl : 'views/moderator.html',\r\n                        controller  : 'ModeratorController as vm3'\r\n                    }\r\n                }\r\n            })\r\n            .state('app.userpage', {\r\n                url:'userpage',\r\n                views: {\r\n                    'content@': {\r\n                        templateUrl : 'views/userpage.html',\r\n                        controller  : 'MyUserController as vm6'\r\n                    }\r\n                }\r\n            })\r\n            .state('app.landingpage', {\r\n                url:'landingpage',\r\n                views: {\r\n                    'content@': {\r\n                        templateUrl : 'views/landingpage.html',\r\n                        controller  : 'LandingPageController as vm7'\r\n                    }\r\n                }\r\n            });\r\n        $urlRouterProvider.otherwise('/');\r\n    });\r\n\r\n})();\n(function (){\r\n    'use strict';\r\n\r\n    angular.module('confab')\r\n        .controller('IndexController', function ( $scope, $interval, $timeout, $uibModal,$uibTooltip, xmlTag, attributeObject, StaticDataFactory, StorageFactory, EditorFactory, ValidationFactory,  IafFactory , ModeratorFactory, ZipService, UserFactory, AuthTokenFactory)\r\n        {\r\n\r\n            console.log('IndexController...');\r\n            var vm = this;\r\n        \r\n            //Functions\r\n            vm.submitForm = submitForm;\r\n            vm.codemirrorLoaded = getTheEditor;\r\n            vm.setSelectedClass = setSelectedClass;\r\n            vm.toggle_datasource = toggle_datasource;\r\n            vm.styleEditorContent = styleEditorContent;\r\n            vm.clearEditor = clearEditor;\r\n            vm.showNav = showNav;\r\n            vm.storeData = storeData;\r\n            vm.showConf = showConf;\r\n            vm.retrieveData = retrieveData;\r\n            vm.toggleSlot = toggleSlot;\r\n            vm.checkDefaults = checkDefaults;\r\n            vm.changeTheme = changeTheme;\r\n            vm.changeFontSize = changeFontSize;\r\n            vm.validateXml = validateXml;\r\n            vm.triggerSaveZipEvent = triggerSaveZipEvent;\r\n            vm.triggerLoadZipEvent = triggerLoadZipEvent;\r\n            vm.sendZip = sendZip;\r\n            vm.toggleSpinner = toggleSpinner;\r\n            vm.showTagInTooltip = showTagInTooltip;\r\n            vm.toggleReadonly = toggleReadonly;\r\n            vm.unlock = unlock;\r\n            vm.login = login;\r\n            vm.logout = logout;\r\n            vm.proposedtag = null;\r\n\r\n            //Static values\r\n            vm.message = \"Angular Controller is working allright...\";\r\n            vm.userInput = \"\";\r\n            vm.datasource = StaticDataFactory.getDataSource();\r\n            vm.navigatorModel = null;\r\n            vm.selectedItem = null;\r\n            vm.showPropertyDescription = false;\r\n            vm.selectedProperties = {};\r\n            vm.showConfig = false;\r\n            vm.showNavigator = true;\r\n            vm.showFullEditor = false;\r\n            var editor = null;\r\n            var thedocument = null;    \r\n            vm.showValidationMessage = false;\r\n            vm.validationMessage = null;\r\n            vm.currentKey = StorageFactory.getCurrentKey();\r\n            vm.iaf_url = StorageFactory.getGetter(\"IAF_URL\")();\r\n            var avalue = StorageFactory.initialise();\r\n            vm.user = null;\r\n            var mytimer = 0;\r\n\r\n            //Editor Styling\r\n            vm.themes = StaticDataFactory.getThemes();\r\n            vm.selectedTheme = \"twilight\";\r\n            vm.selectedFontSize = 14;\r\n            vm.fontSizes = StaticDataFactory.getFontSizes();\r\n            \r\n            vm.availableLessons = [];\r\n\r\n            \r\n\r\n            //startup function \r\n            function initScrollbar()\r\n            {\r\n                $('#classArea').mCustomScrollbar({theme:\"minimal\"});\r\n                $('#descriptionArea').mCustomScrollbar({theme:\"minimal\"});\r\n                $('#propertyArea').mCustomScrollbar({theme:\"minimal\"});\r\n            }\r\n            init();\r\n            function init()\r\n            {\r\n                vm.user = null;\r\n                StaticDataFactory.setProjectName('Ibis4Teacher');\r\n                getJson();\r\n                initScrollbar();   \r\n                getRequestParams();\r\n\r\n            }\r\n\r\n\r\n            function getRequestParams()\r\n            {\r\n                var urlstring = location.search.substring(1);\r\n                var pairs = urlstring.split('&');\r\n                console.log(\"checking: \", pairs, urlstring); \r\n                if (pairs.length === 2)\r\n                {\r\n                    console.log(\"setting request params\"); \r\n                    var instancename = pairs[0].split('=')[1];\r\n                    var version = pairs[1].split('=')[1];\r\n                    StaticDataFactory.setReqParams(instancename, version);\r\n                }\r\n                console.log(\"results: \",instancename, version); \r\n            }\r\n\r\n\r\n            \r\n\r\n            //standard loging\r\n            function login(useremail, password)\r\n            {\r\n                UserFactory.login(useremail, password).then(function success(response)\r\n                {\r\n                    //console.log(\"returning from service;\", JSON.stringify(response));\r\n                    if (response.status !== 200)\r\n                    {\r\n                        alert(response.data.loginDetails.result);\r\n                    }\r\n                    else\r\n                    {\r\n                        vm.user = response.data.logindetails.user;\r\n                        UserFactory.setCurrentUser(vm.user);\r\n                        StaticDataFactory.setProjectName(vm.user.instancename);\r\n                        //console.log(\"vm.user : \", vm.user );\r\n                        saveInSlot();\r\n                        getJson();\r\n                        initScrollbar();  \r\n                    }\r\n                }, handleError);\r\n            }\r\n\r\n\r\n            function logout()\r\n            {\r\n                console.log('logging out');\r\n                UserFactory.logout().then(function succes(response)\r\n                {\r\n                    // console.info(\"user set to null\", response);\r\n                    vm.user = null;\r\n                    UserFactory.setCurrentUser(null);\r\n                    vm.useremail = \"\";\r\n                    vm.password = \"\";\r\n                    $interval.cancel();\r\n                    // console.log(\"cancelling timer...\");\r\n                },function failure(response)\r\n                {\r\n                    console.log(\"failure logging out...\");\r\n                });\r\n            }\r\n\r\n            function handleError(response)\r\n            {\r\n                alert(\"error logging from service.\");\r\n            }\r\n\r\n            \r\n\r\n            function showCredentialsDialog()\r\n            {\r\n\r\n                var modalInstance = $uibModal.open(\r\n                {\r\n                    templateUrl : \"./views/modalcredentials.html\",\r\n                    controller : \"LoadCredentialsController as vm4\",\r\n                    size : \"md\",\r\n                    resolve : {items : function ()\r\n                        {\r\n                            return \"something\";\r\n                        }}\r\n                });\r\n                modalInstance.result.then(\r\n                function success(resp) {\r\n                    // console.log(\"response: \" , resp);\r\n                    vm.iaf_url = resp.iaf_url;\r\n                    login(resp.username, resp.password);\r\n                }, function failure(err) {\r\n                    // console.log(\"no result from modal...\");\r\n                });\r\n            }\r\n\r\n           function getJson()\r\n           {\r\n                StaticDataFactory.getJson().then(\r\n                function success(response)\r\n                {\r\n                    vm.navigatorModel = response.data;\r\n                    console.log('returning in controller...', vm.navigatormodel);\r\n                    // console.log(\"returned datamodel : \\n\", vm.navigatorModel);\r\n                    editor.setOption('hintOptions', {schemaInfo: vm.navigatorModel});\r\n                    var extraKeys =  {\r\n                          \"'<'\": completeAfter,\r\n                          \"'/'\": completeIfAfterLt,\r\n                          \"' '\": completeIfInTag,\r\n                          \"'='\": completeIfInTag,\r\n                          \"Ctrl-Space\": \"autocomplete\"\r\n                                };\r\n                editor.setOption('extraKeys', extraKeys);\r\n                \r\n                function completeAfter(cm, pred) \r\n                {\r\n                    var cur = cm.getCursor();\r\n                    if (!pred || pred()) setTimeout(function() \r\n                    {\r\n                        if (!cm.state.completionActive)\r\n                        cm.showHint({completeSingle: false});\r\n                    }, 100);\r\n                    return CodeMirror.Pass;\r\n                }\r\n\r\n                function completeIfAfterLt(cm) \r\n                {\r\n                    return completeAfter(cm, function() \r\n                    {\r\n                        var cur = cm.getCursor();\r\n                        return cm.getRange(CodeMirror.Pos(cur.line, cur.ch - 1), cur) == \"<\";\r\n                    });\r\n                }\r\n\r\n                function completeIfInTag(cm) \r\n                {\r\n                return completeAfter(cm, function() \r\n                {\r\n                    var tok = cm.getTokenAt(cm.getCursor());\r\n                    if (tok.type == \"string\" && (!/['\"]/.test(tok.string.charAt(tok.string.length - 1)) || tok.string.length == 1)) return false;\r\n                    var inner = CodeMirror.innerMode(cm.getMode(), tok.state).state;\r\n                    return inner.tagName;\r\n                });\r\n\r\n                }\r\n\r\n\r\n                    console.log(\"editor: \", editor); \r\n                    toggle_datasource('pipes');\r\n                    retrieveData();\r\n                    saveInSlot();\r\n                },\r\n                function error(response)\r\n                {\r\n                    // console.log(\"error initialising:\", response.data);\r\n                });\r\n\r\n           }\r\n\r\n         \r\n\r\n            setTooltipSettings();\r\n            function setTooltipSettings()\r\n            {\r\n                //console.log(\"tooltip\", $uibTooltip);\r\n                 //$uibTooltip.options({'trigger':'mouseenter'});\r\n            }\r\n\r\n            function triggerLoadZipEvent()\r\n            {\r\n                $scope.$broadcast('LoadZipEvent');\r\n            }\r\n            \r\n\r\n            function triggerSaveZipEvent()\r\n            {\r\n                $scope.$broadcast('SaveZipEvent');\r\n            }\r\n\r\n\r\n            \r\n\r\n            function setAvailableLesson(which)\r\n            {\r\n                ModeratorFactory.setAvailableLesson(which);\r\n            }\r\n\r\n            //saves editor content in the localstorage slot that is open every 5 seconds, spinner indicates that \r\n            function saveInSlot()\r\n            {\r\n                if (mytimer !== 0 )\r\n                {\r\n                    // console.log(\"no two timers...\");\r\n                 return;\r\n                }\r\n                // console.log(\"starting timer\");\r\n                mytimer = $interval(function()\r\n                {\r\n                    vm.showSpinnerSmall = true;\r\n                    $timeout(function()\r\n                    {\r\n                        vm.showSpinnerSmall = false;\r\n                        // console.log(\"spinner:\",vm.showSpinnerSmall);\r\n                    }, 1000);\r\n                    var thekey = StorageFactory.getGetter(StorageFactory.getCurrentKey().title)();\r\n                    // console.log(\"saving : \", cropFilter(StorageFactory.getCurrentKey().title));\r\n                    StorageFactory.getSetter(thekey)(thedocument.getValue());\r\n                }, 5000);\r\n             \r\n            }\r\n\r\n           // temporary stopping the timer to prevent file overwrite when loading a new file tree\r\n           $scope.$on('fileload', function()\r\n            {\r\n                // console.log(\"loading file: cancelling timer...\" , mytimer);\r\n                $interval.cancel(mytimer);\r\n                mytimer = 0 ; \r\n            });\r\n           \r\n\r\n            //cancelling timer after switch to other page.\r\n            $scope.$on('$destroy', function()\r\n            {\r\n                // console.log(\"cancelling timer...\" , mytimer);\r\n                $interval.cancel(mytimer);\r\n            });\r\n\r\n            //setting the editor content after a new file has been chosen to edit\r\n            $scope.$on(\"Keychange\", function(event,value)\r\n            {\r\n                vm.currentKey = StorageFactory.getCurrentKey();\r\n                retrieveData(vm.currentKey);\r\n                toggleReadonly(vm.currentKey);\r\n            });\r\n\r\n\r\n            // after a switch in focus, saving the work that is just made\r\n            $scope.$on('saveOldValues',function()\r\n            {\r\n                vm.showSpinnerSmall = true;\r\n                $timeout(function()\r\n                {\r\n                    vm.showSpinnerSmall = false;\r\n                }, 1000);\r\n                if(StorageFactory.getCurrentKey())\r\n                {\r\n                    var thekey = StorageFactory.getGetter(StorageFactory.getCurrentKey().title)();\r\n                    // console.log(\"saving after focus change : \", cropFilter(StorageFactory.getCurrentKey().title));\r\n                    StorageFactory.getSetter(thekey)(thedocument.getValue());\r\n                }\r\n            });\r\n\r\n            function cropFilter(item)\r\n            {\r\n                if(item === undefined) return \"\";\r\n                var helper = item.substring(item.lastIndexOf('/') + 1 ,item.length);\r\n                if(helper.length > 0)\r\n                {\r\n                    return helper;\r\n                }\r\n                else\r\n                {\r\n                    return item;\r\n                }\r\n            }\r\n\r\n            \r\n            //show a spinner while waiting for a response\r\n            function toggleSpinner()\r\n            {\r\n                vm.showSpinner = !vm.showSpinner;\r\n            }\r\n\r\n            //send the current configuration to the framework.\r\n            function sendZip()\r\n            {   \r\n                toggleSpinner();\r\n                //saving the current file before uploading it...\r\n                var thekey = StorageFactory.getGetter(StorageFactory.getCurrentKey().title)();\r\n                // console.log(\"saving : \", cropFilter(StorageFactory.getCurrentKey().title));\r\n                StorageFactory.getSetter(thekey)(thedocument.getValue());\r\n                ZipService.sendZip().then(function succes(res)\r\n                {\r\n                    toggleSpinner();\r\n                    var el = document.getElementById('sendstatus');\r\n                    el.style.background = 'green';\r\n                    $timeout(function()\r\n                        {\r\n                            el.style.background = 'none';\r\n                        }, 5000);\r\n                    // console.log(\"successful response\",res);\r\n                },function failure(err)\r\n                {\r\n                    var el = document.getElementById('sendstatus');\r\n                    el.style.background = 'red';\r\n                    toggleSpinner();\r\n                   $timeout(function()\r\n                   {\r\n                            el.style.background = 'none';\r\n                        }, 5000);\r\n                    // console.log(\"error from zipservice sending zip\",err);\r\n                });\r\n            }\r\n\r\n            \r\n\r\n\r\n\r\n            function postSnippet()\r\n            {\r\n                StaticDataFactory.postSnippet(vm.currentKey.title).then(function (res)\r\n                {\r\n                    console.log(\"response\", res);\r\n                },\r\n                function (err)\r\n                {\r\n                    console.log(\"response\", err);\r\n                });\r\n            }\r\n\r\n\r\n\r\n\r\n\r\n            function validateXml()\r\n            {\r\n                toggleSpinner();\r\n                ValidationFactory.validateXml(vm.currentKey.title).then\r\n                (\r\n                    function success(res)\r\n                    {\r\n                        vm.validationMessage = res;\r\n                        toggleSpinner();\r\n                        console.log(\"validating....\", vm.validationMessage);\r\n                    }, \r\n                    function failure(err)\r\n                    {\r\n                        toggleSpinner();\r\n                    }\r\n                );\r\n                \r\n            }\r\n\r\n            function changeFontSize()\r\n            {   \r\n                var ed = document.getElementsByClassName('CodeMirror')[0];\r\n                ed.style.fontSize = vm.selectedFontSize.toString() + 'px';\r\n            }\r\n\r\n            //\r\n            //initialisation of editor(triggered by attribute in home.html), datamodel, and cache\r\n            function getTheEditor(_editor)\r\n            {\r\n                editor = EditorFactory.editorLoaded(_editor);\r\n                thedocument = editor.getDoc();\r\n                editor.setOption('hintOptions', {schemaInfo: vm.navigatorModel});\r\n                editor.foldCode(CodeMirror.Pos(0,0));\r\n                editor.foldCode(CodeMirror.Pos(thedocument.lineCount(),0));\r\n                showNav(); \r\n                showConf();\r\n                showConf();\r\n            }\r\n\r\n            //receiving object\r\n            function toggleReadonly(akey)\r\n            {\r\n                // console.log(\"toggling lock\", akey.title, akey.isLocked);\r\n                setReadonly(akey.isLocked);\r\n            }\r\n\r\n            function setReadonly(val)\r\n            {\r\n                editor.setOption('readOnly', val);\r\n            }\r\n\r\n            function unlock(akey)\r\n            {\r\n                setReadonly(false);\r\n            }\r\n\r\n            function changeTheme()\r\n            {\r\n                editor.setOption('theme', vm.selectedTheme);\r\n            }\r\n                \r\n           \r\n\r\n            //console.log(\"retrieved keys\",StorageFactory.getKeys());\r\n            \r\n            function toggleSlot()\r\n            {\r\n                // console.log(\"slot: \", typeof (slot) , vm.currentSlotNumber);\r\n                //opening a slot from the key item in the navigator\r\n                vm.showSpinnerSmall = true;\r\n                $timeout(function()\r\n                {\r\n                    vm.showSpinnerSmall = false;\r\n                }, 1000);\r\n\r\n                //$scope.$emit('saveOldValues');\r\n\r\n                // console.log(\"saving \", StorageFactory.getCurrentKey().title);\r\n                // var thekey = StorageFactory.getGetter(StorageFactory.getCurrentKey().title)();\r\n                // StorageFactory.getSetter(thekey)(thedocument.getValue());\r\n\r\n\r\n\r\n                // console.log(\"getting next document:\");\r\n                var key = StorageFactory.switchKey();\r\n                // console.log(\"returned key\", key);\r\n                $scope.$broadcast('KeySwitch',key);\r\n                retrieveData(key);\r\n                //setReadonly(vm.theslots[vm.currentSlotNumber-1].locked);\r\n                // console.log(\"Current slotprops:\",vm.theslots[vm.currentSlotNumber-1]);\r\n            }\r\n\r\n            function storeData()\r\n            {\r\n                var myalias = StorageFactory.getCurrentKey().title;\r\n                var myvalue = thedocument.getValue();\r\n                var mykey = StorageFactory.getGetter(myalias)();\r\n                // console.log(\"storing data\", myalias, mykey, myvalue);\r\n                StorageFactory.getSetter(mykey)(myvalue);\r\n            }\r\n\r\n            // key is an object\r\n            function retrieveData(alias)\r\n            {\r\n                // console.log(\"Retrieve data, MYTIMER: \", mytimer );   \r\n                if(alias === undefined)\r\n                {\r\n                    alias = StorageFactory.getCurrentKey();\r\n                }\r\n                // console.log(\"alias\", alias);\r\n\r\n                if(StorageFactory.getGetter(alias.title)() === undefined)\r\n                {\r\n                    $timeout(function() \r\n                    {\r\n                       // console.log(\"waiting for StorageFactory to settle...\", Date.now());\r\n                        var thekey = StorageFactory.getGetter(alias.title)();\r\n                        // console.log(\"retrieving data , setting the document value...\", StorageFactory.getGetter(thekey)());\r\n                        thedocument.setValue(StorageFactory.getGetter(thekey)());\r\n                    }, 50);\r\n                }\r\n                else\r\n                {\r\n                    var thekey = StorageFactory.getGetter(alias.title)();\r\n                    //console.log(\"retrieving data and setting the document value...\", StorageFactory.getGetter(thekey)());\r\n                    thedocument.setValue(StorageFactory.getGetter(thekey)());\r\n                }\r\n                if(mytimer === 0 )\r\n                {\r\n                    // console.log(\"restarting timer...\");\r\n                    saveInSlot();\r\n                }\r\n            }\r\n\r\n            //toggles the tabs in the left area;\r\n\r\n            function showConf()\r\n            {\r\n                // var navigat = document.getElementById('navigatorcontainer');\r\n                \r\n                // var fb = document.getElementById('myfilebrowser');\r\n                // var fbsh = document.getElementById('myfilebrowsershadow');\r\n                // var tl = document.getElementById('mytaglibrary');\r\n                // var tlsh = document.getElementById('mytaglibraryshadow');\r\n                \r\n                var navigat = document.getElementById('configcontainer');\r\n                \r\n                var fb = document.getElementById('mytaglibrary');\r\n                var fbsh = document.getElementById('mytaglibraryshadow');\r\n                var tl = document.getElementById('myfilebrowser');\r\n                var tlsh = document.getElementById('myfilebrowsershadow');\r\n                \r\n\r\n                if(vm.showConfig)\r\n                {\r\n                    tl.classList.add('itemactive');\r\n                    tlsh.classList.add('itemshadowactive');\r\n                    fb.classList.add('itemnotactive');\r\n                    fbsh.classList.add('itemshadownotactive');\r\n                    tl.classList.remove('itemnotactive');\r\n                    tlsh.classList.remove('itemshadownotactive');\r\n                    fb.classList.remove('itemactive');\r\n                    fbsh.classList.remove('itemshadowactive');\r\n                    navigat.style.left = \"0%\";\r\n                }\r\n                else\r\n                {\r\n                    tl.classList.add('itemnotactive');\r\n                    tlsh.classList.add('itemshadownotactive');\r\n                    fb.classList.add('itemactive');\r\n                    fbsh.classList.add('itemshadowactive');\r\n                    tl.classList.remove('itemactive');\r\n                    tlsh.classList.remove('itemshadowactive');\r\n                    fb.classList.remove('itemnotactive');\r\n                    fbsh.classList.remove('itemshadownotactive');\r\n                    navigat.style.left = '-25%';\r\n                }\r\n                vm.showConfig = !vm.showConfig;\r\n            }\r\n                \r\n\r\n              //toggles the editor area to 75 or 100%\r\n              function showNav()\r\n              {\r\n                var editor = document.getElementById('editorcontainer');\r\n                \r\n                //console.log(\"items: \",editor);\r\n\r\n                if(vm.showNavigator)\r\n                {\r\n                  editor.style.width = '75%';\r\n                  editor.style.left = '25%';\r\n                }\r\n                else\r\n                {\r\n                  editor.style.width = '100%';\r\n                  editor.style.left = '0%';\r\n                }\r\n                vm.showNavigator = !vm.showNavigator;\r\n              }\r\n\r\n            //responds to the selection of an item in the class Area;\r\n            function setSelectedClass(item)\r\n            {\r\n                vm.selectedItem = item;\r\n                StaticDataFactory.setSelectedItem(item);\r\n                vm.selectedProperties = {};\r\n                \r\n                //checking a default classname property\r\n                for(var i=0 ; i<item.properties.length; i++) {\r\n                    if(item.properties[i][0]=='classname' || item.properties[i][0]=='className') {\r\n                        var checkbox = document.getElementById('checkbox' + i);\r\n                        if(checkbox === null) {\r\n                            break;\r\n                        }\r\n                        checkbox.click();\r\n                        break;\r\n                    }\r\n                }\r\n                showTagInTooltip();\r\n            }\r\n\r\n\r\n\r\n            //responds to the radiobuttons in the dataSource area and switches to pipe, receiver, snippet or general; the first item of \r\n            //the chosen type is selected.\r\n            function toggle_datasource(thetype)\r\n            {\r\n                StaticDataFactory.setDataSource(thetype);\r\n                vm.datasource = StaticDataFactory.getDataSource();\r\n                vm.showPropertyDescription = false;\r\n                \r\n                var done = false;\r\n                var parking = \"zzz\";\r\n                Object.keys(vm.navigatorModel).forEach(function(key)\r\n                {\r\n                    if (!done && vm.navigatorModel[key].type === thetype )\r\n                    {\r\n                        if (key < parking)\r\n                        {\r\n                            parking = key;\r\n                        }\r\n                        //vm.selectedItem = vm.navigatorModel[key];\r\n                        //vm.selectedProperties = {};\r\n                    }\r\n                });\r\n                setSelectedClass(vm.navigatorModel[parking]);\r\n\r\n\r\n                // console.log(\"vm.datasource\", vm.datasource);\r\n            }\r\n\r\n            //empties the editor\r\n            function clearEditor()\r\n            {\r\n                if(editor.getOption('readOnly') === true)\r\n                {\r\n                    return;\r\n                }\r\n                thedocument.setValue(\"<?xml version='1.0' encoding='UTF-8'?>\\n\");\r\n                thedocument.setCursor({line:thedocument.lastLine(),ch:0});\r\n                editor.focus();\r\n            }\r\n\r\n            //Responding to the style button in the navbar\r\n            function styleEditorContent()\r\n            {\r\n                //get the currunt cursor position of the editor; check between which values that is and look that up\r\n                // after reformatting the text to replace the cursor.\r\n                var pos = thedocument.getCursor();\r\n                var before = thedocument.getRange({line:pos.line,ch:0},pos);\r\n                //regex to find tag segment left of the cursor : <[\\w\\/\\s=\\'\\\"]+$|<[\\w\\/\\s=\\'\\\"]+>$\r\n                var beforesegment = before.match(/<[\\w\\/\\s=\\'\\\"]+$|<[\\w\\/\\s=\\'\\\"]+>[\\w\\s]*$/);\r\n                if (beforesegment !== null)\r\n                {\r\n                    before = beforesegment[0];\r\n                }\r\n                var after = thedocument.getRange(pos,{line:pos.line,ch:null});\r\n                //regex to find tag segment to the right of cursor : ^[\\w\\/\\s=\\'\\\"]+>|^<[\\w\\/\\s=\\'\\\"]+> \r\n                var aftersegment = after.match(/^[\\w\\/\\s=\\'\\\"]+>|^<[\\w\\/\\s=\\'\\\"]+>/);\r\n                if (aftersegment !== null)\r\n                {\r\n                    after = aftersegment[0];\r\n                }\r\n\r\n                //search the correct position of the cursor, possibly many similar tags : the index of the search results\r\n                //array is stored\r\n                var cursor = editor.getSearchCursor(before);\r\n                var counter =0 ;\r\n                var original = {line:10000,ch:10000};\r\n                var myindex = -1;\r\n                while (cursor.find() === true)\r\n                {   \r\n                    var newval = cursor.to();\r\n                    if (isTheBetter(pos, newval, original))\r\n                    {\r\n                        original = newval;\r\n                        myindex = counter;\r\n                    }\r\n                    counter++;\r\n                }\r\n                //now that we know we can find the new cursor position we will format the complete text\r\n                var settings = StaticDataFactory.getFormattingSettings();\r\n                thedocument.setValue(html_beautify(thedocument.getValue(),settings));\r\n\r\n                //put the cursor back in place\r\n                cursor = editor.getSearchCursor(before);\r\n                for(var i=0 ; i < myindex+1 ;i++)\r\n                {\r\n                    cursor.find();\r\n                }\r\n                if(cursor.to())\r\n                {\r\n                    thedocument.setCursor(cursor.to());\r\n                }\r\n                editor.focus();\r\n\r\n\r\n                function isTheBetter(newpos, oldpos, standard)\r\n                {\r\n                    var linedifference1 = Math.abs(standard.line - oldpos.line);\r\n                    var linedifference2 = Math.abs(standard.line - newpos.line);\r\n                    if (linedifference1 > linedifference2)\r\n                    {\r\n                        return false;\r\n                    }\r\n                    if(linedifference2 > linedifference1)\r\n                    {\r\n                        return true;\r\n                    }\r\n                    var chardifference1 = Math.abs(standard.ch - oldpos.ch);\r\n                    var chardifference2 = Math.abs(standard.ch - newpos.ch);\r\n                    if (chardifference1 > chardifference2)\r\n                    {\r\n                        return false;\r\n                    }\r\n                    return true;\r\n                }\r\n            }\r\n\r\n\r\n            //determines to check a value in the property area because they are obligatory;\r\n            function checkDefaults(property)\r\n            {\r\n                if(property[0] === 'classname' || property[0] === 'className')\r\n                {\r\n                    vm.selectedProperties[property[0]] = new attributeObject('className', new Array(property[2]));\r\n                    showTagInTooltip();\r\n                    return true;\r\n                }\r\n                return false;\r\n            }\r\n\r\n\r\n/*Responds to the insert ... button in the navBar. The current selected item and the current selected properties are converted\r\nto a string and inserted in the editor;*/\r\n\r\n            function submitForm()\r\n            {\r\n                if (vm.selectedItem === null || editor.getOption('readOnly') === true)\r\n                {\r\n                    return;\r\n                }\r\n                if(vm.selectedItem.type === 'snippets')\r\n                {\r\n                    //console.log(\"selectedItem:\",vm.selectedItem);\r\n                    //loadXml(vm.selectedItem.file);\r\n                    thedocument.replaceSelection(vm.selectedItem.xml);\r\n                }\r\n                else\r\n                {\r\n                    var theproperties = [];    \r\n                    // console.log(\"props:\", vm.selectedProperties);\r\n                    if (Object.keys(vm.selectedProperties).length > 0 )\r\n                    {\r\n                        Object.keys(vm.selectedProperties).forEach(function(thekey)\r\n                        {\r\n                            \r\n                            theproperties.push(vm.selectedProperties[thekey]);\r\n                        }); \r\n                    }\r\n                   var newtag = new xmlTag(vm.selectedItem.classname, theproperties);\r\n                   // console.log(\"the newtag:\", newtag.toCompleteTag());\r\n                    thedocument.replaceSelection(newtag.toCompleteTag());\r\n                    editor.focus();\r\n                }\r\n            }\r\n\r\n            function showTagInTooltip()\r\n            {\r\n                if (vm.selectedItem === null || editor.getOption('readOnly') === true)\r\n                {\r\n                    return;\r\n                }\r\n                if(vm.selectedItem.type === 'snippets')\r\n                {\r\n                    vm.proposedtag = vm.selectedItem.xml;\r\n                }\r\n                else\r\n                {\r\n                    var theproperties = [];    \r\n                    // console.log(\"props:\", vm.selectedProperties);\r\n                    if (Object.keys(vm.selectedProperties).length > 0 )\r\n                    {\r\n                        Object.keys(vm.selectedProperties).forEach(function(thekey)\r\n                        {\r\n                            theproperties.push(vm.selectedProperties[thekey]);\r\n                        }); \r\n                    }\r\n                   var newtag = new xmlTag(vm.selectedItem.classname, theproperties);\r\n                   // console.log(\"newtag:\", newtag.toString());\r\n                   vm.proposedtag = newtag.toCompleteTag();\r\n                }\r\n            }\r\n\r\n\r\n\r\n\r\n        })\r\n\r\n    .controller('LoadCredentialsController', function($uibModalInstance, items)\r\n    {\r\n        console.log(\"loading credentials...\");\r\n        var vm4 = this;\r\n        vm4.iaf_url = null;\r\n        vm4.username = null;\r\n        vm4.password = null;\r\n        vm4.submitCredentials = submitCredentials;\r\n        vm4.closeModal = closeModal;\r\n\r\n        function submitCredentials()\r\n        {\r\n            //console.log(\"returning with credentials...\");\r\n            $uibModalInstance.close({iaf_url:vm4.iaf_url, username: vm4.username, password: vm4.password});\r\n        }\r\n\r\n        function closeModal()\r\n        {\r\n           $uibModalInstance.dismiss();\r\n        }\r\n    })\r\n\r\n\r\n    /*determines which classes are shown in the navigator, based on the JSON item type (pipes, receivers, general or snippets)*/\r\n    .filter('datasourceFilter', function(StaticDataFactory)\r\n    {\r\n        return function(items)\r\n        {\r\n            var filtered = [];\r\n            angular.forEach(items, function(item)\r\n            {\r\n               if (item.type === StaticDataFactory.getDataSource())\r\n                {\r\n                    filtered.push(item);\r\n                }\r\n            });\r\n            //sorting the resulting array of objects on the classname property.\r\n            filtered.sort(function(a,b)\r\n                {\r\n                    var x = a.classname.toLowerCase();\r\n                    var y = b.classname.toLowerCase();\r\n                    if (x < y) {return -1;}\r\n                    if (x > y) {return 1;}\r\n                    return 0;\r\n                });\r\n            return filtered;\r\n        };\r\n    })\r\n\r\n    //replaces escaped tag signs with the proper symbols, used in the description area where sometimes strange symbols appear.\r\n    .filter('typeFilter', function()\r\n    {\r\n        return function(item)\r\n        {\r\n\r\n            if(item !== undefined)\r\n            {\r\n               switch (item)\r\n               {\r\n                case 'pipes':{return 'pipe'}\r\n                case 'receivers':{return 'receiver'}\r\n                case 'snippets':{return 'snippet'}\r\n                case 'general':{return 'tag'}\r\n                default:return '';\r\n               }\r\n            }\r\n        };\r\n    })\r\n\r\n\r\n\r\n\r\n    //replaces escaped tag signs with the proper symbols, used in the description area where sometimes strange symbols appear.\r\n    .filter('cleanupFilter', function()\r\n    {\r\n        return function(item)\r\n        {\r\n\r\n            if(item !== undefined)\r\n            {\r\n                var newstring = item.replace(/&lt;/g,'<');\r\n                var newerstring = newstring.replace(/&gt;/g,'>');\r\n                return newerstring;\r\n            }\r\n        };\r\n    });\r\n\r\n})();\n(function()\r\n{\r\n\t'use strict';\r\n\r\nangular.module('confab')\r\n\r\n/*Part of the file navigator (node_template.html) changing the name of a file of directory neeeds to be updated\r\nIn local storage. For this the old and the new name have to be in one place.*/\r\n.directive('nameGiver', function(StorageFactory)\r\n        {\r\n            return{\r\n                restrict:\"A\",\r\n                link : function(scope, el , attrs)\r\n                {\r\n                    \r\n\r\n                    el.bind('blur' , function(event)\r\n                    {\r\n                        var digit = event.target.id.match(/\\d+/g)[0];\r\n                        console.log(\"digit\", digit, event.target.id);\r\n                        var element = document.getElementById('treeitem' + digit);\r\n                        var text = element.innerHTML;\r\n                        var thelist = scope.vm2.list;\r\n                        console.log(\"text\",text, thelist, digit);\r\n                        traverseArray(thelist);\r\n\r\n                        function traverseArray(sublist)\r\n                        {\r\n                            for(var i = 0 ; i<sublist.length; i++)\r\n                            {\r\n\r\n                                console.log(sublist[i].title,sublist[i].id);\r\n                                //compares int with a string, so NOT === in the comparator\r\n                                if(sublist[i].id == digit) \r\n                                {\r\n\r\n                                    /*check if there's no sibling node with the same title, otherwise\r\n                                    we will get name collisions and data loss in the local storage*/\r\n                                    var theobject = angular.element(element).scope();\r\n                                    // console.log(\"siblings: \", theobject.$parentNodesScope.$modelValue);\r\n                                    var siblings = theobject.$parentNodesScope.$modelValue;\r\n                                    for(var s = 0 ; s < siblings.length; s++)\r\n                                    {\r\n                                        if(siblings[s].title == text)\r\n                                        {\r\n                                            element.innerHTML = cropFilter(theobject.$modelValue.title);\r\n                                            alert(\"please no double names in this directory!\");\r\n                                            return;\r\n                                        }\r\n                                    }\r\n\r\n                                    sublist[i].title = text;\r\n                                    // console.log(\"match\", sublist[i], text, scope.vm2.mySlots);\r\n                                    if(!(sublist[i].isDirectory))\r\n                                    {\r\n                                        //changing a filename changes the alias of a storageslot;\r\n                                        //\"oldname:slot1\" has to become \"newname:slot1\"\r\n                                        var theslot = StorageFactory.getGetter(scope.vm2.mySlots[digit].title)();\r\n                                        var oldalias = scope.vm2.mySlots[digit].title;\r\n                                        StorageFactory.changeKeys(oldalias,text);//keeping track of keys array and currentkey\r\n                                        StorageFactory.getSetter(oldalias)();//removing old alias\r\n                                        StorageFactory.getSetter(text)(theslot);//adding the new value\r\n                                        scope.vm2.mySlots[digit].title = text; //updating the current working files\r\n                                        var myslots = StorageFactory.getGetter(\"myslots\")();\r\n                                        myslots[digit].title = text;\r\n                                        StorageFactory.getSetter(\"myslots\")(myslots);//updating the working files in localstorage\r\n                                    }\r\n                                    element.setAttribute('contentEditable', false);\r\n                                    scope.$apply();\r\n                                    StorageFactory.getSetter(\"thejson\")(scope.vm2.list);//saving changed json\r\n                                    break;\r\n                                }\r\n                                if(sublist[i].nodes.length > 0)\r\n                                {\r\n                                    traverseArray(sublist[i].nodes);\r\n                                }\r\n                            }\r\n                        }\r\n\r\n                        function cropFilter(item)\r\n                        {\r\n                            if(item === undefined) return \"\";\r\n                            var helper = item.substring(item.lastIndexOf('/') + 1 ,item.length);\r\n                            if(helper.length > 0)\r\n                            {\r\n                                return helper;\r\n                            }\r\n                            else\r\n                            {\r\n                                return item;\r\n                            }\r\n                        }\r\n\r\n\r\n                    });\r\n                    el.bind('keydown',function(event)\r\n                    {\r\n                        var code = event.which || event.keyCode || eventt.charCode ;\r\n                        if (code === 13)// enter key\r\n                        {\r\n                            event.preventDefault();\r\n                            var element = document.getElementById('treeitem'+event.target.id.match(/\\d+/g));\r\n                            element.blur();\r\n                        } \r\n                    });\r\n                }\r\n            };\r\n        })\r\n\r\n.directive('propertyListener', function(attributeObject)\r\n{\r\n\t\r\n\treturn{\r\n\t\tlink : function(scope, elem, attrs)\r\n\t\t{\r\n\t\t\telem.bind('click', function(event)\r\n\t\t\t{\r\n\t\t\t\tvar heading = document.getElementById('propertyheader');\r\n\t\t\t\tvar text = document.getElementById('propertytext');\r\n\t\t\t\tconsole.log(\"clicked property\", event.target.id, heading.innerHTML);\r\n\t\t\t\tvar itemnumber = event.target.id.match(/\\d+$/)[0];\r\n\t\t\t\tvar data = scope.vm.selectedItem.properties[itemnumber];\r\n\t\t\t\theading.innerHTML = data[0];\r\n\t\t\t\ttext.innerHTML = data[1];\r\n\r\n\t\t\t\tvar elemt = document.getElementById('checkbox' + itemnumber);\r\n\t\t\t\tvar input = document.getElementById('propertyvalue' + itemnumber);\r\n\t\t\t\tvar item = scope.vm.selectedItem;\r\n\r\n\t\t\t\tconsole.log(\"items:\", elemt, input, item);\r\n\r\n\t\t\t\t/* a checked checkbox will be written onto vm.selectedProperties,\r\n\t\t\t\twhen it is unchecked we will want to remove it from there. */\r\n\t\t\t\t\r\n\t\t\t\tif(typeof (elemt) === 'object')\r\n\t\t\t\t\tswitch (elemt.checked)\r\n\t\t\t\t\t{\r\n\t\t\t\t\t\tcase true :\r\n\t\t\t\t\t\t{\r\n\t\t\t\t\t\t\tconsole.log(\"adding ...\");\r\n\t\t\t\t\t\t\tscope.vm.selectedProperties[data[0]] = new attributeObject(data[0], new Array(input.value));\r\n\t\t\t\t\t\t\tbreak;\r\n\t\t\t\t\t\t}\r\n\r\n\t\t\t\t\t\tcase false : \r\n\t\t\t\t\t\t{\r\n\t\t\t\t\t\t\tconsole.log(\"deleting ...\");\r\n\t\t\t\t\t\t\tdelete scope.vm.selectedProperties[data[0]];\r\n\t\t\t\t\t\t\tbreak;\r\n\t\t\t\t\t\t}\r\n\t\t\t\t\t}\r\n\t\t\t\tconsole.info(\"selected properties\",scope.vm.selectedProperties);\r\n                scope.vm.showTagInTooltip();\r\n\t\t\t});\r\n\t\t}\r\n\r\n\t};\r\n})\r\n\r\n\r\n/*event: set up a function that starts in 1000ms; in this function the position of the\r\npopup is calculated; starttime is noted */\r\n\r\n.directive('popupPlacement',function($timeout)\r\n{\r\n    return{\r\n        restrict:\"A\",\r\n        link: function (scope, element, attrs)\r\n        {\r\n         var mytimer;\r\n         var oldtime = Date.now();   \r\n           element.bind('scroll',function(event)\r\n           {\r\n                var starttime = Date.now();\r\n                if(starttime - oldtime > 1000)\r\n                {\r\n                    startCalc();\r\n                    oldtime = starttime;\r\n                }\r\n                else\r\n                {\r\n                    try {\r\n                        mytimer.cancel();\r\n                    } catch(e) {\r\n                        console.log(e);\r\n                    }\r\n                    oldtime = starttime;\r\n                }\r\n               });\r\n\r\n                function startCalc()\r\n                {\r\n                    \r\n                    mytimer = $timeout(function()\r\n                    {\r\n                        var containerbottom = document.getElementsByClassName('descriptionArea')[0].getBoundingClientRect().bottom;\r\n                        console.log(\"starting function...\");\r\n                        var hasprop = true;\r\n                        var index = 0;\r\n                        var element;\r\n                        while(hasprop)\r\n                        {\r\n                            var propname = \"popover\" + index;\r\n                            element = document.getElementById(propname);\r\n                            if(element)\r\n                            {\r\n                                var theelementtop =  element.getBoundingClientRect().top;\r\n                                var difference = theelementtop - containerbottom;\r\n                                console.log(\"difference\", propname,\" \", difference);\r\n                                if(difference > 0 && difference < 300 )\r\n                                {\r\n                                    console.log(\"bottom\");\r\n                                    element.setAttribute('popover-placement','bottom-left');\r\n                                }\r\n                                else\r\n                                {\r\n                                    console.log(\"top\");\r\n                                    element.setAttribute('popover-placement','top-left');\r\n                                }\r\n                                index++;\r\n                            }\r\n                            else\r\n                            {\r\n                                console.log(\"no element...\");\r\n                                hasprop = false;\r\n                            }\r\n                        }\r\n                    },1000);\r\n\r\n\r\n                }\r\n        }\r\n    };\r\n})\r\n\r\n\t/* \r\n\t when the change on the contenteditable happens the model binding has to\r\n     be invoked; also the property is a key in the attrs object ; so the old key name\r\n     is replaced by the new one here since at this place only the old and the new\r\n     value come together.\r\n     */\r\n.directive(\"contenteditable\", function() {\r\n  return {\r\n    restrict: \"A\",\r\n    require: \"ngModel\",\r\n    link: function(scope, element, attrs, ngModel) {\r\n\r\n      function read() {\r\n        ngModel.$setViewValue(element.html());\r\n      }\r\n\r\n      ngModel.$render = function() {\r\n        element.html(ngModel.$viewValue || \"\");\r\n      };\r\n      \r\n      element.bind(\"keyup change\", function(event) \r\n      {\r\n        console.log(\"changing property......\");\r\n        var el = event.target.id;\r\n        if(el !== 'newproperty' && el !== 'newclassname' && el !== 'newdescription')\r\n        {\r\n\t        var oldvalue = scope.vm3.selectedItem.properties[scope.vm3.selectedProperty][0];\r\n\t        scope.$apply(read);\r\n\t        var newvalue = scope.vm3.selectedItem.properties[scope.vm3.selectedProperty][0];\r\n\t        var theattrs = scope.vm3.selectedItem.attrs;\r\n\t        if(newvalue !== oldvalue)\r\n\t        {\r\n\t        \tObject.defineProperty(theattrs, newvalue,\r\n\t        \tObject.getOwnPropertyDescriptor(theattrs, oldvalue));\r\n\t        \tdelete theattrs[oldvalue];\r\n\t        }\r\n        }\r\n        else if(el !== 'newclassname'){\r\n            console.log(\"new  name for item: \", el);\r\n        \t//scope.$apply(read);\r\n        }\r\n      });\r\n      element.bind(\"blur\", function(event) \r\n      {\r\n        console.log(\"changing classname......\");\r\n        var el = event.target.id;\r\n        \r\n        if(el === 'newclassname') \r\n        {\r\n            var oldvalue = (scope.vm3.selectedItem.classname);\r\n            scope.$apply(read);\r\n            var newvalue = (scope.vm3.selectedItem.classname);\r\n            delete scope.vm3.dataModel[oldvalue];\r\n            scope.vm3.dataModel[newvalue] = scope.vm3.selectedItem;\r\n        }      \r\n        else{\r\n            scope.$apply(read);\r\n        }\r\n      });\r\n\r\n    }\r\n  };\r\n});\r\n\r\n\r\n\r\n}());\n(function()\r\n{\r\n\t'use strict';\r\n\t var appl = angular.module('confab');\r\n\t//TODO add a view and controller functionality to add items to the children array\r\n\tappl.controller('ModeratorController', function($scope, StaticDataFactory, $uibModal, $timeout, StorageFactory, ModeratorFactory, UserFactory)\r\n\t{\r\n\t\tvar vm3 = this;\r\n\t\tvm3.showModel = showModel;\r\n\t\tvm3.deleteProperty = deleteProperty;\r\n\t\tvm3.changeAttr = changeAttr;\r\n\t\tvm3.addProperty = addProperty;\r\n\t\tvm3.addNewClass = addNewClass;\r\n\t\tvm3.saveItem = saveItem;\r\n\t\tvm3.postJsonBulk = postJsonBulk;\r\n\t\tvm3.confirmDelete = confirmDelete;\r\n\t\tvm3.newSnippet = newSnippet;\r\n\t\t\r\n\t\tvm3.user = UserFactory.getCurrentUser();\r\n\t\tvm3.thexml = null;\r\n\r\n\t\t//vm3.dataModel = JSON.parse(StaticDataFactory.getStaticJson());\r\n\t\tconsole.log(vm3.dataModel);\r\n\t\tvm3.currentSlotNumber = null; //TODO extract slots from localstorage\r\n\t\tvm3.showPropertyDescription= false;\r\n\t\tvm3.selectedProperty = 0;\r\n\t\tvm3.addingProperty = false;\r\n\t\tvm3.newProperty = null;\r\n\t\tvm3.addingItem = false;\r\n\t\tvm3.slotlist=[];\r\n\t\tvar helper = StorageFactory.getListOfFiles();\r\n\t\thelper.forEach(function(val)\r\n\t\t{\r\n\t\t\tvm3.slotlist.push({file:val});\r\n\t\t});\r\n\r\n\t\tvm3.file={};\r\n\t\t// vm3.selectedFile=vm3.slotlist[0];\r\n\t\t// console.log(\"files\", vm3.slotlist);\r\n\r\n\t\t// if (vm3.dataModel === null)\r\n\t\t// {\r\n\t\tconsole.log(\"resolving data from iaf data:\" );\r\n\r\n\t\tStaticDataFactory.getJson().then(function success(response)\r\n\t\t{\r\n\t\t\t$('#theprops').mCustomScrollbar({theme:\"minimal\"});\r\n\t\t\t$('#xmlwrapper1').mCustomScrollbar({theme:\"minimal\"});\r\n\t\t\t$('#xmlwrapper2').mCustomScrollbar({theme:\"minimal\"});\r\n\t\t\tconsole.log(\"response\",response);\r\n\t\t\tvar helper = JSON.parse(response.data.JSONMONSTER.MYMONSTER);\r\n\t\t\tvm3.dataModel = [];\r\n\t\t\tObject.keys(helper).forEach(function(value)\r\n\t\t\t{\r\n\t\t\t\tvm3.dataModel.push(helper[value]);\r\n\t\t\t});\r\n\t\t\tvm3.selectedItem = vm3.dataModel[0];\r\n\t\t\t// console.log(\"data\", vm3.selectedItem, vm3.dataModel);\r\n\t\t},\r\n\t\tfunction error(err)\r\n\t\t{\r\n\t\t\tconsole.log(\"error\");\r\n\t\t});\r\n\t\t// }\r\n\t\t// else\r\n\t\t// {\r\n\t\t// \t$('propArea').mCustomScrollbar({theme:\"minimal\"});\r\n\t\t// \tvm3.selectedItem = StaticDataFactory.getSelectedItem();\r\n\t\t// \tconsole.log(\"data\", vm3.selectedItem, vm3.dataModel);\r\n\t\t// }\r\n\r\n\r\n\t\tfunction newSnippet()\r\n\t\t{\r\n\t\t\tconsole.log(\"chosen  file :\", vm3.file.selected.file, vm3.file);\r\n\t\t\tvar slot = StorageFactory.getGetter(vm3.file.selected.file)();\r\n\t\t\tvar thename = cropFilter(vm3.file.selected.file);\r\n\t\t\tthename = thename.split('.')[0];\r\n\t\t\tif (thename === null)\r\n\t\t\t{\r\n\t\t\t\tthename = slot;\r\n\t\t\t}\r\n\t\t\tvm3.thexml = StorageFactory.getGetter(slot)();\r\n\t\t\tvm3.newProperty = null;\r\n\t\t\tvm3.addingProperty = false;\r\n\t\t\tvm3.addingItem = true;\r\n\t\t\tvm3.dataModel.push({classname:thename,description:\"enter your description here\", type:\"snippets\",xml:vm3.thexml, attrs:{},properties:[]});\r\n\t\t\tvm3.selectedItem = vm3.dataModel[vm3.dataModel.length-1];\r\n\t\t\tconsole.log(\"thename: \", vm3.dataModel);\r\n\t\t}\r\n\r\n\t\tfunction cropFilter(item)\r\n        {\r\n            if(item === undefined) return \"\";\r\n            var helper = item.substring(item.lastIndexOf('/') + 1 ,item.length);\r\n            if(helper.length > 0)\r\n            {\r\n                return helper;\r\n            }\r\n            else\r\n            {\r\n                return item;\r\n            }\r\n        }\r\n\r\n\r\n\t\tfunction postJsonBulk()\r\n\t\t{\r\n\t\t\tModeratorFactory.postJsonBulk(vm3.selectedItem.description);\r\n\t\t}\r\n\r\n\t\t\r\n\r\n\t\tfunction deleteItem()\r\n\t\t{\r\n\t\t\ttoggleSpinner();\r\n\t\t\tModeratorFactory.deleteItem(vm3.selectedItem.classname).then(function succcess(res)\r\n\t\t\t{\r\n\t\t\t\tconsole.log(res);\r\n\t\t\t\ttoggleSpinner();\r\n\t\t\t\tvar el = document.getElementById('sendstatususers');\r\n                el.style.background = 'green';\r\n                $timeout(function()\r\n                {\r\n                    el.style.background = 'none';\r\n                }, 5000);\r\n\t\t\t\tconsole.log(\"success\",res);\r\n\t\t\t\tvar parking = vm3.selectedItem.classname;\r\n\t\t\t\tdelete vm3.dataModel[parking];\r\n\t\t\t\tvm3.selectedItem = vm3.dataModel[Object.keys(vm3.dataModel)[0]];\r\n\t\t\t},\r\n\t\t\tfunction fail(err)\r\n\t\t\t{\r\n\t\t\t\tconsole.log(err);\r\n                toggleSpinner();\r\n\t\t\t\tvar el = document.getElementById('sendstatusmod');\r\n                el.style.background = 'red';\r\n                $timeout(function()\r\n                {\r\n                    el.style.background = 'none';\r\n                }, 5000);\r\n\t\t\t});\r\n\t\t}\r\n\r\n\t\tfunction postJsonMonster()\r\n\t\t{\r\n\t\t\tconsole.log(\"JSONMONSTER\\n\",JSON.stringify(vm3.dataModel));\r\n\t\t}\r\n\r\n\r\n\r\n\t\tfunction addNewClass()\r\n\t\t{\r\n\t\t\tvm3.newProperty = null;\r\n\t\t\tvm3.addingProperty = false;\r\n\t\t\tvm3.addingItem = true;\r\n\t\t\tvm3.dataModel.push({classname:\"NEWITEM\", description:\"enter your description here\", type:\"general\",xml:\"\", attrs:{},properties:[]})\r\n\t\t\tvm3.selectedItem = vm3.dataModel[vm3.dataModel.length-1];\r\n\t\t}\r\n\r\n\r\n\t\tfunction changeAttr(index)\r\n\t\t{\r\n\t\t\tvm3.selectedItem.attrs[vm3.selectedItem.properties[index][0]] = new Array(vm3.selectedItem.properties[index][2]);\r\n\t\t}\r\n\r\n\t\tfunction addProperty(string)\r\n\t\t{\r\n\t\t\tswitch(string)\r\n\t\t\t{\r\n\t\t\t\tcase 'add':\r\n\t\t\t\t{\r\n\t\t\t\t\tvm3.newProperty = {propname:\"new_property\",propdes:\"replace with your description\",propdef:\"\"};\r\n\t\t\t\t\tbreak;\r\n\t\t\t\t}\r\n\t\t\t\tcase 'cancel':\r\n\t\t\t\t{\r\n\t\t\t\t\tvm3.newProperty = null;\r\n\t\t\t\t\tbreak;\r\n\t\t\t\t}\r\n\t\t\t\tcase 'confirm':\r\n\t\t\t\t{\r\n\t\t\t\t\tif(vm3.newProperty.propname === \"\" || vm3.newProperty.propdes === \"\")\r\n\t\t\t\t\t{\r\n\t\t\t\t\t\treturn;\r\n\t\t\t\t\t}\r\n\t\t\t\t\tvm3.selectedItem.attrs[vm3.newProperty.propname] = new Array(vm3.newProperty.propdef);\r\n\t\t\t\t\tvm3.selectedItem.properties.unshift(new Array(vm3.newProperty.propname,vm3.newProperty.propdes,vm3.newProperty.propdef));\r\n\t\t\t\t\tvm3.newProperty = null;\r\n\t\t\t\t\tbreak;\r\n\t\t\t\t}\r\n\t\t\t\tdefault:\r\n\t\t\t\t{\r\n\t\t\t\t\tbreak;\r\n\t\t\t\t}\r\n\t\t\t}\r\n\t\t}\r\n\r\n\t\tfunction toggleSpinner()\r\n\t\t{\r\n\t\t\tvm3.showSpinner = !vm3.showSpinner;\r\n\t\t}\r\n\r\n\t\tfunction deleteProperty(index)\r\n\t\t{\r\n\t\t\tconsole.log(\"deleting property\", index, vm3.selectedItem.properties[index][0]);\r\n\t\t\tdelete vm3.selectedItem.attrs[vm3.selectedItem.properties[index][0]];\r\n\t\t\tvm3.selectedItem.properties.splice(index,1);\r\n\t\t}\r\n\r\n\t\tfunction showModel()\r\n\t\t{\r\n\r\n\t\t\t//vm3.displayItem = JSON.stringify(vm3.selectedItem,['properties'],4);\r\n\t\t\t//console.log(vm.displayItem);\r\n\t\t\tvar modalInstance = $uibModal.open(\r\n\t\t\t{\r\n\t\t\t\ttemplateUrl : \"./views/itemcontents.html\",\r\n\t\t\t\tcontroller : \"ModalController as vm5\",\r\n\t\t\t\twindowClass : \"mymodal\",\r\n\t\t\t\tresolve : {items : function ()\r\n\t\t\t\t\t{\r\n\t\t\t\t\t\treturn vm3.selectedItem;\r\n\t\t\t\t\t}}\r\n\t\t\t});\r\n\t\t}\r\n\r\n\t\tfunction saveItem()\r\n\t\t{\r\n\t\t\ttoggleSpinner();\r\n\t\t\tModeratorFactory.postDatamonster(vm3.dataModel,vm3.selectedItem).then(function success(res)\r\n\t\t\t{\r\n\t\t\t\ttoggleSpinner();\r\n\t\t\t\tvar el = document.getElementById('sendstatusmod');\r\n                el.style.background = 'green';\r\n                $timeout(function()\r\n                {\r\n                    el.style.background = 'none';\r\n                }, 5000);\r\n\t\t\t\tconsole.log(\"success\",res);\r\n\t\t\t}, \r\n\t\t\tfunction fail(err)\r\n\t\t\t{\r\n\t\t\t\ttoggleSpinner();\r\n\t\t\t\tvar el = document.getElementById('sendstatusmod');\r\n                el.style.background = 'red';\r\n                toggleSpinner();\r\n                $timeout(function()\r\n                {\r\n                    el.style.background = 'none';\r\n                }, 5000);\r\n\t\t\t\tconsole.log(\"fail\",err);\r\n\t\t\t});\r\n\t\t}\r\n\r\n\r\n\t\tfunction confirmDelete()\r\n\t\t{\r\n\r\n\t\t\tvar modalInstance = $uibModal.open(\r\n\t\t\t{\r\n\t\t\t\ttemplateUrl : \"./views/modal_delete_item.html\",\r\n\t\t\t\tanimation : true,\r\n\t\t\t\tcontroller : \"Modal2Controller as vm6\",\r\n\t\t\t\tsize : \"sm\",\r\n\t\t\t\tbackdrop : \"static\",\r\n\t\t\t\tresolve : \r\n\t\t\t\t{\r\n\t\t\t\t\titem : function ()\r\n\t\t\t\t\t{\r\n\t\t\t\t\t\treturn vm3.selectedItem;\r\n\t\t\t\t\t}\r\n\t\t\t\t}\r\n\t\t\t}).result.then(function(result)\r\n\t\t\t{\r\n\t\t\t\tconsole.log(\"result:\", result);\r\n\t\t\t\tif(result === 'delete')\r\n\t\t\t\t{\r\n\t\t\t\t\ttoggleSpinner();\r\n\t\t\t\t\tModeratorFactory.deleteItem(vm3.selectedItem.classname).then(function succcess(res)\r\n\t\t\t\t\t{\r\n\t\t\t\t\t\ttoggleSpinner();\r\n\t\t\t\t\t\tvar parking = vm3.selectedItem.classname;\r\n\t\t\t\t\t\tconsole.log(\"response from service: \", res, parking);\r\n\t\t\t\t\t\tvar index = -1;\r\n\t\t\t\t\t\tfor(var i=0 ; i<vm3.dataModel.length; i++)\r\n\t\t\t\t\t\t{\r\n\t\t\t\t\t\t\tconsole.log(\"iterating\",vm3.dataModel[i].classname);\r\n\t\t\t\t\t\t\tif(vm3.dataModel[i].classname === parking)\r\n\t\t\t\t\t\t\t{\r\n\t\t\t\t\t\t\t\tindex = i;\r\n\t\t\t\t\t\t\t\tconsole.log(\"deleted index...\", index);\r\n\t\t\t\t\t\t\t\tbreak;\r\n\t\t\t\t\t\t\t}\r\n\t\t\t\t\t\t}\r\n\t\t\t\t\t\t\r\n\t\t\t\t\t\tif(index !== -1)\r\n\t\t\t\t\t\t{\r\n\t\t\t\t\t\t\tdelete vm3.dataModel[index];\r\n\t\t\t\t\t\t}\r\n\t\t\t\t\t\tvm3.selectedItem = vm3.dataModel[Object.keys(vm3.dataModel)[0]];\r\n\t\t\t\t\t\tsaveItem();\r\n\t\t\t\t\t},\r\n\t\t\t\t\tfunction fail(err)\r\n\t\t\t\t\t{\r\n\t\t\t\t\t\ttoggleSpinner();\r\n\t\t\t\t\t\tconsole.log(err);\r\n\t\t\t\t\t});\r\n\t\t\t\t}\r\n\t\t\t});\r\n\t\t}\r\n\r\n\t})\r\n\t\r\n\t.controller('ModalController', function($uibModalInstance, items)\r\n\t{\r\n\t\tvar vm5 = this;\r\n\t\tvm5.closeModal = closeModal;\r\n\t\tvm5.items = JSON.stringify(items,null, 4);\r\n\r\n\t\tfunction closeModal()\r\n\t\t{\r\n\t\t\t$uibModalInstance.close();\r\n\r\n\t\t}\r\n\t})\r\n\r\n\t.controller('Modal2Controller', function($uibModalInstance, item)\r\n\t{\r\n\t\tvar vm6 = this;\r\n\t\tvm6.closeModal = closeModal;\r\n\t\tvm6.deleteItem = deleteItem;\r\n\t\tvm6.item = item;\r\n\r\n\t\tfunction closeModal()\r\n\t\t{\r\n\t\t\t$uibModalInstance.close(\"cancel\");\r\n\t\t}\r\n\r\n\t\tfunction deleteItem()\r\n\t\t{\r\n\t\t\t$uibModalInstance.close(\"delete\");\r\n\t\t}\r\n\t});\r\n}());\n(function()\r\n{\r\n\t'use strict';\r\n\r\n\tvar applicc = angular.module('confab');\r\n\tapplicc.factory('ModeratorFactory', function($http, StorageFactory, IAF_URL)\r\n\t{\r\n\t\treturn{\r\n\t\t\tpostJsonBulk : postJsonBulk,\r\n\t\t\tpostDatamonster : postDatamonster,\r\n\t\t\tpostSchema : postSchema,\r\n\t\t\tdeleteItem : deleteItem,\r\n\t\t\tgetListOfFiles : getListOfFiles\r\n\t\t\t\r\n\t\t};\r\n\r\n\t\tfunction getListOfFiles()\r\n\t\t{\r\n\t\t\treturn StorageFactory.getListOfFiles();\r\n\t\t}\r\n\r\n\t\tfunction postJsonBulk(json)\r\n\t\t{\r\n\t\t\ttry\r\n\t\t\t{\r\n\t\t\t\t$http.post(IAF_URL + '/api/postJsonBulk', json).then(function success(resp)\r\n\t\t\t\t\t{\r\n\t\t\t\t\t\tconsole.log(\"success\",resp);\r\n\t\t\t\t\t},\r\n\t\t\t\t\tfunction failure(err)\r\n\t\t\t\t\t{\r\n\t\t\t\t\t\tconsole.log(\"failure\",err);\r\n\t\t\t\t\t});\r\n\t\t\t}\r\n\t\t\tcatch(err)\r\n\t\t\t{\r\n\t\t\t\talert (\"improper json\\n\",err);\r\n\t\t\t}\r\n\t\t}\r\n\r\n\r\n\t\t\r\n\r\n        \r\n        function convertXml(thexml)\r\n        {\r\n          \t//console.log(\"slot to convert to json:\", StorageFactory.getGetter(slot)());\r\n         \treturn $http({method:\"POST\",url: IAF_URL + '/convertToJson',data: thexml ,headers:{\"Content-Type\":'application/xml'} }).then(function(data)\r\n\t        {\r\n\t          return data;\r\n\t        },function(error)\r\n\t        {\r\n\t          console.log(\"error loading xml\", error);\r\n\t        });\r\n        }\r\n\r\n\r\n\t\tfunction postSchema()\r\n\t\t{\r\n\t\t\t\r\n\t\t}\r\n\r\n\t\tfunction postDatamonster(datamonster, thetag)\r\n        {\r\n          console.log(\"posting a monster with length \", Object.keys(datamonster).length);\r\n          console.log(\"TAG\", thetag);\r\n          \r\n          \t  //var helper = JSON.stringify(datamonster);\r\n          \t  //converting array to an object :\r\n          \t  var obj = {};\r\n          \t  datamonster.forEach(function(item)\r\n          \t  {\r\n          \t  \tobj[item.classname] = item;\r\n          \t  });\r\n          \t  console.log(\"object:\", obj);\r\n\r\n          \t  return  $http({method:\"POST\",url:IAF_URL +'/api/storejson',data:obj, headers:{'responseType':'Json'}}).then(function success(resp)\r\n\t          {\r\n\t            console.log(\"saving result\", resp.status);\r\n\t            postTag(thetag);\r\n\t          },\r\n\t          function failure(err)\r\n\t          {\r\n\t            console.log(\"failed result posting datamonster\", err.status);\r\n\t          });\r\n        }\r\n\r\n        function postTag(object)\r\n        {\r\n        \tvar tag = {'classname':object.classname,'thetag':object, 'modificationdate':Date.now()};\r\n        \tconsole.log(\"tag: \", tag);\r\n        \treturn  $http.post(IAF_URL +'/api/postiaftag', tag).then(function success(resp)\r\n\t          {\r\n\t            console.log(\"saving a tag\", resp.status);\r\n\t          },\r\n\t          function failure(err)\r\n\t          {\r\n\t            console.log(\"failed result posting tag\", err.status);\r\n\t          });\r\n        }\r\n\r\n\t\t//TODO delete item directly in mongodb\r\n\t\tfunction deleteItem(classname)\r\n\t\t{\r\n\t\t\treturn $http({method:\"GET\", url: IAF_URL + '/api/deleteiaftag/' + classname }).then(\r\n\t\t\t\tfunction success(res)\r\n\t\t\t\t{\r\n\t\t\t\t\treturn res;\r\n\t\t\t\t}, \r\n\t\t\t\tfunction failure(err)\r\n\t\t\t\t{\r\n\t\t\t\t\treturn err;\r\n\t\t\t\t});\r\n\t\t}\r\n\r\n\t});\r\n}());\n(function(){\r\n\r\n'use strict';\r\n    var app = angular.module('confab');\r\n    \r\n    app.constant('UPLOAD_URL',\"/iaf/api/configurations\");\r\n    \r\n    //Setting the IAF_URL constant depending on the stage we're in.\r\n    getIAFConstant();\r\n    \r\n    function getIAFConstant()\r\n    {\r\n      var theurl = window.location.hostname;\r\n      switch(theurl)\r\n      {\r\n        case \"localhost\" :\r\n        {\r\n          var completeurl = window.location.href;\r\n          app.constant('IAF_URL', completeurl.split('/iaf/')[0]);\r\n          break;\r\n        }\r\n        case \"ibis4education-env.bz46fawhzf.eu-central-1.elasticbeanstalk.com\":\r\n        {\r\n          app.constant('IAF_URL', \"http://ibis4education-env.bz46fawhzf.eu-central-1.elasticbeanstalk.com\"); \r\n          break;\r\n        }\r\n        case \"ibis4edproduction-env.c4weisckkn.eu-central-1.elasticbeanstalk.com\":\r\n        {\r\n          app.constant('IAF_URL', \"http://ibis4edproduction-env.c4weisckkn.eu-central-1.elasticbeanstalk.com\"); \r\n          break;\r\n        }\r\n        default :\r\n        {\r\n          // app.constant('IAF_URL', \"http://localhost:8080/ibis4integration\");\r\n          app.constant('IAF_URL', \"http://localhost:8080/Ibis4Education\");\r\n          break;\r\n        }\r\n      }\r\n    }\r\n\r\n\r\n    app.factory('StaticDataFactory', function($q, xmlTag, $http, StorageFactory, $interval, IAF_URL) \r\n    {\r\n      console.log(\"StaticDatafactory...\");\r\n\r\n        var datasource = 'pipes';\r\n        var themes = [\"twilight\", \"monokai\", \"neat\"];\r\n        var fontSizes = [12,13,14,15,16,17,18,19,20];\r\n        var thejson = null;\r\n        var selectedItem = null;\r\n        var projectname = null;\r\n        var reqparams = null;\r\n        var formattingSettings = {\r\n                \"indent_size\": 4,\r\n                \"xml\": {\r\n                    \"end_with_newline\": true,\r\n                    \"js\": {\r\n                        \"indent_size\": 2\r\n                    },\r\n                    \"css\": {\r\n                        \"indent_size\": 2\r\n                    }\r\n                },\r\n                \"css\": {\r\n                    \"indent_size\": 1\r\n                },\r\n                \"js\": {\r\n                 \"preserve-newlines\": true\r\n                }\r\n                };\r\n\r\n        return{\r\n            getJson : getJson,\r\n            getStaticJson : getStaticJson,\r\n            setDataSource: setDataSource,\r\n            getDataSource: getDataSource,\r\n            getFormattingSettings: getFormattingSettings,\r\n            getThemes: getThemes,\r\n            getFontSizes: getFontSizes,\r\n            setSelectedItem : setSelectedItem,\r\n            getSelectedItem : getSelectedItem,\r\n            getProjectName :getProjectName,\r\n            setProjectName : setProjectName,\r\n            setReqParams : setReqParams ,\r\n            getReqParams : getReqParams\r\n\r\n        };\r\n        \r\n        function setReqParams(instance, vers)\r\n        {\r\n        \treqparams = {\"instancename\":instance,\"version\":vers}\r\n        \tconsole.log(\"iaf url: \", IAF_URL, this.reqparams);\r\n        }\r\n        \r\n        function getReqParams()\r\n        {\r\n        \t//console.log(\"returning params: \");\r\n        \treturn(reqparams);\r\n        }\r\n        \r\n        \r\n        function getProjectName()\r\n        {\r\n          //console.log(\"returning projectname: \", projectname);\r\n          return projectname;\r\n        }\r\n\r\n        function setProjectName(name)\r\n        {\r\n          //console.log(\"setting projectname: \", projectname);\r\n          projectname = name;\r\n        }\r\n\r\n        function setSelectedItem(item)\r\n        {\r\n          selectedItem = item;\r\n        }\r\n\r\n         function getSelectedItem()\r\n        {\r\n          return selectedItem;\r\n        }\r\n\r\n        function getThemes()\r\n        {\r\n          return themes;\r\n        }\r\n\r\n        function getFontSizes()\r\n        {\r\n          return fontSizes;\r\n        }\r\n\r\n        function getFormattingSettings()\r\n        {\r\n          return formattingSettings;\r\n        }\r\n\r\n\r\n        function setDataSource(string)\r\n        {\r\n          datasource = string;\r\n        }\r\n\r\n        function getDataSource()\r\n        {\r\n          return datasource;\r\n        }\r\n\r\n\r\n          /* data is available directly in the response\r\n          */\r\n        function getJson()\r\n        { \r\n\r\n          return $http.get('https://ibissource.org/eddie/jsonmonster.json').then(\r\n          function success(response)\r\n          {\r\n              thejson = response.data;\r\n              console.info(\"returning json from server with status \",response.data);\r\n              return response;\r\n          },\r\n          function fail(err)\r\n          {\r\n            console.log(\"server error :\", err );\r\n          });\r\n\r\n        }  \r\n\r\n        //returns the datamodel for the moderatorController\r\n        function getStaticJson()\r\n        {\r\n          return thejson;\r\n        }\r\n    });\r\n\r\n    /*\r\n    facilitates local storage; we can store and retrieve values: storing : StorageFactory.getSetter(key)(value)\r\n    retrieving : StorageFactory.getGetter(key)() ; removing a key : StorageFactory.getSetter(key)()\r\n    */\r\n    //TODO make exceptions for 'auth-token' key\r\n    app.factory('StorageFactory',['storage', '$log', function(storage, $log)\r\n    {\r\n      console.log(\"StorageFactory...\");\r\n      var api = {};\r\n      var thekeys;\r\n      var thealiases;\r\n      var currentKey;\r\n      var myaliases;\r\n      \r\n      return {\r\n        getSetter : getSetter,\r\n        getGetter : getGetter,\r\n        verifyKey : verifyKey,\r\n        createAPIForKey : createAPIForKey,\r\n        createSetter : createSetter,\r\n        createGetter : createGetter,\r\n        getAliases : getAliases,\r\n        switchKey : switchKey,\r\n        setCurrentKey : setCurrentKey,\r\n        getCurrentKey : getCurrentKey,\r\n        getNewSlotname : getNewSlotname,\r\n        initialise : initialise,\r\n        deleteAll : deleteAll,\r\n        changeKeys : changeKeys,\r\n        getListOfDirectories : getListOfDirectories,\r\n        getListOfFiles : getListOfFiles,\r\n        checkIfEmptyKey : checkIfEmptyKey\r\n      };\r\n\r\n      function initialise()\r\n      {\r\n\r\n        if(storage.getKeys().indexOf(\"ngIdle.expiry\") > -1)\r\n        {\r\n            getSetter(\"ngIdle.expiry\")();\r\n        }  \r\n\r\n\r\n        if(storage.getKeys().length === 0 || storage.getKeys().length === 1 && getGetter('auth-token')() !== null)\r\n        {\r\n          //console.log(\"adding files...\");\r\n          getSetter(\"slot1\")(\" start here...\");\r\n          getSetter(\"file1\")(\"slot1\");\r\n          var thejson = [\r\n                          {\r\n                            \"id\": 1,\r\n                            \"title\": \"dir1\",\r\n                            \"isDirectory\": true,\r\n                            \"nodes\": [\r\n                              {\r\n                                \"id\": 2,\r\n                                \"title\": \"file1\",\r\n                                \"isDirectory\": false,\r\n                                \"isLocked\": false,\r\n                                \"nodes\": []\r\n                              }\r\n                            ]\r\n                          }\r\n                        ];\r\n          thealiases = [\"file1\"];\r\n          currentKey= \"slot1\";\r\n          var myslots = { 2 : {\"title\":\"file1\",isLocked:false} };              \r\n          getSetter(\"thejson\")(thejson);//setting file structure in localstorage; w\r\n          getSetter(\"myslots\")(myslots);//setting the open files configuration\r\n          thekeys = createKeys([\"file1\"]);\r\n        }\r\n        else\r\n        {\r\n          var helper = storage.getKeys();\r\n          //console.log(\"adding from local storage contents.\", helper);\r\n\r\n          if(helper.indexOf(\"thejson\") > -1)\r\n          {\r\n              helper.splice(helper.indexOf(\"thejson\"),1);\r\n          }  \r\n          if(helper.indexOf(\"myslots\") > -1)\r\n          {\r\n              helper.splice(helper.indexOf(\"myslots\"),1);\r\n          } \r\n          if(helper.indexOf(\"auth-token\") > -1)\r\n          {\r\n              helper.splice(helper.indexOf(\"auth-token\"),1);\r\n          }\r\n\r\n          thekeys = createKeys(helper); \r\n          //console.log(\"created keys:\", thekeys);\r\n        }\r\n        currentKey = thekeys[0];\r\n\r\n      }\r\n\r\n      function checkIfEmptyKey()\r\n      {\r\n        var keys = storage.getKeys();\r\n        for(var i=0 ;i<keys.length; i++)\r\n        {\r\n          ////console.log(\"values \",keys[i], localStorage.getItem(keys[i]));\r\n          if (localStorage.getItem(keys[i]).length === 2)\r\n          {\r\n            //console.log(\"emtpy value! \");\r\n            return true;\r\n          }\r\n        }\r\n        return false;\r\n      }\r\n\r\n\r\n\r\n      /*\r\n        We scan the json from the localstorage for directories, using a regular expression to extract them.      \r\n      */\r\n      function getListOfDirectories()\r\n      {\r\n          var thejson = getGetter('thejson')();\r\n          var regex = new RegExp('(?<=\"isDirectory\":true,\"title\":\").*?\"','g'); \r\n          var dirs = JSON.stringify(thejson).match(regex);\r\n          // var dirs = JSON.stringify(thejson).match(/(?<=\"isDirectory\":true,\"title\":\").*?\"/g);\r\n          for(var i=0 ; i< dirs.length; i++)\r\n          {\r\n            dirs[i] = dirs[i].replace('\\\"','/'); //replacing the last quote with a slash\r\n          }\r\n          //console.log(\"directories: \", dirs);\r\n          return dirs;\r\n      }\r\n\r\n\r\n      function getListOfFiles()\r\n      {\r\n        var files = [];\r\n        if(thekeys === undefined)\r\n        {\r\n          return files;\r\n        }\r\n        thekeys.forEach(function(key)\r\n        {\r\n          files.push(key.title);\r\n        });\r\n        return files;\r\n      }\r\n\r\n      function changeKeys(oldname, newname)\r\n      {\r\n        //console.log(oldname , newname,\"\\n\", thekeys, currentKey, \"\\n\");\r\n        var index = -1;\r\n        var islocked = \"\";\r\n        for(var i= 0 ; i< thekeys.length ; i++)\r\n        {\r\n          if(thekeys[i].title === oldname)\r\n          {\r\n            index = i;\r\n            islocked = thekeys[i].isLocked;\r\n          }\r\n        }\r\n        if(index !== -1)\r\n        {\r\n          if(currentKey.title === oldname)\r\n          {\r\n            currentKey.title = newname;\r\n          }\r\n          thekeys[index].title = newname;\r\n        }\r\n        //console.log(\"after change: \", thekeys,\"\\n\", currentKey, \"\\n\");\r\n      }\r\n\r\n      function deleteAll()\r\n      {\r\n        var keys = storage.getKeys();\r\n        keys.forEach(function(key)\r\n        {\r\n          if(key !== 'auth-token')\r\n          {\r\n            getSetter(key)();\r\n          }\r\n        });\r\n      }\r\n\r\n      function switchKey()\r\n      {\r\n          var helper = thekeys.shift();\r\n          thekeys.push(helper);\r\n          currentKey = thekeys[0];\r\n          return thekeys[0];\r\n      }\r\n\r\n      //remove from keys array\r\n      function removeKey(itsAlias)\r\n      {\r\n        var index;\r\n        for(var i =0 ; i< thekeys.length; i++)\r\n        {\r\n          if(thekeys[i].title === itsAlias)\r\n          {\r\n              index = i;\r\n          }\r\n        }\r\n        thekeys.splice(index, 1);\r\n\r\n        if(currentKey.title === itsAlias)//check if the file we're working on is deleted\r\n        {\r\n          currentKey = thekeys[0];\r\n        }\r\n      }\r\n\r\n      //responding to the add new file button in the file browser;we just add the xml-declaration as its contents\r\n      function getNewSlotname(createdAlias, theid)\r\n      {\r\n        //console.log(\"id \", theid);\r\n        var newslotname = \"slot\" + Math.ceil(Math.random()*1000);\r\n        var theobject = { \"title\" : createdAlias, \"isLocked\" : false };\r\n        thekeys.push(theobject);\r\n        getSetter(newslotname)('<?xml version=\"1.0\" encoding=\"UTF-8\"?>');\r\n        getSetter(createdAlias)(newslotname);\r\n        var helper = getGetter(\"myslots\")();\r\n        helper[theid] = theobject;\r\n        getSetter(\"myslots\")(helper);\r\n        return newslotname;\r\n      }\r\n\r\n      function getAliases()\r\n      {\r\n        var output = [];\r\n\r\n        thealiases.forEach(function(value)\r\n        {\r\n          output.push(getGetter(value)());\r\n        });\r\n\r\n      return output;  \r\n      }\r\n\r\n      //current key is an object { title:\"\", isLocked: bool }\r\n      function setCurrentKey(key)\r\n      {\r\n       //console.log(\"set currentkey::\", key); \r\n        currentKey = key;\r\n      }\r\n\r\n      function getCurrentKey()\r\n      {\r\n        ////console.log(\"currentkey::\", currentKey);\r\n        return currentKey;\r\n      }      \r\n\r\n\r\n      function createKeys(helper)\r\n      {\r\n        var result = [];\r\n        helper.forEach(function(val)\r\n        {\r\n          if(val.substring(0,4) !== 'slot' )\r\n          {\r\n            result.push({\"title\" : val, \"isLocked\" : false});\r\n          }\r\n        });\r\n        return result;\r\n      }\r\n\r\n      function getSetter(key)\r\n      {\r\n        verifyKey(key);\r\n        return api[key].setter;\r\n      }\r\n      function getGetter(key)\r\n      {\r\n        verifyKey(key);\r\n        return api[key].getter;\r\n      }\r\n\r\n      function verifyKey(key)\r\n      {\r\n        if(!key || angular.isUndefined(key))\r\n        {\r\n          throw new Error(\"Key[ \" + key + \" ] is invalid\");\r\n        }\r\n\r\n        if(!api.hasOwnProperty(key))\r\n        {\r\n          createAPIForKey(key);\r\n        }\r\n\r\n      }\r\n\r\n      function createAPIForKey(key)\r\n      {\r\n        var setter = createSetter(key);\r\n        var getter = createGetter(key);\r\n        api[key] = \r\n        {\r\n          setter : setter,\r\n          getter : getter\r\n        };\r\n      }\r\n\r\n      function createSetter(key)\r\n      {\r\n        return function(value)\r\n        {\r\n          if(angular.isDefined(value))\r\n          {\r\n            try\r\n            {\r\n              storage.set(key, value);\r\n            }\r\n            catch(error)\r\n            {\r\n              $log.info('[StorageFactory]' + error.message);\r\n            }\r\n          }\r\n          else\r\n          {\r\n            storage.remove(key);\r\n          }\r\n        };\r\n      }\r\n\r\n      function createGetter(key)\r\n      {\r\n        return function()\r\n        {\r\n          var value = storage.get(key);\r\n          if(value === null)\r\n          {\r\n            value = undefined;\r\n            var setter = api[key].setter;\r\n            setter(value);\r\n          }\r\n          return value;\r\n        };\r\n      }\r\n    }]);\r\n    app.factory('EditorFactory', function()\r\n    {\r\n    console.log(\"Editorfactory...\");\r\n    var editor = null;  \r\n      \r\n      return {\r\n        editorLoaded : editorLoaded\r\n      };\r\n\r\n      function editorLoaded(_editor)\r\n      {\r\n                var _doc = _editor.getDoc();\r\n                _editor.focus();\r\n                _editor.setOption('lineNumbers', true);\r\n                _editor.setOption('lineWrapping', true);\r\n                _editor.setOption('mode', 'xml');\r\n                _editor.setOption('beautify', 'true');\r\n                _editor.setOption('theme', 'twilight');\r\n                _editor.setOption('foldGutter', true);\r\n                _editor.setOption('gutters',[ \"CodeMirror-linenumbers\",\"CodeMirror-foldgutter\"]);\r\n                _editor.setOption('matchTags', {bothTags: true});\r\n                var extraKeys =  {\r\n                          \"'<'\": completeAfter,\r\n                          \"'/'\": completeIfAfterLt,\r\n                          \"' '\": completeIfInTag,\r\n                          \"'='\": completeIfInTag,\r\n                          \"Ctrl-Space\": \"autocomplete\"\r\n                                };\r\n                _editor.setOption('extraKeys', extraKeys);\r\n\r\n                //console.log(\"editor loaded;\",_editor.options);\r\n\r\n                var windowheight = window.innerHeight;\r\n                var navbarheight = document.getElementById('mynavbar').offsetHeight;\r\n                var ed = document.querySelector('.CodeMirror');\r\n                ed.style.height = (windowheight - navbarheight) + 'px'; \r\n                //console.log(\"window, navbar, editor:\", windowheight, navbarheight, ed.style.height);\r\n\r\n                function completeAfter(cm, pred) \r\n                {\r\n                    var cur = cm.getCursor();\r\n                    if (!pred || pred()) setTimeout(function() \r\n                    {\r\n                        if (!cm.state.completionActive)\r\n                        cm.showHint({completeSingle: false});\r\n                    }, 100);\r\n                    return CodeMirror.Pass;\r\n                }\r\n\r\n                function completeIfAfterLt(cm) \r\n                {\r\n                    return completeAfter(cm, function() \r\n                    {\r\n                        var cur = cm.getCursor();\r\n                        return cm.getRange(CodeMirror.Pos(cur.line, cur.ch - 1), cur) == \"<\";\r\n                    });\r\n                }\r\n\r\n                function completeIfInTag(cm) \r\n                {\r\n                return completeAfter(cm, function() \r\n                {\r\n                    var tok = cm.getTokenAt(cm.getCursor());\r\n                    if (tok.type == \"string\" && (!/['\"]/.test(tok.string.charAt(tok.string.length - 1)) || tok.string.length == 1)) return false;\r\n                    var inner = CodeMirror.innerMode(cm.getMode(), tok.state).state;\r\n                    return inner.tagName;\r\n                });\r\n\r\n              }\r\n              return _editor;\r\n            }\r\n\r\n    });\r\n    app.factory('ValidationFactory', function(StorageFactory, $http, IAF_URL )\r\n    {\r\n      \r\n\r\n      return {\r\n        validateXml : validateXml\r\n      };\r\n\r\n      function validateXml()\r\n      {\r\n\r\n          // return $http.get(API_URL + '/validate').then(function succes(res)\r\n          // {\r\n          //   var thexml = StorageFactory.getGetter(StorageFactory.getCurrentKey())();\r\n          //   console.log(\"xsd:\\n\",  res);\r\n          //   console.log(\"xml:\\n\", typeof thexml);\r\n          //   var message = validateXML(thexml, res.data);\r\n          //   return message;\r\n          // },\r\n          // function fail(err)\r\n          // {\r\n          //   console.log(\"failure....\", err);\r\n          //   return err;\r\n          // });  \r\n      }\r\n    });\r\n    \r\n\r\n})();   \n(function ()\r\n{\r\n    'use strict';\r\n    /*TODO's : adding new directory / new file button*/\r\n    angular.module('confab')\r\n        .controller('ApsTreeController', function ($scope, $uibModal, ZipService, StorageFactory, StaticDataFactory, IafFactory, $timeout)\r\n        {\r\n            console.log('TreeController...');\r\n            var vm2 = this;\r\n            vm2.remove = remove;\r\n            vm2.toggle = toggle;\r\n            vm2.setSelectedSlot = setSelectedSlot;//is a number , the id of a node file object.\r\n            vm2.changeName = changeName;\r\n            vm2.newSubitem = newSubitem;\r\n            vm2.getZip = getZip;\r\n            vm2.addFileOrFolder = addFileOrFolder;\r\n            vm2.saveToFile= saveToFile;\r\n            vm2.showZipDialog = showZipDialog;\r\n\r\n            //is called in home.html\r\n            // vm2.treeOptions =\r\n            // {\r\n                \r\n            // };\r\n\r\n            init();\r\n\r\n            function showZipDialog()\r\n            {\r\n\r\n                var modalInstance = $uibModal.open(\r\n                {\r\n                    templateUrl : \"./views/loadzipdialog.html\",\r\n                    controller : \"LoadZipController as vm3\",\r\n                    size : \"md\",\r\n                    resolve : {items : function ()\r\n                        {\r\n                            return \"something\";\r\n                        }}\r\n                });\r\n\r\n                \r\n                //sets listeners on the load from file and the merge buttons;\r\n                modalInstance.rendered.then(\r\n                function success(resp)\r\n                {\r\n                var zipfromfile = document.getElementById('zipfromfile');\r\n                var mergefromfile = document.getElementById('mergefromfile');\r\n                console.log(zipfromfile, mergefromfile);\r\n                \r\n                zipfromfile.addEventListener('change', function(event)\r\n                {\r\n                    console.log(\"file chosen !\", event.target.files[0]);\r\n                    $scope.$emit('fileload');//stopping the timer that saves the current window\r\n                    modalInstance.close({returntype:\"viafile\"});\r\n                    // StaticDataFactory.stopTimer();\r\n                    ZipService.getZipFromFile(event.target.files[0]).then(function success(resp)\r\n                    {\r\n                        $timeout(function() //TODO StorageFactory is sometimes too late to deliver the actual keys that are in the local storage...improve by adding promises.\r\n                        {\r\n                            console.log(\"succes replacing with zip from disk...\");\r\n                            StorageFactory.initialise(); //resetting the known keys in the StorageFactory\r\n                            vm2.list = resp;\r\n                            console.log(vm2.list);\r\n                            vm2.mySlots = ZipService.getMySlots();\r\n                            var keys = Object.keys(vm2.mySlots);\r\n                            StorageFactory.setCurrentKey(vm2.mySlots[keys[0]]);\r\n                            setSelectedSlot({id:keys[0]});\r\n                        }, 100);\r\n                        //$scope.$emit('Keychange');                         \r\n\r\n                    },function failure(err)\r\n                    {\r\n                        console.log(\"failure...\", err);\r\n                    });\r\n                });    \r\n                mergefromfile.addEventListener('change', function(event)\r\n                {\r\n                    console.log(\"file chosen to merge!\", event.target.files[0]);\r\n                    $scope.$emit('fileload');//stopping the timer that saves the current window\r\n                    modalInstance.close({returntype:\"mergefile\"});\r\n                    ZipService.mergeZipFromFile(event.target.files[0]).then(function success(resp)\r\n                    {\r\n                         $timeout(function() //TODO StorageFactory is sometimes too late to deliver the actual keys that are in the local storage...improve by adding promises.\r\n                        {\r\n                            StorageFactory.initialise();\r\n                            vm2.list = resp;\r\n                            console.log(vm2.list);\r\n                            vm2.mySlots = ZipService.getMySlots();\r\n                            console.log(\"succes merging files...\", vm2.mySlots);\r\n                            var keys = Object.keys(vm2.mySlots);\r\n                            StorageFactory.setCurrentKey(vm2.mySlots[keys[0]]);\r\n                            setSelectedSlot({id:keys[0]});\r\n                            }, 100);\r\n\r\n                        console.log(\"empty slot: \",StorageFactory.checkIfEmptyKey());\r\n                    },function failure(err)\r\n                    {\r\n                        console.log(\"failure mergin files...\", err);\r\n                    });\r\n                });\r\n\r\n                },function failure(err)\r\n                {\r\n                    \r\n                });\r\n\r\n\r\n                modalInstance.result.then(function success(resp)\r\n                {\r\n                    console.log(\"response: \" , resp.returntype);\r\n                    if(resp.returntype === 'viahttp')\r\n                    {\r\n                        vm2.list = resp.data;\r\n                        vm2.mySlots = ZipService.getMySlots();\r\n                        var keys = Object.keys(vm2.mySlots);\r\n                        setSelectedSlot({id:keys[0]}) ;\r\n                        console.log(vm2.list);\r\n                    }\r\n\r\n                    },function failure(err)\r\n                    {\r\n                        console.log(\"no result from modal...\");\r\n                    });\r\n            }\r\n\r\n\r\n            function saveToFile()\r\n            {\r\n                ZipService.sendZip(true).then(function success(resp)\r\n                {\r\n                    alert(\"savedToFile!\");    \r\n                },\r\n                function failure(err)\r\n                {\r\n                    console.log(\"saving to file failed...\");\r\n                });\r\n            }\r\n\r\n            function addFileOrFolder(item)\r\n            {\r\n                var thetype = (item === 'file'? false : true);\r\n\r\n\r\n               var newobject = {\r\n                            id: Math.floor(Math.random()*10000) ,\r\n                            title: item + createRandomSuffix(),\r\n                            isDirectory : thetype,\r\n                            isLocked : false,\r\n                            nodes: []\r\n                            };\r\n               vm2.list.push(newobject);\r\n               if(item === 'file')\r\n               {\r\n                   StorageFactory.getNewSlotname(newobject.title, newobject.id);\r\n                   vm2.mySlots[newobject.id] = {\"title\" : newobject.title,\"isLocked\": false};\r\n                   setSelectedSlot(newobject);\r\n               }\r\n            }\r\n\r\n\r\n\r\n\r\n            function init()\r\n            {\r\n                if(null !== StaticDataFactory.getReqParams())\r\n                {\r\n                    console.log(\"req params present downloading zip...\") ;\r\n                    getZip();\r\n                }\r\n                else\r\n                {\r\n                    vm2.list = StorageFactory.getGetter(\"thejson\")();\r\n                    vm2.mySlots = StorageFactory.getGetter(\"myslots\")();\r\n                    var keys = Object.keys(vm2.mySlots);\r\n                    setSelectedSlot({id:keys[0]}) ;\r\n                }\r\n                // console.log(\"0 empty slot: \", StorageFactory.checkIfEmptyKey()); \r\n            }\r\n\r\n            function getZip()\r\n            {\r\n                console.log(\"getzip...\");\r\n                ZipService.getZip().then(function success(data)\r\n                {\r\n                    vm2.list = data;\r\n                    vm2.mySlots = ZipService.getMySlots();\r\n                    var keys = Object.keys(vm2.mySlots);\r\n                    setSelectedSlot({id:keys[0]}) ;\r\n                    console.log(vm2.list);\r\n                    //$timeout(changeTheNames, 1000);//waiting for the scope to have settled;otherwise view is ok but scope not parallel\r\n                }, function fail(err)\r\n                {\r\n                    console.log(\"failure getting zip: \", err);\r\n                });\r\n            }\r\n\r\n             //responding to a button click from controller.js\r\n            $scope.$on(\"LoadZipEvent\", function(event,value)\r\n            {\r\n                showZipDialog();\r\n            });\r\n\r\n             //responding to a button click from controller.js\r\n            $scope.$on(\"SaveZipEvent\", function(event,value)\r\n            {\r\n                saveToFile();\r\n            });\r\n\r\n\r\n\r\n\r\n            //listens to a button press on the key icon in the main controller and updates the model\r\n            $scope.$on('KeySwitch', function(event, key)\r\n            {\r\n                var thekeys = Object.keys(vm2.mySlots);\r\n                for(var i=0 ;i < thekeys.length; i++)\r\n                {\r\n                    // console.log(i , \" : \", vm2.mySlots[thekeys[i]]);\r\n\r\n                    if(vm2.mySlots[thekeys[i]].title == key.title)\r\n                    {\r\n                        console.log(\"bingo\",thekeys[i]);\r\n\r\n                        var helper = \r\n                        {\r\n                            id:thekeys[i],\r\n                            title:thekeys[i].title,\r\n                            isLocked:thekeys,\r\n                            nodes:[],\r\n                            isDirectory:false\r\n                        };\r\n\r\n                        setSelectedSlot(helper);\r\n                    }\r\n                }\r\n\r\n            });\r\n\r\n            // $scope.$watch('vm2.selectedSlot', function()\r\n            // {\r\n            //     console.log(\"selected slot changed: \", vm2.selectedSlot);\r\n            // });\r\n\r\n            //Any change in the file tree is saved in localstorage to reload later\r\n            $scope.$watch('vm2.list', function()\r\n            {\r\n                StorageFactory.getSetter(\"thejson\")(vm2.list);\r\n            }, true);\r\n\r\n \r\n\r\n\r\n\r\n            function setSelectedSlot(object,fromclick) {\r\n                console.log(\"changing selected slot...\", object, fromclick);\r\n                \r\n                if(object.hasOwnProperty('id')) {\r\n                    if(fromclick) {\r\n                        $scope.$emit('saveOldValues');\r\n                    }\r\n                    vm2.selectedSlot = object.id;\r\n                    StorageFactory.setCurrentKey(vm2.mySlots[vm2.selectedSlot]);\r\n                    var myobj = vm2.mySlots[vm2.selectedSlot];\r\n                    $scope.$emit('Keychange',myobj);\r\n                }\r\n                else {\r\n                    if(object.$modelValue.isDirectory)\r\n                    {\r\n                        // console.log(\"draining click\"); \r\n                        return;\r\n                    }\r\n                    if(!(object.isDirectory)) {\r\n                        if(fromclick) {\r\n                            $scope.$emit('saveOldValues');\r\n                        }\r\n                        vm2.selectedSlot = object.$modelValue.id;\r\n                        StorageFactory.setCurrentKey(vm2.mySlots[vm2.selectedSlot]);\r\n                        var myobj = vm2.mySlots[vm2.selectedSlot];\r\n                        $scope.$emit('Keychange',myobj);\r\n                    }\r\n                }\r\n            }\r\n\r\n\r\n            /*\r\n            Sets the name of the tree item contenteditable and places the caret; \r\n            On enter or on blur the nameGiver directive updates the model with the current viewvalue.\r\n            */\r\n            function changeName(item)\r\n            {\r\n                var element = document.getElementById('treeitem' + item.$modelValue.id);\r\n                console.log(\"editing \",element.id);\r\n                element.setAttribute('contentEditable', true);\r\n                var textnode = element.firstChild;\r\n                var caret = textnode.length;\r\n                var range = document.createRange();\r\n                range.setStart(textnode, 0);\r\n                range.setEnd(textnode, caret);\r\n                var sel = window.getSelection();\r\n                sel.removeAllRanges();\r\n                sel.addRange(range);\r\n                element.focus();\r\n            }\r\n\r\n\r\n            /*\r\n                Removes an item from the tree after checking if the user doesn't check the last item.\r\n                Also the corresponding slot must be deleted and the model updated accordingly.\r\n                object one level higher in the hierarchy: object.$parentNodeScope\r\n                siblings of the current object : object.$parentNodesScope.$modelValue   (note the small 's' difference)\r\n            */\r\n            function remove(object)\r\n            {\r\n                var theid = object.$modelValue.id;\r\n                var parking = getRoot(object);\r\n                var nodetype = object.$modelValue.isDirectory;\r\n                var counter = 0;\r\n\r\n                if(nodetype)//if it is a directory we want to remove\r\n                {\r\n                    var currentLayer = object;\r\n\r\n                    // while(currentLayer !== null && counter < 10)\r\n                    // {\r\n                          // if(lookForDirectory(currentLayer.$parentNodesScope.$modelValue, object.$modelValue.id))\r\n                            // {\r\n                                console.log(\"removable: \", object.$modelValue.title);\r\n                                var results = deleteContainingFiles(object);\r\n                                console.log(\"results: \",results );\r\n                                \r\n                                //checking for the case that no files are left after this deletion\r\n                                //updating the mySlots object with the current slots.\r\n                                if(results.length < Object.keys(vm2.mySlots).length)\r\n                                {   \r\n                                    results.forEach(function(item)\r\n                                    {\r\n                                        deleteFromLocalStorage(item);\r\n                                        delete vm2.mySlots[item];\r\n                                    });\r\n                                    object.remove();\r\n                                }\r\n                                // break;\r\n                            // }\r\n                          // else\r\n                          // {\r\n                          //   currentLayer = currentLayer.$parentNodeScope;\r\n                          //   console.log(\"watching layer above\" ,currentLayer );\r\n                          // }    \r\n                          // counter++;\r\n                    // }\r\n                }\r\n                else//if it is a file we want to remove\r\n                {\r\n                    if(traverseArray(parking.$parentNodesScope.$modelValue, false))\r\n                    {\r\n                        console.log(\"removable: \", object.$modelValue.title);\r\n                        deleteFromLocalStorage(object.$modelValue.id);\r\n                        delete vm2.mySlots[object.$modelValue.id]; //remove from the slots\r\n                        object.remove(); //remove from the filetree\r\n                    }\r\n                }\r\n\r\n                function deleteFromLocalStorage(itsid)\r\n                {\r\n                    var thealias = vm2.mySlots[itsid].title;\r\n                    var theslot = StorageFactory.getGetter(thealias)();\r\n                    console.log(\"removing slots:\",theslot, \" alias \" ,thealias);\r\n                    StorageFactory.getSetter(thealias)();\r\n                    StorageFactory.getSetter(theslot)();\r\n                    var myslots = StorageFactory.getGetter(\"myslots\")();\r\n                    delete myslots[itsid];\r\n                    StorageFactory.getSetter(\"myslots\")(myslots);\r\n                }\r\n\r\n\r\n                function deleteContainingFiles(object)\r\n                {\r\n                    var results = [];\r\n                    console.log(\"children:\", object.$childNodesScope.$modelValue);\r\n                    var array = object.$childNodesScope.$modelValue;\r\n\r\n                    findResults(array);\r\n\r\n                    function findResults(sublist)\r\n                    {\r\n                        for(var i=0 ; i< sublist.length; i++)\r\n                        {\r\n                            if(!(sublist[i].isDirectory))\r\n                            {\r\n                                results.push(sublist[i].id);\r\n                            }\r\n                            else\r\n                            {\r\n                                if(sublist[i].nodes.length > 0)\r\n                                {\r\n                                    findResults(sublist[i].nodes);   \r\n                                }\r\n                            }\r\n                        }\r\n                    }\r\n\r\n                    console.log(\"id of selected slot :\", vm2.selectedSlot); \r\n\r\n                    checkingloop : for (var j=0 ; j<results.length ; j++)\r\n                    {\r\n\r\n                        if(vm2.selectedSlot === results[j])\r\n                        {\r\n                            console.log(\"selected file inside directory\", vm2.selectedSlot); \r\n                            //finding an id that is outside this directory make that the selected slot:\r\n                            var keys = Object.keys(vm2.mySlots);\r\n                            var found = false;\r\n                            for(var l=0 ; l<keys.length; l++)\r\n                            {\r\n                                if(!_.contains(results, keys[l]))\r\n                                {\r\n                                    setSelectedSlot({id:keys[l]});\r\n                                    found = true;\r\n                                    break checkingloop;\r\n                                }\r\n                            }\r\n                            if (!found)\r\n                            {\r\n                                console.log(\"no files left to assign current file...\") \r\n                            }    \r\n                        }\r\n                    }\r\n\r\n\r\n                    return results;  \r\n                }\r\n\r\n                function getRoot(obj)\r\n                {\r\n                    var parking = obj;\r\n                    while(parking.$parentNodeScope !== null)\r\n                    {\r\n                        parking = parking.$parentNodeScope ;\r\n                    }\r\n                    console.log(\"root:\", parking.$parentNodesScope.$modelValue);\r\n                    return parking;\r\n                }\r\n\r\n                function traverseArray(sublist, ok)\r\n                {\r\n                    \r\n                    if(ok){return ok;}\r\n                    for(var i = 0 ; i<sublist.length; i++)\r\n                    {\r\n                        console.log(sublist[i].title,sublist[i].id);\r\n                        if(!(sublist[i].isDirectory) && sublist[i] !== object.$modelValue) \r\n                        {\r\n                            console.log(\"match with\", sublist[i].title);\r\n                            ok = true;\r\n                            break;\r\n                        }\r\n                        else\r\n                        {\r\n                            if(sublist[i].nodes.length > 0)\r\n                            {\r\n                                ok = traverseArray(sublist[i].nodes, ok);\r\n                            }\r\n                        }\r\n                    }\r\n                    return ok;\r\n                } \r\n                // Looking for a directory that is still present\r\n                function lookForDirectory(sublist, callerid)\r\n                {\r\n                    for (var i = 0 ; i < sublist.length ; i ++)\r\n                    {\r\n                        if(sublist[i].isDirectory && sublist[i].id !== callerid)\r\n                        {\r\n                            console.log(\"found directory\" , sublist[i].title);\r\n                            return true;\r\n                        }\r\n                    }\r\n                }\r\n            }\r\n\r\n            function toggle(item)\r\n            {\r\n               item.toggle();\r\n            }\r\n\r\n            function newSubitem(item)\r\n            {\r\n                //console.log(\"parent:\",item.$parent.$parent.$parent.$parent.$modelValue.title);\r\n                var theitem = item.$modelValue;\r\n                console.log(theitem);\r\n\r\n                if(theitem.isDirectory)\r\n                {\r\n                    theitem.nodes.push({\r\n                    id: Math.floor(Math.random()*10000) ,\r\n                    title: theitem.title ,\r\n                    isDirectory : true,\r\n                    nodes: []\r\n                    });\r\n                }\r\n                else\r\n                {\r\n                    var theid = Math.floor(Math.random()*10000);\r\n                    var thetitle = theitem.title + '-' + createRandomSuffix();\r\n                    var newobject = {\r\n                            id: theid ,\r\n                            title: thetitle,\r\n                            isDirectory : false,\r\n                            isLocked : false,\r\n                            nodes: []\r\n                            };\r\n\r\n\r\n                    if(item.$parentNodeScope !== null)\r\n                    {\r\n                        item.$parentNodeScope.$modelValue.nodes.push(newobject);\r\n                    }\r\n                    else\r\n                    {\r\n                        vm2.list.push(newobject);\r\n                    }\r\n                    // console.log(\"item:\", item);\r\n                    // console.log(\"theid \", theid);\r\n                    StorageFactory.getNewSlotname(thetitle, theid);\r\n                    vm2.mySlots[theid] = {\"title\" : thetitle,\"isLocked\": false};\r\n                    setSelectedSlot(newobject);\r\n                }\r\n            }\r\n\r\n\r\n            function createRandomSuffix()\r\n            {\r\n                var suffixes = \"abcdefghijklmnopqrstuvwxyzABCDEFGHILJKLMNOPRSTUVWXYZ\";\r\n                var result = \"\";\r\n                for(var i=0 ; i<3; i++)\r\n                {\r\n                    var randomdigit = Math.floor(Math.random()*suffixes.length);\r\n                    var letter = suffixes.substring(randomdigit,randomdigit + 1);\r\n                    result += letter;\r\n                }\r\n                return result;\r\n            }\r\n\r\n\r\n        })\r\n\r\n        //controls the modal that appears when you're loading a zip\r\n        .controller('LoadZipController', function($uibModalInstance, $scope, ZipService, items)\r\n            {\r\n                var vm3 = this;\r\n                vm3.closeModal = closeModal;\r\n                vm3.getZipOverHttp = getZipOverHttp;\r\n\r\n                function getZipOverHttp()\r\n                {\r\n                    console.log(\"getzip over http...\");\r\n                    $scope.$emit('fileload');//stopping the timer that saves the current window\r\n                    ZipService.getZip().then(function success(data)\r\n                    {\r\n                        console.log(\"data back\", data);\r\n                        $uibModalInstance.close({returntype:\"viahttp\",data:data});\r\n                        \r\n                    }, function fail(err)\r\n                    {\r\n                        console.log(\"failure getting zip via http: \", err);\r\n                    });\r\n                }                \r\n\r\n                \r\n\r\n                function closeModal()\r\n                {\r\n                    $uibModalInstance.close(\"dialog cancelled.\");\r\n                }\r\n            })\r\n\r\n\r\n\r\n        //Returns the part after the last slash of a file.\r\n        .filter('cropFilter', function()\r\n        {\r\n            return function(item)\r\n            {\r\n                if(item === undefined || item === null) return \"\";\r\n                var helper = item.substring(item.lastIndexOf('/') + 1 ,item.length);\r\n                if(helper.length > 0)\r\n                {\r\n                    return helper;\r\n                }\r\n                else\r\n                {\r\n                    return item;\r\n                }\r\n            };\r\n        });\r\n\r\n})();\r\n\n(function ()\r\n{\r\n    \r\n/*\r\n    Defines an xmlTag object that will be used as the main data carrier in the editor;\r\n*/\r\nangular.module('confab')\r\n\r\n    .factory('xmlTag', function() \r\n        {\r\n        /*\r\n        tagTypes are \"STARTTAG\", \"COMBITAG\", and \"ENDTAG\"\r\n        */\r\n\r\n        var staticPipenames = [\"FixedQuerySender\", \"XmlWellFormedChecker\",\"XmlValidator\",\"XmlSwitch\",\"XmlIf\",\"WsdlXmlValidator\",\"RemoveFromSession\",\"PutSystemDateInSession\",\"PutInSession\",\"MailSender\",\"LogSender\",\"Json2XmlValidator\",\"JmsCommunicator\",\"PutParametersInSession\",\"IsolatedServiceExecutor\",\"IsolatedServiceCaller\",\"IfMultipart\",\"GetFromSession\",\"FixedResultSender\",\"FixedResult\",\"FilenameSwitch\",\"XmlParamSwitch\",\"EchoSender\"];\r\n\r\n\r\n        function xmlTag(elementname, proparray) \r\n        {\r\n            this.tagType = \"STARTTAG\";\r\n            this.elementName = elementname;\r\n            tagProperties = {};\r\n            proparray.forEach(function(prop)\r\n            {\r\n                tagProperties[prop.getAttributeName()] = prop.getAttributeValues();\r\n            }); \r\n            this.tagProperties = tagProperties; \r\n        }\r\n        //native functions of the xmlTag that can access the instance properties\r\n        xmlTag.prototype = \r\n        {\r\n            getTagType : function()\r\n            {\r\n                return this.tagType;\r\n            },\r\n            setTagType : function(astring)\r\n            {\r\n                switch (astring)\r\n                {\r\n                    case \"STARTTAG\":{this.tagType = \"STARTTAG\"; break;}\r\n                    case \"COMBITAG\":{this.tagType = \"COMBITAG\";break;}\r\n                    case \"ENDTAG\":{this.tagType = \"ENDTAG\";break;}\r\n                    default :{console.log(\"tagType is set to default..\",astring,\" is unknown type.\");\r\n                                this.tagType = \"STARTTAG\";}\r\n                }\r\n            },\r\n            toCompleteTag : function()\r\n            {\r\n                var returnstring = \"\";  \r\n                var itsproperties = \"\"; \r\n                this.convertToPipe();\r\n                angular.forEach(this.tagProperties, function(value, key)\r\n                {\r\n                    if (value == \"\")\r\n                    {\r\n                        itsproperties += \" \" + key + \"=\\\"\\\" \" + \" \";\r\n                    }\r\n                    else\r\n                    {\r\n                        itsproperties += \" \" + key + \"=\\\"\" + value + '\\\"';   \r\n                    }\r\n\r\n                });\r\n             returnstring =                     \"<\" + \r\n                                        this.elementName + \r\n                                        itsproperties + \r\n                                        \"></\" +\r\n                                        this.elementName + \r\n                                        \">\" ;\r\n                                           \r\n\r\n             return returnstring;                           \r\n\r\n\r\n            },\r\n            //converts its contents to a readable xml-tag, dependent on its type\r\n            toObject : function()\r\n            {\r\n                var theobject = {} ;\r\n                theobject[this.elementName] = this.tagProperties;\r\n                console.log(\"myobj\", theobject);\r\n                return theobject;\r\n            },\r\n            setProperty :function (key, value)\r\n            {\r\n                this.tagProperties[key] = value;\r\n            },\r\n            getPropertyValue :function (key)\r\n            {\r\n                return this.tagProperties[key];\r\n            },\r\n            //necessary while waiting for new IAF release; for now these elements have\r\n            //a default classname attached.\r\n            convertToPipe: function()\r\n            {\r\n                if (this.elementName.search( /^.*Pipe$/ ) !== -1)\r\n                {\r\n                    this.elementName = \"pipe\"; \r\n                }\r\n\r\n                if(staticPipenames.includes(this.elementName))\r\n                {\r\n                    this.elementName = \"pipe\";    \r\n                }\r\n\r\n                var regex = \"/^.*Pipe$/\";\r\n\r\n            }\r\n\r\n        };\r\n       /*static functions that have no access to this:\r\n        xmlTag.computeTabdistance = function(tag)\r\n        {\r\n            return tabdistance\r\n        }\r\n       */\r\n        return (xmlTag);\r\n        })\r\n\r\n    .factory('attributeObject', function()\r\n    {\r\n        function attributeObject(attributename, values, hasDefault)\r\n        {\r\n            this.name = attributename;\r\n            \r\n            if(values !== undefined)\r\n            {\r\n                this.values = values;\r\n            }\r\n            else\r\n            {\r\n                this.values = [];\r\n            }\r\n            if (hasDefault !== undefined)\r\n            {\r\n                this.hasDefault = hasDefault;\r\n            }\r\n            else \r\n            {\r\n                this.hasDefault = false;\r\n            }\r\n        }\r\n\r\n        attributeObject.prototype = \r\n        {\r\n            setAttributeValue : function(value)\r\n            {\r\n                if (this.hasDefault)\r\n                {\r\n                    this.values.unShift(value);\r\n                }\r\n                else \r\n                {\r\n                    this.values.push(value);\r\n                }\r\n            },\r\n\r\n            //insert a whole array\r\n            insertValues : function(array)\r\n            {\r\n               this.values = array; \r\n            },\r\n\r\n            getAttributeName : function()\r\n            {\r\n                return this.name;\r\n            },\r\n\r\n            //returns an array of possible values \r\n            getAttributeValues : function()\r\n            {\r\n                return this.values;\r\n            },\r\n            \r\n            setDefaultValue : function(bool)\r\n            {\r\n                this.hasDefault = bool ;\r\n            },\r\n\r\n            toString : function()\r\n            {\r\n                return this.name + 'Allowed values:' + this.values.join();\r\n            }\r\n        };\r\n\r\n\r\n        return(attributeObject);\r\n\r\n        \r\n\r\n\r\n\r\n\r\n\r\n    });\r\n\r\n})();\n(function()\r\n{\r\n'use strict';\r\n\r\nvar appliccat = angular.module('confab');\r\nappliccat.factory('UserFactory', function UserFactory($http,  AuthTokenFactory, StorageFactory, $q, $window, IAF_URL)\r\n    {\r\n        var currentUser = null;\r\n    \t\r\n        return {\r\n            login: login,\r\n            logout: logout,\r\n            getUser: getUser,\r\n            getAllUsers: getAllUsers,\r\n            saveUser: saveUser,\r\n            deleteUser: deleteUser,\r\n            setCurrentUser: setCurrentUser,\r\n            getCurrentUser: getCurrentUser,\r\n            sendMail: sendMail,\r\n            askSubscription : askSubscription,\r\n            checkIfInstanceAvailable : checkIfInstanceAvailable\r\n        };\r\n     \r\n        \r\n\r\n\r\n        function checkIfInstanceAvailable()\r\n        {\r\n            var theurl = IAF_URL + '/api/subscribe'\r\n            var theuser = \r\n            {\r\n                \"user\":\r\n                {\r\n                    \"firstname\":\"dummy\",\r\n                    \"lastname\":\"dummy\",\r\n                    \"role\":\"user\",\r\n                    \"email\":\"dummymessage\"\r\n                }\r\n            };\r\n            console.log(\"url: \",theurl, JSON.stringify(theuser));\r\n            return $http({method:\"POST\",url:theurl,data:JSON.stringify(theuser),headers:{'content-type':'application/json'}}).then(\r\n                function success(response)\r\n                {\r\n                    return response;\r\n                },function failure(err)\r\n                {\r\n                    return err;\r\n                });   \r\n        }\r\n\r\n        \r\n        function askSubscription(user)\r\n        {\r\n\r\n\r\n             var theurl = IAF_URL + '/api/subscribe'\r\n                var theuser = \r\n                {\r\n                    \"user\":\r\n                    {\r\n                        \"firstname\":user.firstname,\r\n                        \"lastname\":user.lastname,\r\n                        \"role\":\"user\",\r\n                        \"email\":user.email\r\n                    }\r\n                };\r\n                console.log(\"url: \",theurl, JSON.stringify(theuser));\r\n                return $http({method:\"POST\",url:theurl,data:JSON.stringify(theuser),headers:{'content-type':'application/json'}}).then(\r\n                function success(response)\r\n                {\r\n                    console.log(\"response\", response);\r\n                    return response;\r\n                },function failure(response)\r\n                {\r\n                    console.log(\"response\");\r\n                    return response;\r\n                });\r\n            }\r\n\r\n\r\n\r\n        //from usercontroller\r\n        function sendMail(useremail)\r\n        {\r\n            var theurl = IAF_URL + '/api/newcredentials/' + useremail;\r\n            console.log(\"sending to \",theurl);\r\n            return $http.get(theurl).then(function success(response)\r\n            {\r\n                return response;\r\n            },function failure(response)\r\n            {\r\n                return response;\r\n            });\r\n        }\r\n\r\n        function getCurrentUser()\r\n        {\r\n            return currentUser;\r\n        }\r\n\r\n        function setCurrentUser(theuser)\r\n        {\r\n            currentUser = theuser;\r\n            console.log(\"current user:\", currentUser);\r\n        }\r\n\r\n\r\n        //saving or updating a user from userpage.html /usercontroller\r\n        function saveUser(user)\r\n        {\r\n            console.log(\"instancename: \",user.instancename, typeof(user.instancename));\r\n            if(undefined !== user.instancename.length && user.instancename.charAt(0)=='x')\r\n            {\r\n                console.log(\"deleting instance...\");\r\n                var theurl1 = IAF_URL + '/api/removeinstance/' + user.email;\r\n                return $http.get(theurl1).then(\r\n                    function success(res)\r\n                    {\r\n                        return res;\r\n                    },\r\n                    function fail(err)\r\n                    {\r\n                        return err;\r\n                    });\r\n            }\r\n            else\r\n            {\r\n                var theurl = IAF_URL + '/api/users';\r\n                var theuser = \r\n                {\r\n                    \"user\":\r\n                    {\r\n                        \"firstname\":user.firstname,\r\n                        \"lastname\":user.lastname,\r\n                        \"role\":user.role,\r\n                        \"email\":user.email\r\n                    }\r\n                };\r\n                console.log(\"url: \",theurl, JSON.stringify(theuser));\r\n                return $http({method:\"POST\",url:theurl,data:JSON.stringify(theuser),headers:{'content-type':'application/json'}}).then(\r\n                function success(response)\r\n                {\r\n                    console.log(\"response\", response);\r\n                    return response;\r\n                },function failure(response)\r\n                {\r\n                    console.log(\"response\");\r\n                    return response;\r\n                });\r\n            }\r\n        }\r\n\r\n        //from usercontroller\r\n        function deleteUser(useremail)\r\n        {\r\n            var theurl = IAF_URL + '/api/deleteuser/' + useremail;\r\n            console.log(\"sending to \",theurl);\r\n            return $http.get(theurl).then(function success(response)\r\n            {\r\n                console.log(\"deleting user  \", response);\r\n                return response;\r\n            },function failure(response)\r\n            {\r\n                console.log(\"deleting user  \", response);\r\n                return response;\r\n            });\r\n        }\r\n\r\n\r\n\r\n        //from usercontroller\r\n        function getAllUsers()\r\n        {\r\n            var theurl = IAF_URL + '/api/getusers';\r\n            return $http.get(theurl).then(function success(response)\r\n            {\r\n                console.log(\"getting all users  \", response);\r\n                return response.data.users.user;\r\n            },function failure(response)\r\n            {\r\n                console.log(\"failure getting users  \", response);\r\n                return response;\r\n            });\r\n        }\r\n\r\n        //from mainpage, trying to login via the token\r\n        function getUser()\r\n        {\r\n            if (AuthTokenFactory.getToken())\r\n            {\r\n                return $http.get(IAF_URL + '/api/me');\r\n            }\r\n            else\r\n            {\r\n                return $q.reject({data: 'client has no auth token'});\r\n            }\r\n        }\r\n\r\n        function login(useremail, password)\r\n        {\r\n           var theurl = IAF_URL + '/api/login';\r\n        \tconsole.log(\"url: \",theurl);\r\n            if(AuthTokenFactory.getToken())//remove old tokens , logging in without tokens\r\n            {\r\n                console.log(\"removing an existing token...\");\r\n                AuthTokenFactory.setToken();\r\n            }\r\n            return $http.post(theurl,\r\n                {\"logindetails\":{\r\n                    \"email\": useremail,\r\n                    \"password\": password}\r\n                }).then(function success(response)\r\n            {\r\n                AuthTokenFactory.setToken(response.data.logindetails.accesstoken);\r\n                return response;\r\n            },function failure(error)\r\n            {\r\n                console.log(\"statuscode \", error.data.loginDetails.result);\r\n                return error;\r\n            });\r\n\r\n               \r\n        }\r\n        function logout()\r\n        {\r\n            return $http.get(IAF_URL + '/api/logout').then(\r\n        \tfunction succes(response)\r\n            {\r\n                console.info(\"token removed from backend\",response);\r\n                AuthTokenFactory.setToken();\r\n                return response;\r\n            }, function failure(response)\r\n            {\r\n                console.info(\"returning error from backend\",response);\r\n                return response;\r\n            });\r\n\r\n        }\r\n\r\n    });\r\n\r\n\r\n    appliccat.factory('AuthTokenFactory', function AuthTokenFactory($window)\r\n    {\r\n\r\n        var store = $window.localStorage;\r\n        var key = 'auth-token';\r\n\r\n        return {\r\n            getToken: getToken,\r\n            setToken: setToken\r\n        };\r\n\r\n        function getToken()\r\n        {\r\n            return store.getItem(key);\r\n        }\r\n\r\n        function setToken(token)\r\n        {\r\n            if (token)\r\n            {\r\n                store.setItem(key, token);\r\n            }\r\n            else\r\n            {\r\n                store.removeItem(key);\r\n            }\r\n        }\r\n    });\r\n\r\n\r\n    appliccat.factory('AuthInterceptor', function AuthInterceptor(AuthTokenFactory)\r\n    {\r\n\r\n        return {\r\n            request: addToken\r\n        };\r\n\r\n        function addToken(config)\r\n        {\r\n            var token = AuthTokenFactory.getToken();\r\n            if (token)\r\n            {\r\n                config.headers = config.headers || {};\r\n                config.headers.Authorization = token;\r\n            }\r\n            return config;\r\n        }\r\n    });\r\n\r\n    \r\n\r\n\r\n\r\n\r\n}());\n(function(){\r\n\r\n\t'use strict';\r\n\tvar applic = angular.module('confab');\r\n\tapplic.controller('MyUserController',function(UserFactory, $timeout)\r\n\t{\r\n\t\tconsole.log(\"my usercontroller...\");\r\n\t\tvar vm6 = this;\r\n\t\tvm6.setRole = setRole;\r\n\t\tvm6.saveItem = saveItem;\r\n\t\tvm6.deleteUser = deleteUser;\r\n\t\tvm6.sendMail = sendMail;\r\n\t\tvm6.toggleInstance = toggleInstance;\r\n\t\tvm6.sortOnHeaderName = sortOnHeaderName;\r\n\t\tvm6.logitem = logitem;\r\n\t\tvm6.user = UserFactory.getCurrentUser();\r\n\t\tvm6.buttonsenabled = true;\r\n\t\tgetAllUsers();\r\n\r\n\t\tfunction toggleInstance(index)\r\n\t\t{\r\n\t\t\tconsole.log(\"object: \", vm6.theusers[index].instancename.length);\r\n\t\t\tif (undefined !== vm6.theusers[index].instancename.length)\r\n\t\t\t{\r\n\t\t\t\tif(vm6.theusers[index].instancename.substring(0,1)==='x')\r\n\t\t\t\t{\r\n\t\t\t\t\tvar name = vm6.theusers[index].instancename;\t\t\t\t\r\n\t\t\t\t\tvm6.theusers[index].instancename = name.substring(1,name.length);\r\n\t\t\t\t\tconsole.log(\"name1:\", vm6.theusers[index].instancename);\r\n\t\t\t\t}\r\n\t\t\t\telse\r\n\t\t\t\t{\r\n\t\t\t\t\tvm6.theusers[index].instancename = 'x' + vm6.theusers[index].instancename ;\r\n\t\t\t\t\tconsole.log(\"name2:\", vm6.theusers[index].instancename);\r\n\t\t\t\t}\t\r\n\t\t\t}\r\n\t\t\telse\r\n\t\t\t{\r\n\t\t\t\tconsole.log(\"returning\");\r\n\t\t\t\treturn;\r\n\t\t\t}\r\n\t\t\t\r\n\t\t}\r\n\r\n\t\tfunction sendMail(index)\r\n\t\t{\r\n\t\t\tUserFactory.sendMail(vm6.theusers[index].email).then(\r\n\t\t\t\tfunction success(resp)\r\n\t\t\t\t{\r\n\t\t\t\t\tconsole.log(\"success giving new credentials, email is sent. \", resp.status);\r\n\t\t\t\t\tgetAllUsers();\r\n\t\t\t\t},\r\n\t\t\t\tfunction failure(resp)\r\n\t\t\t\t{\r\n\t\t\t\t\tconsole.log(\"failure giving new credentials.\", resp.status);\r\n\t\t\t\t});\r\n\t\t}\r\n\r\n\t\tfunction deleteUser(index)\r\n\t\t{\r\n\t\t\tif(vm6.buttonsenabled)\r\n\t\t\t{\r\n\t\t\t\tvm6.buttonsenabled = false;\r\n\t\t\t\tUserFactory.deleteUser(vm6.theusers[index].email).then(\r\n\t\t\t\t\tfunction success(resp)\r\n\t\t\t\t\t{\r\n\t\t\t\t\t\tconsole.log(\"success deleting user \", resp.status);\r\n\t\t\t\t\t\tgetAllUsers();\r\n\t\t\t\t\t},\r\n\t\t\t\t\tfunction failure(resp)\r\n\t\t\t\t\t{\r\n\t\t\t\t\t\tvm6.buttonsenabled = true;\r\n\t\t\t\t\t\tconsole.log(\"fai lure deleting user \", resp.status);\r\n\t\t\t\t\t});\r\n\t\t\t}\r\n\t\t}\r\n\r\n\t\tfunction getAllUsers()\r\n\t\t{\r\n\t\t\tUserFactory.getAllUsers().then(\r\n\t\t\tfunction success(response)\r\n\t\t\t{\r\n        vm6.theusers = response;\r\n\t\t\t\tvm6.theusers.unshift({email:\"\",role:\"user\",firstname:\"\",lastname:\"\",instancename:\"\"});\r\n\t\t\t\tvm6.buttonsenabled = true;\r\n        $('#contentContainer').mCustomScrollbar({theme:\"minimal\"});\r\n\t\t\t\tconsole.log(\"returned users:\", vm6.theusers);\r\n\t\t\t},\r\n\t\t\tfunction failure(response)\r\n\t\t\t{\r\n\t\t\t\tvm6.buttonsenabled = true;\r\n\t\t\t\tvar el = document.getElementById('sendstatususers');\r\n        el.style.background = 'red';\r\n        $timeout(function()\r\n        {\r\n            el.style.background = 'none';\r\n        }, 5000);\r\n        console.log(\"no users returned \" ,response);\r\n\t\t\t});\r\n\t\t}\r\n\r\n\t\tfunction setRole(index, role)\r\n\t\t{\r\n\t\t\tvm6.theusers[index].role = role;\r\n\t\t}\r\n\r\n\t\tfunction logitem()\r\n\t\t{\r\n\t\t\tconsole.log(\"item: \",vm6.theusers);\r\n\t\t}\r\n\r\n\r\n\r\n        function saveItem(index)\r\n        {\r\n        \tif(vm6.buttonsenabled)\r\n        \t{\r\n\t        \tvm6.buttonsenabled = false;\r\n\t        \tUserFactory.saveUser(vm6.theusers[index]).then(\r\n\t        \tfunction success(response)\r\n\t        \t{\r\n              if(response.status === 500)\r\n              {\r\n                var el = document.getElementById('sendstatususers');\r\n                el.style.background = 'red';\r\n                $timeout(function()\r\n                {\r\n                    el.style.background = 'none';\r\n                }, 5000);\r\n              }\r\n              else\r\n              {\r\n                console.log(\"saved successfully \", response.status);\r\n                var el = document.getElementById('sendstatususers');\r\n                el.style.background = 'green';\r\n                $timeout(function()\r\n                {\r\n                    el.style.background = 'none';\r\n                }, 5000);  \r\n              }\r\n              getAllUsers();\r\n\t        \t},function failure(response)\r\n\t        \t{\r\n\t        \t\tconsole.log(\"no success saving \", response.status);\r\n              var el = document.getElementById('sendstatususers');\r\n              el.style.background = 'red';\r\n              $timeout(function()\r\n              {\r\n                  el.style.background = 'none';\r\n              }, 5000);\r\n\t        \t});\r\n        \t}\r\n        }\r\n\r\n        function sortOnHeaderName(comparator)\r\n        {\r\n        \tconsole.log(\"comparator\", typeof(comparator));\r\n        \tswitch(comparator)\r\n        \t{\r\n        \t\tcase('instance'):\r\n        \t\t{\r\n        \t\t\tvm6.theusers.sort(compareInstancename);\r\n        \t\t\tbreak;\r\n        \t\t}\r\n        \t\tcase('email'):\r\n        \t\t{\r\n        \t\t\tvm6.theusers.sort(sortByEmail);\r\n        \t\t\tbreak;\r\n        \t\t}\r\n        \t\tcase('firstname'):\r\n        \t\t{\r\n        \t\t\tvm6.theusers.sort(sortByFirstname);\r\n        \t\t\tbreak;\r\n        \t\t}\r\n        \t\tcase('lastname'):\r\n        \t\t{\r\n        \t\t\tvm6.theusers.sort(sortByLastname);\r\n        \t\t\tbreak;\r\n        \t\t}\r\n        \t}\r\n\r\n\r\n        }\r\n\r\n        function sortByEmail(a,b)\r\n        {\r\n        \tvar nameA = a.email.toUpperCase(); \r\n  \t\t\tvar nameB = b.email.toUpperCase(); \r\n  \t\t\tif (nameA < nameB) \r\n  \t\t\t{\r\n    \t\t\treturn -1;\r\n  \t\t\t}\r\n  \t\t\tif (nameA > nameB) \r\n  \t\t\t{\r\n    \t\t\treturn 1;\r\n  \t\t\t}\r\n  \t\t\treturn 0;\r\n        }\r\n\r\n\r\n        function sortByFirstname(a,b)\r\n        {\r\n        \tvar nameA = a.name.toUpperCase(); \r\n  \t\t\tvar nameB = b.name.toUpperCase(); \r\n  \t\t\tif (nameA < nameB) \r\n  \t\t\t{\r\n    \t\t\treturn -1;\r\n  \t\t\t}\r\n  \t\t\tif (nameA > nameB) \r\n  \t\t\t{\r\n    \t\t\treturn 1;\r\n  \t\t\t}\r\n  \t\t\treturn 0;\r\n        }\r\n\r\n        function sortByLastname(a,b)\r\n        {\r\n        \tvar nameA = a.lastname.toUpperCase(); \r\n  \t\t\tvar nameB = b.lastname.toUpperCase(); \r\n  \t\t\tif (nameA < nameB) \r\n  \t\t\t{\r\n    \t\t\treturn -1;\r\n  \t\t\t}\r\n  \t\t\tif (nameA > nameB) \r\n  \t\t\t{\r\n    \t\t\treturn 1;\r\n  \t\t\t}\r\n  \t\t\treturn 0;\r\n        }\r\n\r\n\r\n\r\n      \tfunction compareInstancename(a,b)\r\n      \t{\r\n      \t\t\r\n      \t\tif(a.instancename === 'Ibis4Teacher')\r\n      \t\t{\r\n      \t\t\treturn 1;\r\n      \t\t}\r\n\r\n      \t\telse if(a.instancename > b.instancename)\r\n      \t\t{\r\n      \t\t\tconsole.log(\"returning 1\");\r\n      \t\t\treturn 1;\r\n      \t\t}\r\n      \t\telse if (a.instancename < b.instancename)\r\n      \t\t{\r\n      \t\t\tconsole.log(\"returning -1\");\r\n      \t\t\treturn -1;\r\n      \t\t}\r\n      \t\telse\r\n      \t\t{\r\n      \t\t\treturn 0;\r\n      \t\t}\r\n      \t}  \r\n\r\n\r\n\r\n\t})\r\n\r\n  .controller('LandingPageController', function(UserFactory, $uibModal)\r\n  {\r\n    var vm7 = this;\r\n    vm7.askSubscription = askSubscription;\r\n    vm7.showSubscriptionDialog = showSubscriptionDialog;\r\n    console.log(\"LandingPageController...\");\r\n    vm7.tryagain = false;\r\n    vm7.successfulsubscription = false;\r\n    vm7.showSpinner = false;\r\n    vm7.trytomorrow = false;\r\n    \r\n    checkIfInstanceAvailable();\r\n\r\n    function checkIfInstanceAvailable()\r\n    {\r\n      UserFactory.checkIfInstanceAvailable().then(function success(resp)\r\n      {\r\n        console.log(\"thestatus :\",resp.status);\r\n        if(resp.status !== 501)\r\n        {\r\n          console.log(\"no instance available\");\r\n          showSubscriptionDialog();\r\n        }\r\n        else\r\n        {\r\n          vm7.trytomorrow = true;\r\n          return;\r\n        }\r\n      },function failure(err)\r\n      {\r\n        console.log(\"failure thestatus :\",err.status);\r\n      })\r\n    }\r\n\r\n\r\n\r\n    \r\n    \r\n    \r\n    function askSubscription(userobject)\r\n    {\r\n      //var userobject = {firstname:\"ap\",lastname:\"re\",email:\"ap@p\",role:\"user\"};\r\n      vm7.showSpinner = true;\r\n      UserFactory.askSubscription(userobject).then(function success(resp)\r\n      {\r\n        console.log(resp);\r\n        vm7.showSpinner = false;\r\n        \r\n        if(resp.status !== 200 )\r\n        {\r\n          console.log(\"wrong input\");\r\n          vm7.tryagain = true;\r\n          return;\r\n        }\r\n        else\r\n        {\r\n          console.log(\"succesful subscription\");\r\n          vm7.successfulsubscription = true;\r\n          vm7.tryagain = false;\r\n        }\r\n      },function failure(err)\r\n      {\r\n        console.log(err);\r\n        vm7.showSpinner = false;\r\n        vm7.tryagain = true;\r\n      });\r\n    }\r\n\r\n    function showSubscriptionDialog()\r\n            {\r\n              vm7.tryagain = false;\r\n                var modalInstance = $uibModal.open(\r\n                {\r\n                    templateUrl : \"./views/modalsubscribe.html\",\r\n                    controller : \"SubscribeController as vm8\",\r\n                    size : \"md\",\r\n                    resolve : {items : function ()\r\n                        {\r\n                            return \"something\";\r\n                        }}\r\n                });\r\n                modalInstance.result.then(\r\n                function success(resp) {\r\n                    console.log(\"response: \" , resp);\r\n                    askSubscription(resp);\r\n                }, function failure(err) {\r\n                    console.log(\"no result from modal...\");\r\n                    vm7.tryagain = true;\r\n                });\r\n            }\r\n\r\n  })\r\n\r\n  .controller('SubscribeController', function($uibModalInstance, items)\r\n    {\r\n        console.log(\"loading subscribe controller...\");\r\n        var vm8 = this;\r\n        vm8.firstname = null;\r\n        vm8.lastname = null;\r\n        vm8.email = null;\r\n        vm8.submitSubscription = submitSubscription;\r\n        vm8.closeModal = closeModal;\r\n\r\n        function submitSubscription()\r\n        {\r\n            console.log(\"returning with details...\");\r\n            $uibModalInstance.close({firstname:vm8.firstname, lastname: vm8.lastname, email: vm8.email});\r\n        }\r\n\r\n        function closeModal()\r\n        {\r\n           $uibModalInstance.dismiss();\r\n        }\r\n    })\r\n\r\n\t .filter('xFilter', function()\r\n    {\r\n        return function(item)\r\n        {\r\n            if(typeof(item) === 'object')\r\n            {\r\n            \treturn '-';\r\n            }\r\n            else if(item.charAt(0)==='x')\r\n            {\r\n            \treturn item.substring(1,item.length);\r\n            }\r\n            else\r\n            {\r\n            \treturn item;\r\n            }\r\n\r\n\r\n        };\r\n    });\r\n\r\n}());\n(function()\r\n{\r\n  'use strict';\r\n  var app = angular.module('confab'); \r\n  app.\r\n\r\n  factory('ZipService', function (StorageFactory, StaticDataFactory, $http , UPLOAD_URL, IAF_URL, $window)\r\n     {\r\n\r\n      console.log(\"ZipService.js...\");\r\n\r\n        var PROJECTNAME; \r\n        var myslots;\r\n        var instancename = null;\r\n        var version = null;\r\n       \r\n        return {\r\n            init : init,\r\n            getSlots : getSlots,\r\n            getZip : getZip,\r\n            getZipFromFile : getZipFromFile,\r\n            sendZip : sendZip,\r\n            getMySlots : getMySlots,\r\n            mergeZipFromFile : mergeZipFromFile\r\n        };\r\n\r\n        function init()\r\n        {\r\n            return StorageFactory.getGetter(\"thejson\")();\r\n        }\r\n\r\n        function getSlots()\r\n        {\r\n            return StorageFactory.getGetter(\"myslots\")();\r\n        } \r\n\r\n        function getMySlots()\r\n        {\r\n            return myslots;\r\n        } \r\n\r\n        function sendZip(saveas)\r\n        {\r\n                return new Promise(function(resolve, reject)\r\n                {\r\n                  PROJECTNAME = StaticDataFactory.getProjectName();\r\n                  console.log(\"projectname....\", PROJECTNAME);\r\n                  var zip = new JSZip();\r\n                  var elements = document.querySelectorAll('[ui-tree-node]');\r\n                \r\n                //each tree element gets a filename and we grab the content from storage\r\n                elements.forEach(function(item)\r\n                {\r\n                    var object = angular.element(item).scope();\r\n                    var parents = [];\r\n\r\n                    while(object.$parentNodeScope !== null)\r\n                    {\r\n                        parents.push(object.$parentNodeScope.$modelValue.title);\r\n                        object = object.$parentNodeScope;\r\n                    }\r\n                    //console.log(\"parents of...\", object.$modelValue.title,\"\\n\",parents);       \r\n\r\n                    var filename = \"\";\r\n                    while(parents.length > 0)\r\n                    {   \r\n                        filename += cropFilter(parents.pop()) + '/';\r\n                        // console.log(\"filename: \", filename, \"\\n\");\r\n                    }\r\n                    \r\n\r\n                    // Het framework wil een configuration file perse met rootfolder hebben, zodoende dit onlogische stukje.\r\n                    //\"Ibis4Student/\" +\r\n                    if(cropFilter(angular.element(item).scope().$modelValue.title) === 'Configuration.xml')\r\n                    {\r\n                      \r\n                      filename = PROJECTNAME + \"/Configuration.xml\";\r\n\r\n                      //filename = \"Ibis4Student/Configuration.xml\";\r\n                    }\r\n                    else\r\n                    {\r\n                      \r\n                      filename =  filename + cropFilter(angular.element(item).scope().$modelValue.title) ;\r\n                    }\r\n                    // console.log(\"filename finally: \", filename, \"\\n\\n\");\r\n\r\n                    if(angular.element(item).scope().$modelValue.isDirectory)\r\n                    {\r\n                        // console.log(\"adding directory\", angular.element(item).scope().$modelValue);\r\n                        zip.folder(filename);\r\n                    }\r\n                    else\r\n                    {   \r\n                        var theslot = StorageFactory.getGetter(angular.element(item).scope().$modelValue.title)();\r\n                        zip.file(filename,StorageFactory.getGetter(theslot)());\r\n                    }\r\n                });\r\n                var timestamp = Date.now();\r\n                var text = \"configuration.version=\" + timestamp;\r\n                zip.file(\"BuildInfo_SC.properties\" , text);\r\n\r\n                console.log(\"Zipfile \", zip);\r\n                //takes a path pattern and returns the last part: \"dir1/subdir2/myfile.txt\" => \"myfile.txt\"\r\n               \r\n               \r\n                function cropFilter(item)\r\n                {\r\n                    if(item === undefined) return \"\";\r\n                    var helper = item.substring(item.lastIndexOf('/') + 1 ,item.length);\r\n                    if(helper.length > 0)\r\n                    {\r\n                        return helper;\r\n                    }\r\n                    else\r\n                    {\r\n                        return item;\r\n                    }\r\n                }\r\n\r\n                if(saveas)//responding to the save button in the treeview using file-saver API\r\n                {\r\n                  console.log(\"saving as a zip file...\");\r\n                  zip.generateAsync({type:\"blob\"}).then(function(myzip)\r\n                  {\r\n                    var blob = new Blob([myzip],{type:\"application/zip\"});\r\n                    console.log(\"generated a zip...\", blob);\r\n                    saveAs(blob, \"configuration.zip\");\r\n                    resolve();\r\n                  });\r\n                }\r\n                else //sending zip file to IAF\r\n                {\r\n                  postConfig(zip, timestamp).then(function success(resp)\r\n                  {\r\n                    console.log(\"returning from postconfig\");\r\n                    resolve(resp);\r\n                  },function failure(err)\r\n                  {\r\n                    console.log(\"returning error from postconfig\");\r\n                    reject(err);\r\n                  });\r\n                }\r\n                });\r\n        }\r\n\r\n\r\n        function postConfig(zip, timestamp)\r\n        {\r\n          return new Promise(function(resolve, reject)\r\n          {\r\n\r\n          PROJECTNAME = StaticDataFactory.getProjectName();\r\n            var finalurl = IAF_URL + UPLOAD_URL;\r\n            \r\n           \r\n            if( null !== StaticDataFactory.getReqParams())            \r\n            {   \r\n              var params = StaticDataFactory.getReqParams();\r\n              PROJECTNAME = params.instancename;\r\n              timestamp = params.version;\r\n              console.log(\"modifying version and projectname: \" , finalurl, PROJECTNAME, timestamp );\r\n            }\r\n            \r\n            zip.generateAsync({type:\"blob\"}).then(function(myzip)\r\n            {\r\n              var fileName = 'configuration.zip';\r\n              var fd = new FormData();\r\n              \r\n\r\n              fd.append(\"realm\", 'jdbc');\r\n              //fd.append(\"name\", \"Ibis4Student\");\r\n              fd.append(\"name\", PROJECTNAME);\r\n              fd.append(\"version\", timestamp);\r\n              fd.append(\"encoding\", 'utf-8');\r\n              fd.append(\"multiple_configs\", false);\r\n              fd.append(\"activate_config\", true);\r\n              fd.append(\"automatic_reload\", true);\r\n              fd.append(\"file\", myzip, fileName);\r\n\r\n              console.log(\"posting to iaf\", myzip);\r\n              $http({method: 'POST',url:finalurl , data: fd , headers:{'Content-type': undefined}})\r\n              .then(function succes(response)\r\n              {\r\n                  console.info(\"returning from backend\",response);\r\n                  if( null !== StaticDataFactory.getReqParams())            \r\n                  {  \r\n                  var firstpart = window.location.href.split('editor')[0];\r\n                  var secondpart = \"gui/#/configurations/manage/\";\r\n                  var thirdpart = StaticDataFactory.getReqParams().instancename;\r\n                  var theurl = firstpart + secondpart + thirdpart;\r\n                  console.log(\"switching back to console view: \", theurl);  \r\n                    window.location.assign(theurl);\r\n                  }\r\n                  resolve (response);\r\n              }, function failure(err)\r\n              {\r\n                  console.info(\"returning error from backend\",err);\r\n                  reject(err);\r\n              });\r\n\r\n              });//end of JSZIP promise\r\n\r\n            });//end of new promise\r\n\r\n        }\r\n\r\n        /*\r\n      Replaces the current File Browser contents with a zip from the local drive.\r\n        */\r\n        function getZipFromFile(file)\r\n        {\r\n          return JSZip.loadAsync(file).then(function(zip)\r\n            {\r\n              console.log(\"loadasync from file...\", zip);\r\n              StorageFactory.deleteAll();\r\n              var myzipfiles = [];\r\n              \r\n              //removing unwanted entries\r\n              zip.forEach(function(relativePath, file)\r\n              {\r\n                if(file.name.substring(0,2) !== '__' && file.name !== PROJECTNAME +'/' && file.name !== 'BuildInfo_SC.properties')\r\n                {\r\n                  myzipfiles.push(file);\r\n                }\r\n              });\r\n              \r\n              //removing an unwanted wrapper directory ('PROJECTNAME/Configuration.xml becomes 'Configuration.xml')\r\n              for(var i=0 ; i< myzipfiles.length; i++)\r\n              {\r\n                if(myzipfiles[i].name.indexOf(PROJECTNAME) > -1)\r\n                      {\r\n                        console.log(\"slicing out\", myzipfiles[i].name);\r\n                        var item = myzipfiles[i].name;\r\n                        var helper = item.substring(item.lastIndexOf('/') + 1 ,item.length);\r\n                        myzipfiles[i].name = helper;\r\n                      }\r\n              }\r\n\r\n              /*Write to local storage; to avoid collisions, the calls\r\n              are made synchronously.*/\r\n              storeZip(0);\r\n              \r\n              function storeZip(index)\r\n              {\r\n                if(index > myzipfiles.length-1)\r\n                {\r\n                  return;\r\n                }\r\n                else\r\n                {\r\n                  if(!(myzipfiles[index].dir))\r\n                  {\r\n                    myzipfiles[index].async(\"string\").then(function resolve(data)\r\n                    {\r\n                        var newslotname = \"slot\" + Math.ceil(Math.random()*1000);\r\n                        console.log(\"data length\",myzipfiles[index].name, data.toString().length);\r\n                        StorageFactory.getSetter(myzipfiles[index].name)(newslotname);\r\n                        StorageFactory.getSetter(newslotname)(data);\r\n                        index++;\r\n                        storeZip(index++);\r\n                    });\r\n                  }\r\n                  else\r\n                  {\r\n                    index++;\r\n                    storeZip(index);\r\n                  }\r\n                }\r\n              }                              \r\n\r\n              console.log(\"loaded zipfiles\",myzipfiles);\r\n              var myjson=[];\r\n              myslots = {};\r\n\r\n              //creation of a flat json structure              \r\n              for( i =0 ; i< myzipfiles.length ; i++)\r\n              {\r\n                if(myzipfiles[i].dir)\r\n                {\r\n                    myjson.push({\r\n                    id : Math.ceil(Math.random() * 10000),  \r\n                    isDirectory : myzipfiles[i].dir,\r\n                    title : myzipfiles[i].name.substring(0,myzipfiles[i].name.length-1),\r\n                    nodes : []\r\n                    });\r\n                }\r\n                else\r\n                {\r\n                  var myobj = {\r\n                    id : Math.ceil(Math.random() * 10000),\r\n                    isDirectory : myzipfiles[i].dir,\r\n                    title : myzipfiles[i].name,\r\n                    nodes : []\r\n                    };\r\n                  myjson.push(myobj);\r\n                  myslots[myobj.id] = {title:myobj.title, isLocked:false};\r\n                }\r\n              }\r\n\r\n              //sorting the array: highest amount of nodes first .\r\n              myjson.sort(function compare(val1, val2)\r\n              {\r\n                if(val1.title.split('/').length > val2.title.split('/').length)\r\n                {\r\n                  return -1;\r\n                }\r\n                if(val1.title.split('/').length < val2.title.split('/').length)\r\n                {\r\n                  return 1;\r\n                }\r\n                return 0;\r\n              });\r\n\r\n                var helper5 = 0;//emergency variable to prevent a possible eternal loop\r\n                var parentsfound = true; //escapes the while loop when we had a run with no results\r\n\r\n                \r\n                /*\r\n                adding children to the parents node arrays; when there is a parent found myjson is changed\r\n                and we will start the loop again\r\n                */\r\n                while(parentsfound &&  helper5 <100)\r\n                {\r\n                  parentsfound = false;\r\n                  var copy = myjson;\r\n\r\n                  for(var index = 0 ; index < myjson.length; index ++)\r\n                  {\r\n                    for(var j=0 ; j< copy.length; j++)\r\n                    {\r\n                      if(isParent(myjson[index].title, copy[j].title))\r\n                      {\r\n                        // console.log(myjson[index].title, \"direct parent of \" ,copy[j].title);\r\n                        // console.log(\"myjson\",myjson);\r\n                        myjson[index].nodes.push(copy[j]);\r\n                        myjson.splice(j,1);\r\n                        parentsfound = true;\r\n                        break;\r\n                      }\r\n                    }\r\n                    if(parentsfound)\r\n                    {\r\n                      break;\r\n                    }\r\n                  }\r\n                  helper5 ++;\r\n                }\r\n               \r\n\r\n\r\n                /* Main helper function of the recursive loop; \"dir1/dir2/file1.abc\" compared with \"dir1/dir2\" will\r\n                regard this as a direct parent-child relationship. */ \r\n                function isParent(possibleparent, candidate)\r\n                {\r\n                  if(possibleparent === candidate)\r\n                  {\r\n                    return false;\r\n                  }\r\n                  var index = candidate.lastIndexOf('/');\r\n                  if(candidate.substring(0,index) === possibleparent)\r\n                  {\r\n                    return true;\r\n                  }\r\n                  else\r\n                  {\r\n                    return false;\r\n                  }\r\n                }\r\n\r\n                console.log(\"generated json out of zip:\\n\",myjson);\r\n\r\n                //saving json and working files structure to local storage, and returning to the caller\r\n                StorageFactory.getSetter('thejson')(myjson);\r\n                StorageFactory.getSetter('myslots')(myslots);  \r\n                return(myjson); \r\n\r\n              });//end of jszip async call\r\n        }\r\n\r\n\r\n\r\n        /*\r\n      Adds a zip file to the current tree.\r\n        */\r\n      function mergeZipFromFile(file)\r\n        {\r\n          return JSZip.loadAsync(file).then(function(zip)\r\n            {\r\n              PROJECTNAME = StaticDataFactory.getProjectName();\r\n              console.log(\"loadasync from file...\", zip);\r\n              \r\n              var myzipfiles = [];\r\n              \r\n              //removing unwanted entries\r\n              zip.forEach(function(relativePath, file)\r\n              {\r\n                if(file.name.substring(0,2) !== '__' && file.name !== PROJECTNAME +'/' && file.name !== 'BuildInfo_SC.properties')\r\n                {\r\n                  myzipfiles.push(file);\r\n                }\r\n              });\r\n              \r\n              //removing an unwanted wrapper directory ('Ibis4Student/Configuration.xml becomes 'Configuration.xml')\r\n              for(var i=0 ; i< myzipfiles.length; i++)\r\n              {\r\n                if(myzipfiles[i].name.indexOf(PROJECTNAME) > -1)\r\n                      {\r\n                        console.log(\"slicing out\", myzipfiles[i].name);\r\n                        var item = myzipfiles[i].name;\r\n                        var helper = item.substring(item.lastIndexOf('/') + 1 ,item.length);\r\n                        myzipfiles[i].name = helper;\r\n                      }\r\n              }\r\n\r\n\r\n              /*\r\n          Searching for  possible duplicate directory names\r\n              */\r\n              var dirs = StorageFactory.getListOfDirectories();\r\n              var duplicates = [];\r\n              for ( i = 0 ; i < myzipfiles.length; i++)\r\n              {\r\n                  if(dirs.includes(myzipfiles[i].name))\r\n                  {\r\n                    duplicates.push(myzipfiles[i].name);\r\n                  }\r\n              }\r\n\r\n              duplicates.sort(function compare (dup1, dup2)\r\n              {\r\n                if(dup1.split('/').length > dup2.split('/').length)\r\n                {\r\n                  return 1;\r\n                }\r\n\r\n                else if(dup1.split('/').length === dup2.split('/').length)\r\n                {\r\n                  return 0;\r\n                }\r\n\r\n                else \r\n                {\r\n                  return -1;\r\n                }\r\n\r\n              });\r\n\r\n              //changing duplicate names in the zipfile\r\n              duplicates.forEach(function(duplicate)\r\n              {\r\n                var suffix = '(1)';\r\n                myzipfiles.forEach(function(zipfile)\r\n                {\r\n                  if(zipfile.name.includes(duplicate))\r\n                  {\r\n                    zipfile.name = zipfile.name.replace(duplicate, duplicate.substring(0,duplicate.length -1) + suffix + '/');\r\n                  }\r\n                });\r\n\r\n              });\r\n\r\n              var files = StorageFactory.getListOfFiles();\r\n              files.forEach(function(filename)\r\n              {\r\n                var suffix = '(1).';\r\n                for(i=0 ; i < myzipfiles.length; i++)\r\n                {\r\n                  if(myzipfiles[i].name === filename)\r\n                  {\r\n                  console.log(\"bingo\");\r\n                    if(myzipfiles[i].name.split('.').length > 0)\r\n                  {\r\n                    myzipfiles[i].name = myzipfiles[i].name.split('.')[0] + suffix + myzipfiles[i].name.split('.')[1];\r\n                  }\r\n                  else\r\n                  {\r\n                    myzipfiles[i].name = myzipfiles[i].name + createRandomSuffix();\r\n                  }\r\n                  }\r\n                }\r\n              });\r\n\r\n\r\n              /*Write to local storage; to avoid collisions, the calls\r\n              are made synchronously.*/\r\n              \r\n              storeZip(0);\r\n              function storeZip(index)\r\n              {\r\n                if(index > myzipfiles.length-1)\r\n                {\r\n                  return;\r\n                }\r\n                else\r\n                {\r\n                  if(!(myzipfiles[index].dir))\r\n                  {\r\n                    myzipfiles[index].async(\"string\").then(function resolve(data)\r\n                    {\r\n                        var newslotname = \"slot\" + createRandomSuffix();\r\n                        StorageFactory.getSetter(myzipfiles[index].name)(newslotname);\r\n                        StorageFactory.getSetter(newslotname)(data);\r\n                        index++;\r\n                        storeZip(index++);\r\n                    });\r\n                  }\r\n                  else\r\n                  {\r\n                    index++;\r\n                    storeZip(index);\r\n                  }\r\n                }\r\n              }                              \r\n\r\n              \r\n              console.log(\"zipfiles\",myzipfiles);\r\n              console.log(\"empty slot: \",StorageFactory.checkIfEmptyKey());\r\n              var myjson = StorageFactory.getGetter('thejson')();\r\n              myslots = StorageFactory.getGetter('myslots')();\r\n\r\n              //creation of a flat json structure              \r\n              for(i = 0 ; i< myzipfiles.length ; i++)\r\n              {\r\n                if(myzipfiles[i].dir)\r\n                {\r\n                    myjson.push({\r\n                    id : Math.ceil(Math.random() * 10000),  \r\n                    isDirectory : myzipfiles[i].dir,\r\n                    title : myzipfiles[i].name.substring(0,myzipfiles[i].name.length-1),\r\n                    nodes : []\r\n                    });\r\n                }\r\n                else\r\n                {\r\n                  var myobj = {\r\n                    id : Math.ceil(Math.random() * 10000),\r\n                    isDirectory : myzipfiles[i].dir,\r\n                    title : myzipfiles[i].name,\r\n                    nodes : []\r\n                    };\r\n                  myjson.push(myobj);\r\n                  myslots[myobj.id] = {title:myobj.title, isLocked:false};\r\n                }\r\n              }\r\n\r\n              //sorting the array: highest amount of nodes first .\r\n              myjson.sort(function compare(val1, val2)\r\n              {\r\n                if(val1.title.split('/').length > val2.title.split('/').length)\r\n                {\r\n                  return -1;\r\n                }\r\n                if(val1.title.split('/').length < val2.title.split('/').length)\r\n                {\r\n                  return 1;\r\n                }\r\n                return 0;\r\n              });\r\n\r\n                var helper1 = 0;//emergency variable to prevent a possible eternal loop\r\n                var parentsfound = true; //escapes the while loop when we had a run with no results\r\n\r\n                \r\n                /*\r\n                adding children to the parents node arrays; when there is a parent found myjson is changed\r\n                and we will start the loop again\r\n                */\r\n                while(parentsfound &&  helper1 <100)\r\n                {\r\n                  parentsfound = false;\r\n                  var copy = myjson;\r\n\r\n                  for(var index = 0 ; index < myjson.length; index ++)\r\n                  {\r\n                    for(var j=0 ; j< copy.length; j++)\r\n                    {\r\n                      if(isParent(myjson[index].title, copy[j].title))\r\n                      {\r\n                        // console.log(myjson[index].title, \"direct parent of \" ,copy[j].title);\r\n                        // console.log(\"myjson\",myjson);\r\n                        myjson[index].nodes.push(copy[j]);\r\n                        myjson.splice(j,1);\r\n                        parentsfound = true;\r\n                        break;\r\n                      }\r\n                    }\r\n                    if(parentsfound)\r\n                    {\r\n                      break;\r\n                    }\r\n                  }\r\n                  helper1 ++;\r\n                }\r\n               \r\n\r\n\r\n                /* Main helper function of the recursive loop; \"dir1/dir2/file1.abc\" compared with \"dir1/dir2\" will\r\n                regard this as a direct parent-child relationship. */ \r\n                function isParent(possibleparent, candidate)\r\n                {\r\n                  if(possibleparent === candidate)\r\n                  {\r\n                    return false;\r\n                  }\r\n                  var index = candidate.lastIndexOf('/');\r\n                  if(candidate.substring(0,index) === possibleparent)\r\n                  {\r\n                    return true;\r\n                  }\r\n                  else\r\n                  {\r\n                    return false;\r\n                  }\r\n                }\r\n\r\n                console.log(\"generated json out of zip:\\n\",myjson, myslots);\r\n\r\n                //saving json and working files structure to local storage, and returning to the caller\r\n                StorageFactory.getSetter('thejson')(myjson);\r\n                StorageFactory.getSetter('myslots')(myslots);  \r\n                return(myjson); \r\n\r\n              });//end of jszip async call\r\n        }\r\n\r\n\r\n        function createRandomSuffix()\r\n        {\r\n            var suffixes = \"abcdefghijklmnopqrstuvwxyzABCDEFGHILJKLMNOPRSTUVWXYZ\";\r\n            var result = \"\";\r\n            for(var i=0 ; i<3; i++)\r\n            {\r\n                var randomdigit = Math.floor(Math.random()*suffixes.length);\r\n                var letter = suffixes.substring(randomdigit,randomdigit + 1);\r\n                result += letter;\r\n            }\r\n            return result;\r\n        }\r\n\r\n\r\n\r\n\r\n        /*\r\n          retrieves IAF configuration zip file via http, and transforms this zipfile  to a json object\r\n          the zipfiles data are stored in LocalStorage;\r\n        */\r\n        function getZip()\r\n        {\r\n         \r\n          var DOWNLOAD_URL = \"/iaf/api/configurations/download/\" + StaticDataFactory.getProjectName();\r\n          var finalUrl = IAF_URL + DOWNLOAD_URL;\r\n          PROJECTNAME = StaticDataFactory.getProjectName();\r\n\r\n          if(null !== StaticDataFactory.getReqParams())\r\n          {\r\n            var params = StaticDataFactory.getReqParams();\r\n            PROJECTNAME = params.instancename;\r\n            DOWNLOAD_URL = \"/iaf/api/configurations/download/\" + params.instancename + '?version=' + params.version;\r\n            finalUrl = IAF_URL + DOWNLOAD_URL ;\r\n          }\r\n          console.log(\"Download url :\",finalUrl);\r\n          \r\n          \r\n\r\n          return $http({method:\"GET\", url: finalUrl, responseType:'arraybuffer'}).then(function success(resp)\r\n          {\r\n            return new Promise(function (resolve, reject)\r\n            {\r\n            JSZip.loadAsync(resp.data).then(function(zip)\r\n            {\r\n              console.log(\"loadasync...\", zip);\r\n              StorageFactory.deleteAll();\r\n              var myzipfiles = [];\r\n              \r\n              //removing the mac specific entries...don't know whether this is the proper way...\r\n              zip.forEach(function(relativePath, file)\r\n              {\r\n                if(file.name.substring(0,2) !== '__' && file.name !== PROJECTNAME +'/' && file.name !== 'BuildInfo_SC.properties')\r\n                {\r\n                  myzipfiles.push(file);\r\n                }\r\n              });\r\n\r\n              /*removing an unwanted wrapper directory (fe. 'Ibis4Student/Configuration.xml becomes 'Configuration.xml')\r\n              when this wrapper directory has another name then the projectname we will leave it to warn the user to\r\n              change the configuration name*/\r\n              for(var i=0 ; i< myzipfiles.length; i++)\r\n              {\r\n                if(myzipfiles[i].name.indexOf(PROJECTNAME) > -1)\r\n                      {\r\n                        console.log(\"slicing out\", myzipfiles[i].name);\r\n                        var item = myzipfiles[i].name;\r\n                        var helper = item.substring(item.lastIndexOf('/') + 1 ,item.length);\r\n                        myzipfiles[i].name = helper;\r\n                      }\r\n              }\r\n\r\n\r\n    \r\n              /*Write to local storage; to avoid collisions, the calls\r\n              are made synchronously.*/\r\n              storeZip(0);\r\n              \r\n              function storeZip(index)\r\n              {\r\n                if(index > myzipfiles.length-1)\r\n                {\r\n                  return;\r\n                }\r\n                else\r\n                {\r\n                  if(!(myzipfiles[index].dir))\r\n                  {\r\n                    myzipfiles[index].async(\"string\").then(function resolve(data)\r\n                    {\r\n                        var newslotname = \"slot\" + Math.ceil(Math.random()*1000);\r\n                        StorageFactory.getSetter(myzipfiles[index].name)(newslotname);\r\n                        StorageFactory.getSetter(newslotname)(data);\r\n                        index++;\r\n                        storeZip(index++);\r\n                    });\r\n                  }\r\n                  else\r\n                  {\r\n                    index++;\r\n                    storeZip(index);\r\n                  }\r\n                }\r\n              }                              \r\n\r\n              console.log(\"zipfiles\",myzipfiles);\r\n              var myjson=[];\r\n              myslots = {};\r\n\r\n              //creation of a flat json structure              \r\n              for( i =0 ; i< myzipfiles.length ; i++)\r\n              {\r\n                if(myzipfiles[i].dir)\r\n                {\r\n                    myjson.push({\r\n                    id : Math.ceil(Math.random() * 10000),  \r\n                    isDirectory : myzipfiles[i].dir,\r\n                    title : myzipfiles[i].name.substring(0,myzipfiles[i].name.length-1),\r\n                    nodes : []\r\n                    });\r\n                }\r\n                else\r\n                {\r\n                  var myobj = {\r\n                    id : Math.ceil(Math.random() * 10000),\r\n                    isDirectory : myzipfiles[i].dir,\r\n                    title : myzipfiles[i].name,\r\n                    nodes : []\r\n                    };\r\n                  myjson.push(myobj);\r\n                  myslots[myobj.id] = {title:myobj.title, isLocked:false};\r\n                }\r\n              }\r\n\r\n              //sorting the array: highest amount of nodes first .\r\n              myjson.sort(function compare(val1, val2)\r\n              {\r\n                if(val1.title.split('/').length > val2.title.split('/').length)\r\n                {\r\n                  return -1;\r\n                }\r\n                if(val1.title.split('/').length < val2.title.split('/').length)\r\n                {\r\n                  return 1;\r\n                }\r\n                return 0;\r\n              });\r\n\r\n                var helper3 = 0;//emergency variable to prevent a possible eternal loop\r\n                var parentsfound = true; //escapes the while loop when we had a run with no results\r\n\r\n                \r\n                /*\r\n                adding children to the parents node arrays; when there is a parent found myjson is changed\r\n                and we will start the loop again\r\n                */\r\n                while(parentsfound &&  helper3 <100)\r\n                {\r\n                  parentsfound = false;\r\n                  var copy = myjson;\r\n\r\n                  for(var index = 0 ; index < myjson.length; index ++)\r\n                  {\r\n                    for(var j=0 ; j< copy.length; j++)\r\n                    {\r\n                      if(isParent(myjson[index].title, copy[j].title))\r\n                      {\r\n                        // console.log(myjson[index].title, \"direct parent of \" ,copy[j].title);\r\n                        // console.log(\"myjson\",myjson);\r\n                        myjson[index].nodes.push(copy[j]);\r\n                        myjson.splice(j,1);\r\n                        parentsfound = true;\r\n                        break;\r\n                      }\r\n                    }\r\n                    if(parentsfound)\r\n                    {\r\n                      break;\r\n                    }\r\n                  }\r\n                  helper3 ++;\r\n                }\r\n               \r\n\r\n\r\n                /* Main helper function of the recursive loop; \"dir1/dir2/file1.abc\" compared with \"dir1/dir2\" will\r\n                regard this as a direct parent-child relationship. */ \r\n                function isParent(possibleparent, candidate)\r\n                {\r\n                  if(possibleparent === candidate)\r\n                  {\r\n                    return false;\r\n                  }\r\n                  var index = candidate.lastIndexOf('/');\r\n                  if(candidate.substring(0,index) === possibleparent)\r\n                  {\r\n                    return true;\r\n                  }\r\n                  else\r\n                  {\r\n                    return false;\r\n                  }\r\n                }\r\n\r\n                console.log(\"generated json out of zip:\\n\",myjson);\r\n\r\n                //saving json and working files structure to local storage, and returning to the caller\r\n                StorageFactory.setCurrentKey(myslots[0]);\r\n                StorageFactory.getSetter('thejson')(myjson);\r\n                StorageFactory.getSetter('myslots')(myslots);  \r\n                resolve(myjson); \r\n\r\n              }, \r\n              function failure(err)\r\n              {\r\n                console.log(\"error\", err);\r\n                reject(err);\r\n              });//end of jszip async call\r\n\r\n            });//end of Promise (necessary because of nested promises...)\r\n\r\n        },\r\n        function failure(err)\r\n        {\r\n          console.log(\"error in http call\", err);\r\n          return;\r\n        },function failure(err)\r\n        {\r\n          console.log(\"error in http call\", err);\r\n          return;\r\n\r\n        });//end of http);//end of http\r\n\r\n\r\n      }//end of method getzip\r\n\r\n\r\n     })//end of factory\r\n\r\n  .factory('IafFactory', function($http, ZipService, UPLOAD_URL, $window,IAF_URL)\r\n    {\r\n      \r\n    var uname = null;\r\n    var pw = null;\r\n    // var MYIAF_URL = $window.location.href;\r\n\r\n    // if(MYIAF_URL.indexOf('/#/')> -1)\r\n    //         {\r\n    //           MYIAF_URL = MYIAF_URL.substring(0,MYIAF_URL.indexOf('/#/'));\r\n    //         }\r\n\r\n    //         if(MYIAF_URL.charAt(MYIAF_URL.length-1) === '/')\r\n    //         {\r\n    //           MYIAF_URL = MYIAF_URL.substring(0,MYIAF_URL.length-1);\r\n    //         }\r\n\r\n    //   console.log(\"IafFactory\", MYIAF_URL);\r\n\r\n      return{\r\n        postConfig : postConfig\r\n        \r\n      };\r\n\r\n      //resonding to the paperplane button upper right\r\n      function postConfig(zip)\r\n      {\r\n        return new Promise(function(resolve, reject)\r\n        {\r\n          var finalurl = IAF_URL + UPLOAD_URL;\r\n          PROJECTNAME = StaticDataFactory.getProjectName();\r\n          alert(finalurl);\r\n        zip.generateAsync({type:\"blob\"}).then(function(myzip)\r\n        {\r\n          var fileName = 'configuration.zip';\r\n          var fd = new FormData();\r\n          fd.append(\"realm\", 'jdbc');\r\n          fd.append(\"name\", PROJECTNAME);\r\n          fd.append(\"version\", 1);\r\n          fd.append(\"encoding\", 'utf-8');\r\n          fd.append(\"multiple_configs\", false);\r\n          fd.append(\"activate_config\", true);\r\n          fd.append(\"automatic_reload\", true);\r\n          fd.append(\"file\", myzip, fileName);\r\n\r\n\r\n          return new Promise(function(resolve, reject)\r\n          {\r\n             console.log(\"posting to iaf\", myzip);\r\n              return $http({method: 'POST',url:finalurl , data: fd , headers:{'Content-type': undefined}}\r\n                  ).then(function succes(response)\r\n                  {\r\n                      console.info(\"returning from backend\",response);\r\n                      resolve (response);\r\n                  }, function failure(response)\r\n                  {\r\n                      console.info(\"returning error from backend\",response);\r\n                      reject(response);\r\n                  });\r\n                });           \r\n          });\r\n        resolve();\r\n        });\r\n      }\r\n      //responding to the submit button in the authentication area.\r\n      //function setCredentials(server, uname, pw)\r\n      //{\r\n        // return new Promise(function(resolve, reject)\r\n        // {\r\n        //   if (server)\r\n        //   {\r\n        //     if(server.indexOf('/#/')> -1)\r\n        //     {\r\n        //       server = server.substring(0,server.indexOf('/#/'));\r\n        //     }\r\n\r\n        //     if(server.charAt(server.length-1) === '/')\r\n        //     {\r\n        //       server = server.substring(0,server.length-1);\r\n        //     }\r\n\r\n\r\n        //     console.log(\"credentials: \" , server, uname, pw);\r\n        //     MYIAF_URL = server;\r\n        //     StorageFactory.getSetter('MYIAF_URL')(server);\r\n        //     StaticDataFactory.setIafUrl();\r\n        //     ZipService.setIafUrl();\r\n        //     if(StaticDataFactory.getStaticJson() === null || StaticDataFactory.getStaticJson() === undefined)\r\n        //     {\r\n        //       StaticDataFactory.getJson().then(function success(resp)\r\n        //       {\r\n        //         console.log(\"succes from factory... now updating the scope\");\r\n        //         resolve(resp);\r\n        //       },\r\n        //       function failure(err)\r\n        //       {\r\n        //          console.log(\"failure getting json...\", err);\r\n        //          reject(err);\r\n        //       });\r\n        //     }\r\n        //   }\r\n        //   else\r\n        //   {\r\n        //     console.log(\"doing noting...\");\r\n        //   }\r\n        // });\r\n     // }\r\n    });\r\n}());"]}